<div class="gm-screen-layout">
    
    {{!-- COLUNA ESQUERDA: MONITOR + MANUAL --}}
    <aside class="screen-sidebar monitor-column">
        
        {{!-- 1. Cabeçalho --}}
        <div class="column-header"><i class="fas fa-users"></i> Personagens</div>

        {{!-- 2. BARRA MANUAL (MOVIDA PARA CÁ) --}}
        <div class="manual-mod-section">
            <div class="manual-mod-toolbar {{#if isManualActive}}active{{/if}}">
                
                {{!-- Linha 1: Motivo --}}
                <input type="text" class="manual-name" placeholder="Motivo (ex: Terreno)" value="{{manualCache.name}}">
                
                {{!-- Linha 2: Valor e Controles --}}
                <div class="manual-row-middle">
                    <div class="value-controls">
                        <button class="step-btn" data-action="dec"><i class="fas fa-minus"></i></button>
                        <input type="number" class="manual-value" value="{{manualCache.value}}">
                        <button class="step-btn" data-action="inc"><i class="fas fa-plus"></i></button>
                    </div>
                    <button class="activate-manual-btn" title="Ativar Manual">
                        <i class="fas fa-crosshairs"></i>
                    </button>
                </div>

                {{!-- Linha 3: Presets (Grid Compacto) --}}
                <div class="manual-presets">
                    <button class="preset-btn" data-val="-6">-6</button>
                    <button class="preset-btn" data-val="-4">-4</button>
                    <button class="preset-btn" data-val="-2">-2</button>
                    <button class="preset-btn" data-val="2">+2</button>
                    <button class="preset-btn" data-val="4">+4</button>
                    <button class="preset-btn" data-val="6">+6</button>
                </div>
            </div>
        </div>

        {{!-- 3. Lista de Personagens --}}
        <div class="monitor-list">
            {{#each actors}}
            <div class="monitor-card" data-actor-id="{{this.id}}">
                <div class="card-top">
                    <div class="actor-identity">
                        <img src="{{this.img}}" />
                        <span class="actor-name">{{this.name}}</span>
                    </div>
                    <div class="vital-bars">
                        <div class="mini-bar hp"><div class="fill" style="width: {{this.hp.percent}}%;"></div></div>
                        <div class="mini-bar fp"><div class="fill" style="width: {{this.fp.percent}}%;"></div></div>
                    </div>
                </div>
                <div class="active-mods-zone">
                    {{#if this.activeGMMods.length}}
                        {{#each this.activeGMMods}}
                        <span class="active-mod-tag" data-index="{{@index}}">
                            {{this.name}} <strong>{{#if (gt this.value 0)}}+{{/if}}{{this.value}}</strong>
                            <i class="fas fa-times remove-mod"></i>
                        </span>
                        {{/each}}
                    {{else}}
                        <span class="hint-text">. . .</span>
                    {{/if}}
                </div>
            </div>
            {{/each}}
        </div>
    </aside>

    {{!-- COLUNA DIREITA: DASHBOARD (LIMPA) --}}
    <section class="screen-main controls-column">
        
        {{!-- Barra de Ferramentas da Paleta --}}
        <div class="palette-tools-bar">
            <nav class="screen-tabs tabs" data-group="primary">
                <a class="item" data-tab="modifiers"><i class="fas fa-sliders-h"></i> Dashboard</a>
                <a class="item" data-tab="macros"><i class="fas fa-terminal"></i> Macros</a>
            </nav>
            
            <div class="palette-actions">
                <div class="search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" class="mod-search" placeholder="Filtrar..." autocomplete="off">
                </div>
                <button class="clear-selection-btn" title="Desmarcar Todos">
                    <i class="fas fa-eraser"></i>
                </button>
            </div>
        </div>

        <section class="screen-body">
            <div class="tab modifiers-dashboard" data-tab="modifiers">
                <div class="modular-grid">
                    {{#each columns as |column|}}
                    <div class="modular-column" data-col-id="{{column.id}}">
                        <div class="column-tools">
                            <button class="add-group-btn" data-col="{{column.id}}" title="Criar Grupo"><i class="fas fa-plus"></i></button>
                        </div>
                        <div class="column-groups">
                            {{#each column.groups as |group|}}
                            <div class="modifier-group" data-group-id="{{group.id}}">
                                <div class="group-header">
                                    <span class="group-title">{{group.name}}</span>
                                    <div class="group-actions">
                                        <a class="add-mod-to-group-btn" data-group-id="{{group.id}}"><i class="fas fa-search-plus"></i></a>
                                        <a class="delete-group-btn" data-group-id="{{group.id}}"><i class="fas fa-trash"></i></a>
                                    </div>
                                </div>
                                <div class="group-content-area">
                                    {{#each group.enrichedItems}}
                                    <div class="palette-mod {{#if this.isSelected}}active{{/if}}" data-uuid="{{this.uuid}}" data-value="{{this.system.modifier}}">
                                        <div class="mod-left">
                                            <img src="{{this.img}}" class="mod-icon"/>
                                            <span class="mod-name">{{this.name}}</span>
                                        </div>
                                        <div class="mod-right">
                                            <span class="mod-val {{#if (lt this.system.modifier 0)}}neg{{/if}}">
                                                {{numberFormat this.system.modifier sign=true}}
                                            </span>
                                            <div class="mod-hover-controls">
                                                <a class="mod-quick-view"><i class="fas fa-eye"></i></a>
                                                <a class="delete-mod-btn"><i class="fas fa-times"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                    {{/each}}
                                    {{#unless group.enrichedItems}}<div class="empty-group-hint">Vazio</div>{{/unless}}
                                </div>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    {{/each}}
                </div>
            </div>
            <div class="tab" data-tab="macros"><p class="instruction">Macros em breve.</p></div>
        </section>
    </section>
</div>