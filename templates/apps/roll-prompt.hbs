<form class="gum-roll-prompt two-column-layout" autocomplete="off">

    {{!-- COLUNA DA ESQUERDA: MENU DE OPÇÕES (SCROLL) --}}
    <div class="prompt-menu-column">
        <h3 class="column-header"><i class="fas fa-list"></i> Modificadores</h3>
        
        <div class="roll-blocks-container">
            {{#each blocks as |block|}}
            <details class="option-group">
                <summary class="group-summary" style="border-left-color: {{block.color}};">
                    <span class="summary-title">{{block.title}}</span>
                    <i class="fas fa-chevron-down"></i>
                </summary>
                <div class="group-content">
                    <div class="block-buttons">
                    {{#each block.items as |btn|}}
                        <div class="mod-item-wrapper">
                            {{!-- Botão de Seleção (Principal) --}}
                            <button type="button" class="mod-btn {{#if btn.active}}active{{/if}}" 
                                    data-id="{{btn.id}}" 
                                    data-value="{{btn.value}}" 
                                    data-label="{{btn.label}}" 
                                    data-cap="{{btn.nh_cap}}">
                                <span class="btn-label">{{btn.label}}</span>
                                <span class="btn-value">{{#if (gt btn.value 0)}}+{{/if}}{{btn.value}}</span>
                            </button>

                            {{!-- Botão de Informação (Separado) --}}
                            <div class="mod-view" data-desc="{{btn.desc}}" data-title="{{btn.label}}" data-value="{{btn.value}}" data-cap="{{btn.nh_cap}}" data-duration="{{btn.duration}}">
                                <i class="fas fa-info-circle"></i>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>
            </details>
            {{/each}}
        </div>
    </div>

    {{!-- COLUNA DA DIREITA: COMANDA / DASHBOARD (FIXO) --}}
    <div class="prompt-command-column">

        {{!-- 1. CABEÇALHO (Compacto) --}}
        <div class="command-header">
            <div class="roll-icon-small">
                {{#if img}}<img src="{{img}}">{{else}}<i class="fas fa-dice-d20"></i>{{/if}}
            </div>
            <div class="roll-info-compact">
                <h2 class="roll-title-compact">{{label}}</h2>
                <div class="roll-subtitle">{{actor.name}}</div>
            </div>
        </div>

        {{!-- 2. ATRIBUTO BASE (SELETOR) --}}
        <div class="base-attribute-panel">
            <label class="section-label">Atributo Base</label>
            <div class="base-attribute-row base-attribute-row--primary">
                {{#each baseAttributePrimary as |option|}}
                <button type="button" class="base-attr-btn {{#if option.isSelected}}active{{/if}}"
                        data-key="{{option.key}}"
                        data-label="{{option.label}}"
                        data-value="{{option.value}}"
                        data-type="{{option.type}}">
                    {{option.label}}
                </button>
                {{/each}}
            </div>
            <div class="base-attribute-row base-attribute-row--secondary">
                {{#each baseAttributeSecondary as |option|}}
                <button type="button" class="base-attr-btn {{#if option.isSelected}}active{{/if}}"
                        data-key="{{option.key}}"
                        data-label="{{option.label}}"
                        data-value="{{option.value}}"
                        data-type="{{option.type}}">
                    {{option.label}}
                </button>
                {{/each}}
            </div>
        </div>

        {{!-- 2. NH BASE (Destaque) --}}
        <div class="base-value-box">
            <span class="label">NH Base (<span class="base-attr-label">{{baseAttributeLabel}}</span>)</span>
            <span class="value">{{baseValue}}</span>
        </div>


        {{!-- 3. MODIFICADOR MANUAL --}}
        <div class="manual-mod-panel compact">
            <div class="mod-controls-row">
                <button type="button" class="step-btn" data-action="decrease" {{#if lockInitialModifier}}disabled{{/if}}><i class="fas fa-minus"></i></button>
                <div class="manual-input-wrapper">
                    <label>{{manualLabel}}</label>
                    <input style="color:rgba(255, 255, 255, 0.747);" type="number" name="manualMod" value="{{initialManualMod}}" class="manual-input" {{#if lockInitialModifier}}readonly{{/if}}/>
                </div>
                <button type="button" class="step-btn" data-action="increase" {{#if lockInitialModifier}}disabled{{/if}}><i class="fas fa-plus"></i></button>
            </div>
            <div class="presets-row">
                <button type="button" class="quick-btn" data-value="-6" {{#if lockInitialModifier}}disabled{{/if}}>-6</button>
                <button type="button" class="quick-btn" data-value="-4" {{#if lockInitialModifier}}disabled{{/if}}>-4</button>
                <button type="button" class="quick-btn" data-value="-2" {{#if lockInitialModifier}}disabled{{/if}}>-2</button>
                <button type="button" class="quick-btn" data-value="2" {{#if lockInitialModifier}}disabled{{/if}}>+2</button>
                <button type="button" class="quick-btn" data-value="4" {{#if lockInitialModifier}}disabled{{/if}}>+4</button>
                <button type="button" class="quick-btn" data-value="6" {{#if lockInitialModifier}}disabled{{/if}}>+6</button>
            </div>
        </div>

        {{!-- 4. PILHA DE ATIVOS (Stack) --}}
        <div class="active-mods-container">
            <label class="section-label">Ativos</label>
            <div class="active-mods-list">
                {{!-- O JS vai injetar as tags aqui --}}
                <span class="empty-stack-msg">...</span>
            </div>
        </div>

        {{!-- 5. RODAPÉ DE AÇÃO (Fixo no fundo da coluna direita) --}}
        <div class="command-footer">
<div class="calc-display">
            <div class="calc-row final">
                <span class="calc-label">NH FINAL</span>
                {{!-- Adicionamos classes para riscar se tiver cap --}}
                <span class="calc-val final-val">{{baseValue}}</span>
            </div>
            
            {{!-- LINHA DE DETALHE --}}
            <div class="calc-row detail">
                <span class="detail-text"><span class="base-summary">Base {{baseValue}}</span> <span class="total-mod-val">+0</span></span>
            </div>

            {{!-- LINHA DE TETO (CAP) --}}
            {{!-- Escondida por padrão, o JS vai mostrar --}}
            <div class="cap-info-row" style="display:none;">
                <span class="cap-label"><i class="fas fa-arrow-down"></i> Teto Máximo:</span>
                <span class="cap-val">--</span>
            </div>
        </div>

            <button type="submit" class="roll-big-btn">
                <i class="fas fa-dice"></i> ROLAR
            </button>
        </div>

    </div>
</form>