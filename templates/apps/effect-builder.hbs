<form>
    <div class="dialog-content">
        <div class="form-section">
            <h4 class="section-title">Tipo de Efeito</h4>
            <div class="form-group">
                <select name="type">
                    <option value="attribute" {{#if (eq object.type "attribute")}}selected{{/if}}>Modificar Atributo</option>
                    <option value="status" {{#if (eq object.type "status")}}selected{{/if}}>Aplicar Status do Token</option>
                    <option value="flag" {{#if (eq object.type "flag")}}selected{{/if}}>Aplicar Flag Customizada</option>
                    <option value="macro" {{#if (eq object.type "macro")}}selected{{/if}}>Executar Macro</option>
                    <option value="chat" {{#if (eq object.type "chat")}}selected{{/if}}>Enviar Mensagem</option>
                </select>
            </div>
        </div>

{{!-- BLOCO PARA MODIFICAR ATRIBUTO FLAG --}}
        {{#if (eq object.type "attribute")}}
        <div class="form-section">
            <h4 class="section-title">Detalhes do Atributo</h4>
            <div class="form-group">
                <label>Caminho do Atributo</label>
                <div class="path-input-group">
                    <input type="text" name="path" value="{{object.path}}" placeholder="system.attributes.dx.temp"/>
                    <a class="open-attribute-picker" title="Selecionar Atributo">⊕</a>
                </div>
            </div>
           <div class="form-grid-2">
                <div class="form-group"><label>Operação</label>
                    <select name="operation">
                        {{{selectOptions (obj "ADD" "Adicionar" "SUB" "Subtrair" "SET" "Definir") selected=object.operation}}}
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor 
                        <a class="open-value-help" title="Ajuda com Fórmulas">?</a>
                    </label>
                    <input type="text" name="value" value="{{object.value}}" placeholder="Ex: 2 ou Math.floor(...)"/>
                    <p class="hint">Você pode usar números ou fórmulas JS com <code>actor</code>. Ex: <code>Math.floor(actor.system.attributes.st.final / 2)</code></p>
                    </div>
            </div>
        </div>
        {{/if}}

        {{#if (eq object.type "status")}}
        <div class="form-section">
            <h4 class="section-title">Detalhes do Status</h4>
            <div class="form-group"><label>Ícone de Status</label><select name="statusId">{{{selectOptions statusEffects selected=object.statusId}}}</select></div>
        </div>
        {{/if}}

        {{#if (eq object.type "macro")}}
        <div class="form-section">
             <h4 class="section-title">Detalhes da Macro</h4>
             <div class="form-group"><label>Nome da Macro</label><input type="text" name="value" value="{{object.value}}" placeholder="Nome exato"/></div>
        </div>
        {{/if}}

{{#if (eq object.type "chat")}}
<div class="form-section">
     <h4 class="section-title">Detalhes da Mensagem</h4>
     <div class="form-group"><label>Texto da Mensagem</label><textarea name="chat_text" rows="3">{{object.chat_text}}</textarea></div>
    <div class="form-group-inline"><label>Visibilidade</label>
        <select name="whisperMode">
            {{{selectOptions (obj "public" "Público" "gm" "Apenas para MJs" "blind" "Rolagem Cega") selected=object.whisperMode}}}
        </select>
    </div>
    <div class="form-group-inline"><label>Incluir Botão de Teste?</label><input type="checkbox" name="has_roll" {{checked object.has_roll}}/></div>
    
    {{#if object.has_roll}}
    <div class="form-grid-3 sub-effect-group">
        <div class="form-group"><label>Atributo do Teste</label>
            <select name="roll_attribute">
                {{!-- ✅ NOVA OPÇÃO "VALOR FIXO" ✅ --}}
                <option value="fixed" {{#if (eq object.roll_attribute 'fixed')}}selected{{/if}}>Valor Fixo...</option>
                <option value="st.final" {{#if (eq object.roll_attribute 'st.final')}}selected{{/if}}>ST</option>
                <option value="dx.final" {{#if (eq object.roll_attribute 'dx.final')}}selected{{/if}}>DX</option>
                <option value="iq.final" {{#if (eq object.roll_attribute 'iq.final')}}selected{{/if}}>IQ</option>
                <option value="ht.final" {{#if (eq object.roll_attribute 'ht.final')}}selected{{/if}}>HT</option>
                <option value="vont.final" {{#if (eq object.roll_attribute 'vont.final')}}selected{{/if}}>Vontade</option>
                <option value="per.final" {{#if (eq object.roll_attribute 'per.final')}}selected{{/if}}>Percepção</option>
            </select>
        </div>

        {{!-- ✅ CAMPO QUE APARECE APENAS PARA "VALOR FIXO" ✅ --}}
        {{#if (eq object.roll_attribute "fixed")}}
        <div class="form-group">
            <label>Alvo Fixo</label>
            <input type="number" name="roll_fixed_value" value="{{object.roll_fixed_value}}" placeholder="12"/>
        </div>
        {{else}}
        <div class="form-group">
            <label>Modificador</label>
            <input type="number" name="roll_modifier" value="{{object.roll_modifier}}" placeholder="0"/>
        </div>
        {{/if}}

        <div class="form-group">
            <label>Texto do Botão</label>
            <input type="text" name="roll_label" value="{{object.roll_label}}" placeholder="Rolar Teste"/>
        </div>
    </div>
    {{/if}}
</div>
{{/if}}


        {{!-- BLOCO PARA APLICAR FLAG --}}
        {{#if (eq object.type "flag")}}
        <div class="form-section">
            <h4 class="section-title">Detalhes da Flag</h4>
            <p class="hint">Isso cria uma "etiqueta" de dados invisível no personagem que outras condições podem ler.</p>
            <div class="form-grid-2">
                <div class="form-group">
                    <label>Nome da Flag (Chave)</label>
                    <input type="text" name="key" value="{{object.key}}" placeholder="ex: estaMolhado"/>
                </div>
                <div class="form-group">
                    <label>Valor da Flag</label>
                    <input type="text" name="value" value="{{object.value}}" placeholder="ex: true, 1, 'fogo'"/>
                </div>
            </div>
        </div>
        {{/if}}

    </div>
    <footer class="sheet-footer"><button type="submit"><i class="fas fa-save"></i> Salvar Efeito</button></footer>
</form>