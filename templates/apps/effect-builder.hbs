<form>
    <div class="dialog-content">
        <div class="form-section">
            <h4 class="section-title">Tipo de Efeito</h4>
            <div class="form-group">
                <select name="type">
                    <option value="attribute" {{#if (eq object.type "attribute")}}selected{{/if}}>Modificar Atributo</option>
                    <option value="status" {{#if (eq object.type "status")}}selected{{/if}}>Aplicar Status do Token</option>
                    <option value="macro" {{#if (eq object.type "macro")}}selected{{/if}}>Executar Macro</option>
                    <option value="chat" {{#if (eq object.type "chat")}}selected{{/if}}>Enviar Mensagem</option>
                </select>
            </div>
        </div>

        {{#if (eq object.type "attribute")}}
        <div class="form-section">
            <h4 class="section-title">Detalhes do Atributo</h4>
<div class="form-group">
    <label>Caminho do Atributo</label>
    {{!-- ✅ NOVO GRUPO COM BOTÃO DE AJUDA ✅ --}}
    <div class="path-input-group">
        <input type="text" name="path" value="{{object.path}}" placeholder="system.attributes.dx.temp"/>
        <a class="open-attribute-picker" title="Selecionar Atributo">⊕</a>
    </div>
</div>
           <div class="form-grid-2">
                <div class="form-group"><label>Operação</label>
                    <select name="operation">
                        {{{selectOptions (obj "ADD" "Adicionar" "SUB" "Subtrair" "SET" "Definir") selected=object.operation}}}
                    </select>
                </div>
                <div class="form-group"><label>Valor</label><input type="text" name="value" value="{{object.value}}"/></div>
            </div>
        </div>
        {{/if}}

        {{#if (eq object.type "status")}}
        <div class="form-section">
            <h4 class="section-title">Detalhes do Status</h4>
            <div class="form-group"><label>Ícone de Status</label><select name="statusId">{{{selectOptions statusEffects selected=object.statusId}}}</select></div>
        </div>
        {{/if}}

        {{#if (eq object.type "macro")}}
        <div class="form-section">
             <h4 class="section-title">Detalhes da Macro</h4>
             <div class="form-group"><label>Nome da Macro</label><input type="text" name="value" value="{{object.value}}" placeholder="Nome exato"/></div>
        </div>
        {{/if}}

        {{#if (eq object.type "chat")}}
        <div class="form-section">
             <h4 class="section-title">Detalhes da Mensagem</h4>
             <div class="form-group"><label>Texto da Mensagem</label><textarea name="chat_text" rows="3">{{object.chat_text}}</textarea></div>
            <div class="form-group-inline"><label>Visibilidade</label>
                <select name="whisperMode">
                    {{{selectOptions (obj "public" "Público" "gm" "Apenas para MJs" "blind" "Rolagem Cega") selected=object.whisperMode}}}
                </select>
            </div>
            <div class="form-group-inline"><label>Incluir Botão de Teste?</label><input type="checkbox" name="has_roll" {{checked object.has_roll}}/></div>
            {{#if object.has_roll}}
            <div class="form-grid-3 sub-effect-group">
                <div class="form-group"><label>Atributo</label>
                    <select name="roll_attribute">
                         {{{selectOptions (obj "st.final" "ST" "dx.final" "DX" "iq.final" "IQ" "ht.final" "HT" "vont.final" "Vontade" "per.final" "Percepção") selected=object.roll_attribute}}}
                    </select>
                </div>
                <div class="form-group"><label>Modificador</label><input type="number" name="roll_modifier" value="{{object.roll_modifier}}"/></div>
                <div class="form-group"><label>Texto Botão</label><input type="text" name="roll_label" value="{{object.roll_label}}"/></div>
            </div>
            {{/if}}
        </div>
        {{/if}}
    </div>
    <footer class="sheet-footer"><button type="submit"><i class="fas fa-save"></i> Salvar Efeito</button></footer>
</form>