<form class="effect-builder-form">

{{!-- SEÇÃO DE BARREIRA DE RESISTÊNCIA (AGORA COMPLETA) --}}
    <div class="form-section">
        <h4 class="section-title">Barreira de Resistência</h4>
        <label class="custom-checkbox">
            <input type="checkbox" name="resistanceRoll.isResisted" {{checked effect.resistanceRoll.isResisted}}/>
            <span>Resistência específica para este efeito</span>
        </label>
        {{#if effect.resistanceRoll.isResisted}}
        <div class="indented">
            <hr>
            {{!-- ✅ CAMPOS QUE FALTAVAM, AGORA PRESENTES ✅ --}}
            <div class="form-grid-2">
                <div class="form-group"><label>Atributo do Teste</label><input type="text" name="resistanceRoll.attribute" value="{{effect.resistanceRoll.attribute}}"/></div>
                <div class="form-group"><label>Modificador</label><input type="text" name="resistanceRoll.modifier" value="{{effect.resistanceRoll.modifier}}"/></div>
            </div>
            <div class="form-group">
                <label>Aplicar efeito se obter:</label>
                <div class="radio-group horizontal">
                    <label class="custom-radio"><input type="radio" name="resistanceRoll.applyOn" value="failure" {{checked (eq effect.resistanceRoll.applyOn 'failure')}}><span>Falha</span></label>
                    <label class="custom-radio"><input type="radio" name="resistanceRoll.applyOn" value="success" {{checked (eq effect.resistanceRoll.applyOn 'success')}}><span>Sucesso</span></label>
                </div>
            </div>
            <div class="form-group">
                <label>Margem Mínima</label>
                <input type="text" name="resistanceRoll.margin" value="{{effect.resistanceRoll.margin}}" placeholder="Opcional"/>
            </div>
        </div>
        {{/if}}
    </div>

    {{!-- SEÇÃO PRINCIPAL DE CONFIGURAÇÃO --}}
    <div class="form-section">
        <h4 class="section-title">Configuração do Efeito</h4>

        <div class="form-row">
            <label class="row-label">Tipo de Efeito:</label>
            <select name="type">
                <option value="attribute" {{#if (eq effect.type 'attribute')}}selected{{/if}}>Atributo</option>
                <option value="status" {{#if (eq effect.type 'status')}}selected{{/if}}>Status</option>
                <option value="chat" {{#if (eq effect.type 'chat')}}selected{{/if}}>Mensagem de Chat</option>
                <option value="macro" {{#if (eq effect.type 'macro')}}selected{{/if}}>Macro</option>
                <option value="flag" {{#if (eq effect.type 'flag')}}selected{{/if}}>Flag</option>
            </select>
        </div>
        <hr>

        {{!-- CAMPOS CONDICIONAIS --}}
        {{#if (eq effect.type 'attribute')}}
            <div class="form-grid-3">
                <div class="form-group">
                    <label>Caminho</label>
                    <div class="input-group">
                        <input type="text" name="path" value="{{effect.path}}"/>
                        <a class="button open-attribute-picker" title="Selecionar Atributo"><i class="fas fa-list"></i></a>
                    </div>
                </div>
                <div class="form-group"><label>Operação</label><input type="text" name="operation" value="{{effect.operation}}"/></div>
                <div class="form-group">
                    <label>Valor</label>
                    <div class="input-group">
                        <input type="text" name="value" value="{{effect.value}}"/>
                        <a class="button open-value-help" title="Ajuda de Fórmulas"><i class="fas fa-question-circle"></i></a>
                    </div>
                </div>
            </div>
        {{/if}}

        {{#if (eq effect.type 'status')}}
            <div class="form-group">
                <label>Ícone de Status</label>
                <select name="statusId">
                    {{selectOptions statusEffects selected=effect.statusId}}
                </select>
            </div>
        {{/if}}

        {{#if (eq effect.type 'macro')}}
            <div class="form-group">
                <label>Nome da Macro</label>
                <input type="text" name="value" value="{{effect.value}}"/>
            </div>
        {{/if}}

{{#if (eq effect.type 'chat')}}
    <div class="form-group"><label>Texto da Mensagem</label><textarea name="chat_text" rows="3">{{effect.chat_text}}</textarea></div>
    <div class="form-group">
        <label>Mensagem: </label>
        <select name="whisperMode">
            <option value="public" {{#if (eq effect.whisperMode "public")}}selected{{/if}}>Pública</option>
            <option value="gm" {{#if (eq effect.whisperMode "gm")}}selected{{/if}}>Apenas para o Mestre</option>
            <option value="blind" {{#if (eq effect.whisperMode "blind")}}selected{{/if}}>Privada (GM não vê)</option>
        </select>
    </div>
    <label class="custom-checkbox"><input type="checkbox" name="has_roll" {{checked effect.has_roll}}/><span>Incluir Teste?</span></label>
    {{#if effect.has_roll}}
        <div class="form-grid-3 indented">
            <div class="form-group"><label>Rótulo do Teste</label><input type="text" name="roll_label" value="{{effect.roll_label}}"/></div>
            <div class="form-group"><label>Atributo</label><input type="text" name="roll_attribute" value="{{effect.roll_attribute}}"/></div>
            <div class="form-group"><label>Modificador</label><input type="text" name="roll_modifier" value="{{effect.roll_modifier}}"/></div>
        </div>
    {{/if}}
{{/if}}

        {{#if (eq effect.type 'flag')}}
            <div class="form-grid-2">
                <div class="form-group"><label>Chave (Key)</label><input type="text" name="key" value="{{effect.key}}"/></div>
                <div class="form-group"><label>Valor</label><input type="text" name="value" value="{{effect.value}}"/></div>
            </div>
        {{/if}}
    </div>

    {{!-- SEÇÃO DE DESCRIÇÃO --}}
    <div class="form-section">
        <h4 class="section-title">Descrição Resumida (para a Tag)</h4>
        <textarea name="chat_description" rows="3">{{effect.chat_description}}</textarea>
    </div>

    {{!-- BOTÃO DE SALVAR NO RODAPÉ --}}
    <footer class="sheet-footer">
        <button type="submit"><i class="fas fa-save"></i> Salvar Efeito</button>
    </footer>
</form>