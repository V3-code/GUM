<form class="{{cssClass}} gum-item-sheet condition-sheet" autocomplete="off">

    {{!-- CABEÇALHO SIMPLIFICADO --}}
    <header class="sheet-header item-header">
        <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}"/>
        <div class="header-fields">
            <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="Nome da Condição"/></h1>
        </div>
    </header>

<main class="sheet-body">

    {{!-- 1. NAVEGAÇÃO DAS ABAS --}}
    <nav class="sheet-tabs tabs">
        <a class="item active" data-tab="detalhes">Detalhes</a>
        <a class="item" data-tab="ativacao">Ativação</a>
        <a class="item" data-tab="efeitos">Efeitos</a>
    </nav>

    {{!-- 2. CORPO DO CONTEÚDO DAS ABAS --}}
    <div class="sheet-body-content">

        {{!-- ABA DE DETALHES --}}
        <div class="tab active" data-tab="detalhes">
            <div class="condition-body-grid">
                <div class="condition-column-left">
                    {{!-- SEÇÃO DE CLASSIFICAÇÃO --}}
                        <div class="form-section">
                            <h4 class="section-title">Classificação</h4>
                            <div class="radio-group">
                                
                                {{!-- Opção 1: Condição Padrão --}}
                                <label class="custom-radio" title="Para regras globais e estados persistentes definidos pelo mestre (Ex: Choque, Cambaleando).">
                                    <input type="radio" name="system.category" value="general" {{checked (eq system.category 'general')}}>
                                    <span>Condição Padrão</span>
                                </label>

                                {{!-- Opção 2: Condição Temporária --}}
                                <label class="custom-radio" title="Um estado temporário, geralmente de curta duração e aplicado em situações como o combate.">
                                    <input type="radio" name="system.category" value="temporary" {{checked (eq system.category 'temporary')}}>
                                    <span>Condição Temporária</span>
                                </label>

                            </div>
                        </div>
                    {{!-- SEÇÃO DE DURAÇÃO E EXPIRAÇÃO --}}
                        <div class="form-section">
                            <h4 class="section-title">Duração e Expiração</h4>
                            
                            <div class="duration-grid">
                                
                                {{!-- Linha 1: Duração, Input e Unidade agrupados --}}
                                <div class="duration-inline-group">
                                    <label class="grid-label">DURAÇÃO:</label>
                                    <div class="input-group">
                                        <input class="duration-value" type="number" name="system.duration.value" value="{{system.duration.value}}" min="0" placeholder="0"/>
                                        <select name="system.duration.unit">
                                            <option value="unlimited" {{#if (eq system.duration.unit "unlimited")}}selected{{/if}}>Ilimitada</option>
                                            <option value="rounds" {{#if (eq system.duration.unit "rounds")}}selected{{/if}}>Rodadas</option>
                                            <option value="seconds" {{#if (eq system.duration.unit "seconds")}}selected{{/if}}>Segundos</option>
                                            <option value="minutes" {{#if (eq system.duration.unit "minutes")}}selected{{/if}}>Minutos</option>
                                            <option value="hours" {{#if (eq system.duration.unit "hours")}}selected{{/if}}>Horas</option>
                                        </select>
                                    </div>
                                </div>

                                {{!-- Linha 2: Opções de Expiração --}}
                                <div class="expiration-group">
                                    <label class="grid-label">AO EXPIRAR:</label>
                                    <div class="radio-group horizontal">
                                        <label class="custom-radio" title="O item será removido permanentemente da ficha do ator.">
                                            <input type="radio" name="system.duration.expiration" value="delete" {{checked (eq system.duration.expiration 'delete')}}>
                                            <span>Deletar Item</span>
                                        </label>
                                        <label class="custom-radio" title="O item será desativado (marcado com um cadeado na ficha do ator), mas não removido.">
                                            <input type="radio" name="system.duration.expiration" value="disable" {{checked (eq system.duration.expiration 'disable')}}>
                                            <span>Desativar Item</span>
                                        </label>
                                    </div>
                                </div>

                                {{!-- Linha 3: Checkbox de Combate alinhado à esquerda --}}
                                <label class="custom-checkbox hint combat-checkbox-row">
                                    <input type="checkbox" name="system.duration.inCombat" {{checked system.duration.inCombat}}/>
                                    <span>Duração contada apenas em combate.</span>
                                </label>

                            </div>
                        </div>
                

               
                        {{!-- SEÇÃO DE DESCRIÇÃO --}}
                        <div class="form-section">
                            
                                <h4 class="section-title">Descrição</h4>
                                <a class="edit-text-btn" data-target="system.description" title="Editar Descrição"><i class="fas fa-edit"></i></a>
                        
                            <div class="rendered-text">
                                {{{enrichedDescription}}}
                            </div>
                        </div>
                </div>
            </div>
        </div>

        {{!-- ABA DE ATIVAÇÃO --}}
        <div class="tab" data-tab="ativacao">
            {{!-- SEÇÃO DE GATILHO DE ATIVAÇÃO --}}
                <div class="form-section">
                    <h4 class="section-title">Gatilho de Ativação</h4>
                    <p class="hint">Regra para aplicar os efeitos. Deixe em branco para ser incondicional.</p>
                    <div class="condition-input-area">
                    <textarea name="system.when" rows="4" placeholder="ex: actor.system.attributes.hp.value <= 10">{{system.when}}</textarea>
                       <div class="button-group">
                            <a class="button saved-triggers-btn" title="Buscar Gatilho Salvo">
                                <i class="fas fa-bookmark"></i>
                                Gatilhos Salvos
                            </a>
                            <a class="button condition-assistant-btn" title="Assistente de Condições">
                                <i class="fas fa-magic"></i>
                                Assistente de Construção
                            </a>
                        </div>
                    </div>
                </div>
        </div>

{{!-- ABA DE EFEITOS (VERSÃO FINAL COM DESIGN SOLICITADO) --}}
<div class="tab" data-tab="efeitos">

    {{!-- Barra de Ferramentas --}}
    <div class="effects-toolbar">
        <a class="button add-effect"><i class="fas fa-plus"></i> Adicionar Efeito</a>
    </div>

    {{!-- Container da Lista de Efeitos --}}
    <div class="form-section">
        <ol class="effects-list">
            {{#each preparedEffects as |effect|}}
                <li class="effect-tag" data-effect-index="{{effect.index}}" data-effect-uuid="{{effect.uuid}}">
                    
                    {{!-- Informações do Efeito, clicáveis para visualizar --}}
                    <a class="effect-info view-effect" title="Clique para ver o Item Efeito original">
                        <span class="effect-type">{{capitalize effect.type}}</span>
                        <span class="effect-divider">|</span>
                        
                        <span class="effect-name">{{effect.name}}</span>

                        {{#if effect.chat_description}}
                            <span class="effect-divider">|</span>
                            <span class="effect-summary-text">"{{effect.chat_description}}"</span>
                        {{/if}}
                    </a>

                    {{!-- Controles do Efeito (Visualizar e Deletar) --}}
                    <div class="effect-controls">
                        <a class="view-effect" title="Ver Item Efeito Original"><i class="fas fa-eye"></i></a>
                        <a class="delete-effect" title="Remover Link do Efeito"><i class="fas fa-trash"></i></a>
                    </div>

                </li>
            {{else}}
                <li class="placeholder-text">
                    <p>Nenhum efeito vinculado.</p>
                </li>
            {{/each}}
        </ol>
    </div>

</div>

    </div>
</main>

</form>