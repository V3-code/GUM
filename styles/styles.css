/* =================================================================== */
/* GUM - TEMA "ÉBANO E OURO" - VERSÃO CONSOLIDADA E REFINADA           */
/* =================================================================== */

/* --- 1. IMPORTAÇÃO DAS FONTES --- */
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@300;400;500;700&display=swap');

/* --- 2. PALETA DE CORES, FONTES E TAMANHO BASE --- */

/* =================================================================== */
/* TEMA VISUAL GLOBAL DO SISTEMA GUM                                   */
/* =================================================================== */
:root {
  /* Fontes Globais */
  --font-primary: 'Roboto', sans-serif;
  --font-secondary: 'Cinzel', serif;

  /* Paleta de Cores Principal (Tema Escuro) */
  --c-bg-darkest: #191813;
  --c-bg-dark: #2b2a29;
  --c-bg-medium: #3a3836;
  --c-text-lightest: #f0f0e8;
  --c-text-medium: #a9a6a0;
  --c-border-light: #4a4846;

  /* Paleta de Cores de Destaque (Acento) */
  --c-accent-gold: #c5a05b;
  --c-accent-red: #a53541;
  --c-accent-green: #389c68;
  --c-accent-blue: #56819c;
  --c-border-accent: var(--c-accent-gold); /* Usa a cor dourada como borda de destaque */
  --c-text-accent: var(--c-accent-gold);
}

.gum.sheet.actor {
  /* Paleta de Cores */
  --c-fundo-principal: #1a1a1a;
  --c-fundo-painel: rgba(26, 26, 26, 0.75);
  --c-fundo-input: rgba(0,0,0,0.3);
  --c-texto-principal: #dcdcdc;
  --c-texto-secundario: #a0a0a0;
  --c-acento-dourado: #c5a56a;
  --c-borda-dourada: rgba(197, 165, 106, 0.4);
  --c-borda-escura: #111;

  /* Novas Cores */
   --c-fundo-papiro: #f1e8e7;
  --c-fundo-card-claro: #f8f4f1;
  --c-fundo-cabecalho: #34161b;
  --c-fundo-sidebar: #313131;
  --c-texto-escuro: #352425;
  --c-texto-claro: #f8f4f1;
  --c-texto-subtitulo: #977c63;
  --c-acento-principal: #9f9275;
  --c-borda: #dacdca;
  --c-sombra: rgba(53,36,37,0.4);
  --c-hp-bar: #3b7d3b;
  --c-pf-bar: #3b5a7d;
  --c-fundo-input: rgba(0,0,0,0.05); /* Fundo sutil para inputs em tema claro */
  
  --c-texto-escuro: #352425;
  --c-texto-claro: #f8f4f1;
  --c-texto-subtitulo: #977c63;

  --c-acento: #9f9275; /* O "dourado/bronze" principal */

  --c-sombra: rgba(53,36,37,0.4);

  /* Cores de Destaque Adicionais */
  --c-acento-vermelho: #72252e;  /* Cor para o medidor de carga ativo */
  --c-acento-verde: #389c68;   /* Cor para PV */
  --c-acento-azul: #56819c;    /* Cor para PF */

  /* Famílias de Fontes */
  --f-titulos: 'Cinzel', serif;
  --f-corpo: 'Roboto', sans-serif;
  
  
  /* Tamanho Base da Fonte */
  font-size: 13px; 

}

/* --- 3. ESTRUTURA E FUNDO GERAL --- */
.gum.sheet.actor .sheet-grid {
  display: grid;
  position: relative;
  grid-template-columns: 250px 1fr; /* 2 colunas: sidebar e principal */
  grid-template-rows: auto 1fr;
  grid-template-areas:
    "header header"
    "sidebar main";
  height: 100%;
  background: var(--c-fundo-papiro);
  color: var(--c-texto-escuro);
  font-family: var(--f-corpo);
  /* O 'gap' e 'padding' foram removidos daqui para um controle mais fino */
}

/* AUMENTO DO BANNER DA FICHA - DEPENTE DO POSITION:RELATIVE em cada outra área para ficar acima do banne */
.gum.sheet.actor .sheet-grid::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  
  /* ESTA É A ALTURA DO BANNER */
  height: 125px; 
  
  background: var(--c-fundo-cabecalho); /* Usa a cor do cabeçalho */
  z-index: 0; /* Garante que ele fique na camada mais baixa */
}

/* 3.1 Atribuição das áreas do grid */
.sheet-header { grid-area: header; }
.sheet-sidebar { grid-area: sidebar; }
.sheet-main-area { grid-area: main; }

/* 3.1.1 CABEÇALHO */
.sheet-header {
  position: relative;
  background: var(--c-fundo-cabecalho);
  color: var(--c-texto-claro);
  padding: 0.5rem 1.5rem;
 
}



/* 3.1.1 ÁREA PRINCIPAL */
.sheet-main-area {
  display: grid;
  grid-template-rows: auto auto 1fr; /* Atributos, Abas, Conteúdo */
  gap: 1rem;
  padding: 0.5rem;
  overflow: hidden;
}



/* --- 4. ESTILO UNIFICADO PARA BLOCOS/CARDS FLUTUANTES --- */


.block-header, .column-header, .block-title, .equipment-header h3 {
  font-family: var(--f-titulos);
  color: var(--c-acento-dourado);
  font-weight: 700;
  font-size: 12px;
  margin: 0 0 0.25rem 0;
  padding-bottom: 0.1rem;
  border-bottom: 1px solid var(--c-borda-dourada);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
/* ========================================================== */
/* ESTILO ESPECÍFICO PARA INPUTS DE ITEM (TEMA ESCURO)        */
/* ========================================================== */

.gum.sheet.item input[type="text"],
.gum.sheet.item input[type="number"],
.gum.sheet.item select,
.gum.sheet.item textarea {
    color: #e1e1e1; /* Cor do texto (Claro) */
    background-color: rgba(0, 0, 0, 0.2); /* Fundo escuro translúcido */
    border: 1px solid rgba(255, 255, 255, 0.15); /* Borda sutil */
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

/* Efeito de foco para dar destaque quando o usuário clica */
.gum.sheet.item input:focus,
.gum.sheet.item select:focus,
.gum.sheet.item textarea:focus {
    border-color: var(--c-accent-gold, #c5a05b);
    box-shadow: 0 0 5px rgba(197, 160, 91, 0.3);
    outline: none;
}

/* Correção para inputs desabilitados (como os pontos automáticos) */
.gum.sheet.item input:disabled {
    color: #777;
    background-color: rgba(0, 0, 0, 0.4);
    border-color: transparent;
    cursor: not-allowed;
}
.item-row, .attack-item, .bond-row, .meter-card, .table-row, .detail-item, .social-block > .item-list > .item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.4rem 0.15rem;
  border-bottom: 1px solid var(--c-borda);
}
.item-row:last-child, .attack-item:last-child, .meter-card:last-child, .table-row:last-child, .detail-item:last-child, .social-block > .item-list > .item:last-child {
  border-bottom: none;
}
.item-name { flex-grow: 1; }
.item-controls { display: flex; gap: 0.5rem; margin-left: auto; }
a { color: var(--c-acento-dourado); text-decoration: none; }
a:hover { text-decoration: underline; color: #fff; }

/* =================================================================== */
/* ESTILOS ESPECÍFICOS (AJUSTES FINOS)                                 */
/* =================================================================== */

/* --- CABEÇALHO PRINCIPAL --- */
.sheet-header { padding: 0.75rem 1rem; }
.header-grid { display: flex; justify-content: space-between; align-items: center; gap: 1.5rem; }
.char-name-input { margin-bottom: 10px; color: var(--c-acento-dourado); font-family: var(--f-titulos); font-size: 1.8rem; border: none !important; background: transparent !important; }
.char-concept-input { font-size: 0.9rem; font-style: italic; color: var(--c-texto-secundario); border: none !important; background: transparent !important; margin-top: -5px; }
.points-cluster { display: flex; gap: 1rem; }
.points-display { flex-direction: column; text-align: center; }
.points-display.total-points { padding-right: 1rem; border-right: 1px solid var(--c-borda-dourada); }
.points-display label { font-family: var(--f-titulos); font-size: 0.6rem; text-transform: uppercase; color: var(--c-texto-secundario); }
.points-display input { font-size: 0.8rem; font-weight: 600; width: 60px; border: none !important; background: transparent !important; color: var(--c-texto-principal); }


/* =================================================================== */
/* ETAPA DE DESIGN - PAINEL DE ATRIBUTOS (VERSÃO BRASÃO RESTAURADA)    */
/* =================================================================== */

.sheet-mini-header {
  padding: 0.5rem 0;
}
.primary-attributes-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1.5rem;
}

/* O "brasão" de cada atributo individual */
.attribute-box {
  position: relative;
  background: var(--c-fundo-principal);
  border: 1px solid var(--c-acento-dourado);
  width: 80px;
  height: 80px;
  padding: 0.3rem 0.5rem 0.7rem;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 5px;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
}

/* O rótulo do atributo (ST, DX, etc.) */
.attribute-box label {
  font-family: 'Roboto';
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--c-acento-dourado);
  cursor: pointer; /* Adicionado para indicar que é clicável */
}
.attribute-box label:hover {
    text-shadow: 0 0 5px #fff;
}

/* O valor principal (base) do atributo */
.attribute-box .attribute-value {
  font-family: 'Roboto', sans-serif;
  font-size: 1.4rem; 
  font-weight: 700;
  color: var(--c-texto-principal);
  border: none !important;
  background: transparent !important;
  text-align: center;
  line-height: 1.2;
  width: 100%;
}

/* O modificador FIXO (.mod) */
.attribute-box .attribute-modifier {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translate(-50%, 50%);
  font-size: 0.8rem;
  width: 75%;
  max-width: 50px;
  border-radius: 10px;
  border: 1px solid #444 !important;
  background-color: var(--c-fundo-sidebar) !important;
  padding: 2px;
  color: var(--c-texto-principal);
  text-align: center;
}

/* Remove o sublinhado do link principal do "brasão" */
.attribute-box a.rollable:hover {
    text-decoration: none;
}

/* Aplica um brilho sutil ao RÓTULO (ST, DX, etc.) quando o mouse está sobre o brasão */
.attribute-box a.rollable:hover label {
    color: #fff; /* Deixa o texto um pouco mais brilhante */
    text-shadow: 0 0 8px var(--c-acento-dourado); /* ✅ Adiciona um brilho dourado sutil */
    transition: all 0.2s ease;
}

/* =================================================================== */
/* DESIGN DAS ABAS DE NAVEGAÇÃO (HORIZONTAL COM ÍCONES)                */
/* =================================================================== */


/* O container da navegação das abas */
.gum.sheet.actor nav.sheet-tabs {
  grid-row: 2; /* Garante que fique na segunda linha da área principal */
  display: flex;
  justify-content: space-between; /* Alinha as abas à esquerda */
  gap: 0.5rem;
  border: 1px solid var(--c-borda-dourada);
  padding: 0;
  
}

/* Cada ícone de aba */
.gum.sheet.actor .sheet-tabs .item {
  flex: 0 0 auto;
  color: var(--c-fundo-cabecalho);
  padding: 0;
  width: 42px;
  height: 38px;
  display: grid;
  place-items: center;
  border-bottom: 3px solid transparent;
  border-radius: 3px 3px 0 0;
  transition: all 0.2s ease;
}

.gum.sheet.actor .sheet-tabs .item i {
  font-size: 1rem;
}

.gum.sheet.actor .sheet-tabs .item:hover {
  color: #fff;
  background: var(--c-fundo-input);
}

/* Estilo da aba ativa */
.gum.sheet.actor .sheet-tabs .item.active {
  color: var(--c-acento-dourado);
  border-bottom-color: var(--c-acento-dourado);
  background: var(--c-fundo-painel);
}


/* --- "TAGS" DE STATUS --- */
.attack-details-row .stat,
.spell-details-row .stat,
.equipment-row .item-stats .stat {
  background: var(--c-fundo-input);
  border: 1px solid #444;
  border-left: 3px solid var(--c-acento-dourado);
  color: var(--c-texto-principal);
  padding: 0.2rem 0.5rem;
  border-radius: 3px;
  font-size: 0.8rem;
}
.attack-details-row .stat label,
.spell-details-row .stat label {
  color: var(--c-texto-secundario);
  margin-right: 0.3rem;
}

/* --- ABA SOCIAL --- */
.social-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
.social-block-fullwidth { margin-top: 1rem; }


/* =================================================================== */
/* GUM - SIDEBAR "MEDALHÃO CIRCULAR" (VERSÃO FINAL V4)                 */
/* =================================================================== */

/* 1. CONTAINER */
.sheet-sidebar {
    position: relative; z-index: 2; margin-top: 0; padding: 0 5px; 
    background: transparent; pointer-events: none; 
}

.sidebar-design-container {
    background: rgba(20, 20, 20, 0.95); 
    border: 1px solid var(--c-borda-dourada);
    border-radius: 4px;
    padding: 10px;
    min-height: 40rem;
    display: flex; flex-direction: column; 
    gap: 10px; 
    pointer-events: all;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    color: #ececec; 
}
.sidebar-block { background: none; border: none; padding: 0; margin: 0; }

/* 2. FOTO */
.profile-block { display: flex; justify-content: center; margin-bottom: 0; position: relative; z-index: 1; }
.profile-img {
    width: 100%; max-width: 180px; height: auto; max-height: 200px;
    object-fit: cover; object-position: top;
    border: 1px solid var(--c-acento-dourado); border-radius: 2px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5);
}

/* 3. CARD DE CARGA E ESQUIVA (MEDALHÃO CIRCULAR) */
.encumbrance-dodge-bar {
    display: flex; justify-content: space-between; align-items: center;
    background: rgba(0,0,0,0.4); 
    border: 1px solid rgba(197, 160, 91, 0.2);
    border-radius: 3px; padding: 4px 0; margin-bottom: 5px; position: relative;
    margin-top: -20px; z-index: 10; box-shadow: 0 -4px 10px rgba(0,0,0,0.5);
}

/* Colunas */
.enc-col { display: flex; flex-direction: column; justify-content: center; height: 45px; }
.left-col { align-items: center; width: 38%; text-align: center; }
.right-col { align-items: center; width: 38%; text-align: center; }
.center-col { width: 24%; align-items: center; position: relative; }

.enc-label {
    font-family: 'Roboto', sans-serif; font-size: 9px; text-transform: uppercase; 
    color: var(--c-texto-secundario); font-weight: 700; white-space: nowrap;
}
.enc-label.link { cursor: pointer; border-bottom: 1px dotted rgba(197, 160, 91, 0.5); }
.enc-label.link:hover { color: var(--c-acento-dourado); border-bottom-style: solid; }
.enc-val {
    font-family: 'Roboto', sans-serif; font-size: 11px; font-weight: 700; color: #fff; white-space: nowrap; 
}

/* Badge Circular (Medalhão) */
.badge-wrapper {
    position: relative; width: 60px; height: 60px;
    display: grid; place-items: center;
    background: #161616; /* Fundo escuro para tapar o card */
    border-radius: 50%; /* Círculo Perfeito */
    box-shadow: 0 0 10px rgba(0,0,0,0.8); /* Sombra ao redor */
    z-index: 10;
}
.dodge-badge-svg { position: absolute; width: 100%; height: 100%; }
.dodge-badge-svg .badge-bg { fill: #1f1e1a; } 
.dodge-badge-svg .badge-border { fill: none; stroke: var(--c-acento-dourado); stroke-width: 5; }

.dodge-value {
    position: relative; z-index: 2;
    font-family: 'Roboto', sans-serif; 
    font-size: 1.4rem; /* Tamanho bom para 2 dígitos */
    font-weight: 700;
    color: #fff; text-shadow: 0 0 8px rgba(197, 160, 91, 0.6);
}
.dodge-value:hover { color: #fff; text-decoration: none; }

.badge-label-curved {
    position: absolute; bottom: -6px;
    font-family: 'Roboto Condensed'; font-size: 8px; font-weight: 700; color: var(--c-acento-dourado);
    background: rgba(0,0,0,0.9); padding: 1px 5px; border-radius: 3px;
    border: 1px solid rgba(197, 160, 91, 0.3);
    box-shadow: 0 2px 4px #000;
}

/* 4. CLUSTER, BARRAS E OUTROS (MANTIDOS) */
.stats-cluster {
    background: rgba(0,0,0,0.2); border: 1px solid rgba(197, 160, 91, 0.2);
    border-radius: 4px; padding: 8px;
}
.cluster-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px; padding-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.1);
}
.cluster-title { font-family: 'Cinzel', serif; font-size: 10px; color: var(--c-texto-subtitulo); letter-spacing: 1px; }
.edit-secondary-stats-btn { color: var(--c-texto-subtitulo); font-size: 12px; cursor: pointer; transition: 0.3s; }
.edit-secondary-stats-btn:hover { color: var(--c-acento-dourado); transform: rotate(45deg); }

.dice-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 5px; }
.d6-stat { position: relative; flex: 1; height: 50px; display: flex; justify-content: center; }
.d6-stat.main-d6 { flex: 1.2; height: 60px; }
.d6-face {
    width: 100%; height: 100%;
    background: linear-gradient(145deg, #2b2a29 0%, #191813 100%);
    border: 1px solid var(--c-acento-dourado); border-radius: 4px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.d6-stat:hover .d6-face { border-color: #fff; box-shadow: 0 0 8px var(--c-acento-dourado); }
.d6-val { font-family: 'Roboto', sans-serif; font-size: 1.3rem; font-weight: 700; color: #fff; }
.main-d6 .d6-val { font-size: 1.6rem; color: var(--c-acento-dourado); }
.d6-label { font-family: 'Roboto Condensed', sans-serif; font-size: 8px; font-weight: 700; color: #aaa; margin-top: 0px; text-transform: uppercase; }

.senses-container {
    background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05);
    border-radius: 4px; padding: 5px; display: flex; justify-content: space-between;
}
.sense-box { display: flex; flex-direction: column; align-items: center; width: 25%; cursor: pointer; }
.sense-box:hover a { color: #fff; }
.sense-box a {
    color: var(--c-texto-subtitulo); font-family: 'Roboto Condensed', sans-serif;
    font-size: 9px; font-weight: 700; text-transform: uppercase;
    text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 2px;
}
.sense-box i { font-size: 12px; margin-bottom: 1px; }
.sense-value {
    font-family: 'Roboto', sans-serif; font-size: 11px; font-weight: 700;
    color: #fff; background: rgba(255,255,255,0.1); border: 1px solid #444;
    border-radius: 3px; padding: 0 5px; min-width: 18px; text-align: center; margin-top: 2px;
}

/* Barras */
.bars-block { display: flex; flex-direction: column; gap: 8px; margin-top: 0; }
.bar-group { display: flex; flex-direction: column; gap: 2px; }
.bar-label { display: flex; justify-content: space-between; font-family: 'Roboto', sans-serif; font-size: 10px; font-weight: 700; color: var(--c-texto-secundario); }
.edit-resource-bar { cursor: pointer; opacity: 0.6; color: var(--c-texto-secundario); }
.edit-resource-bar:hover { opacity: 1; color: var(--c-acento-dourado); }
.resource-bar.original-style {
    position: relative; height: 24px; background: #1a1a1a; border: 1px solid #444;
    border-radius: 3px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
}
.bar-fill { position: absolute; left: 0; top: 0; height: 100%; transition: width 0.3s ease; }
.bar-inputs {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center; gap: 2px;
    font-size: 11px; font-weight: 700; color: #fff; text-shadow: 0 1px 2px black; z-index: 2;
}
.bar-inputs input { background: transparent; border: none; color: inherit; text-align: right; width: 30px; font-family: inherit; font-weight: 700; padding: 0; font-size: 11px; }
.bar-inputs .final-max-value { text-align: left; width: 30px; }

/* Sobrevivência */
.sidebar-footer { margin-top: auto; display: flex; flex-direction: column; gap: 5px; }
.collapsible-block { border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 5px; }
.collapsible-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 4px 0; }
.collapsible-header .block-title { font-family: 'Cinzel', serif; font-size: 10px; font-weight: 700; color: var(--c-acento-dourado); margin: 0; }
.collapsible-header .expand-icon { font-size: 10px; color: var(--c-texto-secundario); }
.collapsible-content { overflow: hidden; max-height: 0; transition: max-height 0.3s ease; }
.collapsible-block.active .collapsible-content { max-height: 200px; padding-top: 5px; }
.survival-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.survival-item {
    background: rgba(0,0,0,0.3); border: 1px solid #444; border-radius: 3px; padding: 4px;
    display: flex; flex-direction: column; align-items: center;
}
.survival-item.radiation { border-color: #5a4a20; background: rgba(50, 40, 10, 0.2); }
.survival-item label {
    font-size: 9px; font-weight: 700; color: var(--c-texto-subtitulo); margin-bottom: 2px; text-transform: uppercase;
}
.survival-item label.warning-label { color: #d4a017; }
.counter-wrapper { display: flex; align-items: center; gap: 5px; }
.adjust-survival { color: #777; cursor: pointer; font-size: 10px; transition: 0.2s; }
.adjust-survival:hover { color: #fff; }
.counter-wrapper input {
    width: 30px; text-align: center; background: #111; border: 1px solid #333;
    color: #fff; font-weight: 700; font-size: 12px; border-radius: 2px; height: 18px;
}
/* Inputs Dialog */
.secondary-stats-dialog input[type="number"], .secondary-stats-dialog input[type="text"] {
    background-color: rgba(0, 0, 0, 0.3) !important; color: #fff !important; border: 1px solid #555 !important;
}
.secondary-stats-dialog label { color: #333; }
/* =================================================================== */
/* AJUSTE DE LAYOUT FINAL: ESTRUTURA DA ÁREA PRINCIPAL                 */
/* =================================================================== */

/* Garante que o container do corpo da ficha preencha a 2ª linha do grid */
.sheet-body-content {
  font-weight: 300;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* Controla o overflow para a rolagem acontecer no lugar certo */
}

/* Garante que o conteúdo da aba possa rolar independentemente */
.sheet-body {
  overflow-x: hidden;
  overflow-y: auto;
  
}

/* =================================================================== */
/* DESIGN DA ABA DE COMBATE (TEMA CRÔNICAS DO AVENTUREIRO)              */
/* =================================================================== */

/* Garante que os elementos na aba de combate tenham a cor de texto escura correta */
.tab[data-tab="combat"] {
  font-weight: 400; /* Peso normal do Roboto */
}

/* Os 5 cards de status no topo da aba */
.combat-header-stats {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  justify-content: center;
  gap: 1rem;
  margin-bottom: 1rem; /* Aumenta um pouco a distância para o conteúdo abaixo */
}
.stat-card {
  background: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
  padding: 0.6rem;
  text-align: center;
  
  /* MUDANÇA: Usando flexbox para melhor alinhamento */
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 0.3rem;

  /* MUDANÇA: Adicionando sombreamento e uma leve transição */
  box-shadow: 0 2px 5px rgba(0,0,0,0.07);
  transition: all 0.2s ease-in-out;
}
.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.stat-card label {
  font-family: var(--f-titulos);
  font-size: 0.65rem;
  color: var(--c-texto-subtitulo);
  text-transform: uppercase;
  line-height: 1;
}
.stat-card input, .stat-card .value {
  text-align: center;
  /* MUDANÇA: Fonte reduzida */
  font-size: 1rem; 
  font-weight: 700;
  border: none !important;
  background: transparent !important;
  padding: 0;
  color: var(--c-texto-escuro);
  height: auto; /* Altura automática para melhor ajuste */
}
/* Estilos específicos para os cards interativos */
.stat-card.rd-card .value { font-size: 1.5rem; }
.stat-card.rd-card label, .stat-card.meters-card label { display: flex; justify-content: center; align-items: center; gap: 0.5rem; }
.stat-card.rd-card a, .stat-card.meters-card a { font-size: 0.8rem; color: var(--c-texto-subtitulo); }
.meters-card .value-summary { font-size: 0.8rem; height: auto; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.meters-card .manage-meters { font-size: 0.7rem; font-family: var(--f-titulos); cursor: pointer; }

/* O layout principal de 2 colunas da aba */
.combat-main-content {
  display: grid;
  grid-template-columns: 1fr 1.5fr;
  gap: 1rem;
  align-items: start;
}
.combat-left-column, .combat-right-column {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

/* Estilo unificado para os blocos/cards dentro das abas */
.sheet-body .gum-block {
  background: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  padding: 0.75rem;
  margin-top: 10px;
}
.sheet-body .block-header {
  color: var(--c-texto-escuro);
  border-bottom-color: var(--c-borda);
}
.sheet-body .block-header h4 {
  color: var(--c-texto-escuro);
  font-family: var(--f-titulos);
}

/* Inputs gerais dentro das abas */
.sheet-body input, .sheet-body textarea {
  color: var(--c-texto-escuro);
  background: rgba(0,0,0,0.05);
  border-color: #ccc;
}

/* =================================================================== */
/* DESIGN: CARD DE RD HÍBRIDO (LAYOUT CORRIGIDO)                       */
/* =================================================================== */

/* O container principal do novo card */
.stat-card.rd-hybrid-card {
  /* MUDANÇA: Usamos flex para alinhar os itens lado a lado */
  display: flex;
  flex-direction: row; /* Garante o alinhamento horizontal */
  align-items: center; /* Centraliza as duas seções verticalmente */
  
  padding: 0; /* Removemos o padding do container principal */
  grid-column: span 2; /* Faz este card ocupar o espaço de dois cards normais */
}

/* A seção principal à esquerda (RD Torso) */
.rd-main-display {
  position: relative;
  flex-basis: 75px; /* Largura fixa para a parte principal */
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 0.5rem;
  border-right: 1px solid var(--c-borda);
  height: 100%; /* Ocupa toda a altura do card pai */
}
.rd-main-display .value {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--c-texto-escuro);
  line-height: 1.2;
}
.rd-main-display label {
  position: relative;
  width: 100%;
  text-align: center;
}
.rd-main-display .view-hit-locations {
  position: absolute;
  top: -4px;
  right: -2px;
  font-size: 0.7rem;
  color: var(--c-texto-subtitulo);
}

/* A lista de detalhes à direita */
.rd-details-list {
  flex-grow: 0.5;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  gap: 4px;
  padding: 0 0.3rem 0.3rem 0.3rem; /* Adiciona espaçamento interno */
  font-size: 0.6rem;
  color: var(--c-texto-subtitulo);
}
.rd-detail-row {
  display: flex;
  justify-content: flex;
  gap: 0.5rem; /* Adiciona espaço entre os itens da mesma linha */
}
.rd-detail-row strong {
  color: var(--c-texto-escuro);
  font-weight: 700;
}

/* =================================================================== */
/* DESIGN: JANELA DE DIÁLOGO DA TABELA DE RD (v2 - Papiro)             */
/* =================================================================== */

.gurps-rd-dialog .dialog-content {
    padding: 0; 
    background: #fdfaf8; /* Fundo papiro */
}

/* Container principal da tabela */
.gurps-rd-table {
    font-family: 'Roboto', sans-serif;
    color: #352425;
}

/* Define a grade de 5 colunas */
.gurps-rd-table .table-header,
.gurps-rd-table .table-row {
    display: grid;
    /* Colunas: Local, Armadura, Temp, Manual, Total */
    grid-template-columns: 3fr 1.5fr 1.5fr 3fr 3fr;
    align-items: center;
    padding: 0 10px;
}

/* Estilo do cabeçalho da tabela (tema escuro, como no seu original) */
.gurps-rd-table .table-header {
    background: #34161b;
    font-weight: bold;
    font-family: 'Cinzel', serif;
    border-bottom: 1px solid #c9b9b4;
}
.gurps-rd-table .table-header > div {
    padding: 8px 5px;
    text-align: center;
    color: #f8f4f1;
    font-size: 11px; /* Fonte menor */
}

/* Corpo da tabela */
.gurps-rd-table .table-body {
    padding: 5px 0;
}

/* Células da tabela */
.gurps-rd-table .table-row > div {
    padding: 4px 5px; /* Mais compacto */
    text-align: center;
    border-bottom: 1px solid #f0ebe8;
    font-size: 12px; /* Fonte menor */
}
.gurps-rd-table .table-row .loc-label {
    text-align: left;
    font-weight: bold;
}

/* Efeito "zebrado" */
.gurps-rd-table .table-row:nth-child(even) {
    background-color: #f8f4f1;
}

/* ✅ CORREÇÃO DO INPUT (de number para text) */
.gurps-rd-table input[type="text"] {
    width: 100%; /* Ocupa toda a coluna */
    padding: 4px;
    border: 1px solid #c9b9b4;
    border-radius: 3px;
    background: #fff;
    text-align: center;
    font-size: 12px; /* Fonte menor */
    font-family: 'Roboto', sans-serif;
}
.gurps-rd-table input[type="text"]:focus {
    outline: none;
    border-color: #3a506b;
    box-shadow: 0 0 3px rgba(58, 80, 107, 0.5);
}

/* Colunas de "Total" e "Temp" (read-only) */
.gurps-rd-table .loc-rd-total strong {
    font-size: 12px;
    color: #a53541;
}
.gurps-rd-table .loc-rd-temp,
.gurps-rd-table .loc-rd-armor {
    font-size: 11px;
    color: #6d6666; /* Cor sutil para dados não-editáveis */
}

/* =================================================================== */
/* DESIGN: REGISTROS DE COMBATE (CARDS HORIZONTAIS)                    */
/* =================================================================== */

/* MUDANÇA: A lista agora usa flexbox para alinhar os cards lado a lado */
.meter-list {
  display: flex;
  flex-wrap: wrap; /* Permite que os cards quebrem a linha */
  gap: 0.5rem;     /* Espaço entre os cards */
}

/* MUDANÇA: Cada card agora tem um tamanho flexível para caber na linha */
.meter-card {
  flex: 1 1 150px; /* Permite crescer, encolher, com base de 150px */
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  background: rgba(0,0,0,0.05);
  border: 1px solid var(--c-border);
  border-radius: 3px;
  padding: 0.4rem 0.6rem;
}

.meter-card .item-name {
  font-family: var(--f-corpo);
  font-size: 0.8rem;
  font-weight: 400;
  flex-grow: 1; /* Faz o nome ocupar o espaço disponível */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis; /* Adiciona "..." se o nome for muito longo */
}

.meter-card .meter-inputs {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  flex-shrink: 0; /* Impede que os inputs encolham */
}

.meter-card input {
  width: 35px; /* Inputs menores */
  font-size: 0.9rem;
  padding: 2px;
  text-align: center;
}

/* =================================================================== */
/* DESIGN: LISTA DE ATAQUES ANINHADA (VERSÃO REFINADA)                 */
/* =================================================================== */

.attacks-list-box .block-header a {
  font-size: 0.8rem;
  font-family: var(--f-corpo);
  text-transform: uppercase;
  font-weight: 700;
}

.attack-group-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.attack-group-card {
  background: rgba(0,0,0,0.02);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
  padding: 0.5rem 0.75rem;
}

.attack-group-card .group-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--c-borda);
  padding-bottom: 0.5rem;
  margin-bottom: 0.5rem;
}

/* MUDANÇA: Tamanho do título do grupo reduzido */
.attack-group-card .group-name {
  font-family: var(--f-titulos);
  font-size: 1rem;
  font-weight: 700;
}

.attacks-in-group {
  list-style: none;
  padding: 0;
  margin: 0;
}

/* Linha de cada ataque individual */
.attack-item .attack-type-icon {
  color: var(--c-texto-subtitulo);
}

.attack-item .attack-main-info {
  flex-grow: 1;
}

.attack-item .attack-name-row {
  font-size: 0.9rem;
  font-weight: 500;
}
.attack-item .attack-name-row small {
  color: var(--c-texto-subtitulo);
  font-size: 0.8em;
}

/* MUDANÇA: Container das tags agora quebra a linha */
.attack-details-row {
  display: flex;
  flex-wrap: wrap; /* Impede a sobreposição */
  gap: 0.4rem;
  margin-top: 0.25rem;
}

/* MUDANÇA: Novo design para as "tags" no tema claro */
.attack-details-row .stat {
  background: rgba(0,0,0,0.04);
  border: 1px solid rgba(0,0,0,0.1);
  color: var(--c-texto-escuro);
  border-left: 3px solid var(--c-texto-subtitulo);
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.8rem;
}
.attack-details-row .stat label {
  color: var(--c-texto-subtitulo);
  margin-right: 0.3rem;
  font-weight: 700;
}

.add-attack-footer {
  text-align: right;
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  border-top: 1px dashed var(--c-borda);
}
.add-attack-footer a {
  font-size: 0.8rem;
  font-weight: 700;
}
 
/* =================================================================== */
/* DESIGN: ABA DE PERÍCIAS (LAYOUT FINAL E REFINADO)                   */
/* =================================================================== */

/* Layout de 2 colunas com proporção ajustada */
.skills-layout-container {
  display: grid;
  grid-template-columns: 1.5fr 1fr; /* Coluna da esquerda ~60%, Direita ~40% */
  gap: 1rem;
  align-items: start;
}

/* Coluna da direita com blocos e espaçamento reduzido */
.skill-side-column {
  display: flex;
  flex-direction: column;
  gap: 0.25rem; /* MUDANÇA: Distância entre os blocos diminuída */
}

/* Estilo padrão para todos os blocos de perícia */
.tab[data-tab="skills"] .gum-block {
  background: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  padding: 0.75rem;
}

/* Cabeçalhos de bloco menores, especialmente na coluna da direita */
.skill-side-column .block-header input {
  font-size: 0.9rem !important;
}

.tab[data-tab="skills"] .item-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem; /* Espaço entre cada linha de perícia */
}

/* Estilo para cada linha de perícia */
.tab[data-tab="skills"] .skill-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0;
  border: none;
  font-size: 12px
}

/* A "tag" do nome da perícia */
.tab[data-tab="skills"] .skill-name-tag {
  background: rgba(0,0,0,0.03);
  border: 1px solid var(--c-borda);
  padding: 4px 8px;
  border-radius: 3px;
  font-weight: 700;
  flex-grow: 1; /* Faz o nome ocupar o espaço disponível */
}

/* O container para as tags de detalhes (Atributo e NH) */
.tab[data-tab="skills"] .skill-details {
  display: flex;
  gap: 0.5rem;
  flex-shrink: 0; /* Impede que encolham */
  
}

/* Estilo de "tag" para Atributo e NH */
.tab[data-tab="skills"] .skill-details .stat {
  display: inline-block;
  background: rgba(0,0,0,0.03);
  border: 1px solid var(--c-borda);
  padding: 4px 8px;
  border-radius: 3px;
  font-size: 10px;
  color: var(--c-texto-subtitulo);
}
.tab[data-tab="skills"] .skill-details a.stat {
  font-weight: 700;
  color: var(--c-texto-escuro);
  font-size: 10px
}
.tab[data-tab="skills"] .skill-details a.stat:hover {
  border-color: var(--c-texto-subtitulo);
  text-decoration: none;
}

/* Ícones de controle menores */
.tab[data-tab="skills"] .item-control {
  font-size: 10px;
}


/* =================================================================== */
/* ESTILO CORRIGIDO PARA O MENU DE CONTEXTO                            */
/* =================================================================== */
.custom-context-menu {
  display: none;
  position: fixed;
  z-index: 100;
  background-color: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  padding: 5px 0;
  width: 200px;
}
.custom-context-menu .context-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--c-texto-escuro);
}
.custom-context-menu .context-item:hover {
  background-color: rgba(0,0,0,0.05);
  color: var(--c-acento-vermelho);
}

/* =================================================================== */
/* DESIGN: RESERVAS DE ENERGIA (ESTILO CORRIGIDO)                      */
/* =================================================================== */

/* O container que lista todas as reservas */
.energy-reserves-list {
  display: flex;
  flex-direction: row; 
  flex-wrap: wrap;
  gap: 0.5rem; 
}

.energy-reserves-box {
 margin-bottom: 10px;
}
/* O card de cada reserva individual, agora idêntico ao .meter-card */
.reserve-card {
  flex: 1 1 180px;
  display: flex;
  flex-direction: row; /* Alinha os elementos internos na horizontal */
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem;
  background-color: rgba(0,0,0,0.05); /* Fundo sutil */
  border: 1px solid var(--c-borda);
  border-radius: 3px;
}

/* Garante que o nome ocupe o espaço disponível */
.reserve-card .item-name {
  flex-grow: 1;
  font-weight: 700;
}
.reserve-card .item-name small {
  font-weight: 400;
  color: var(--c-texto-subtitulo);
}

/* O container para os inputs de valor */
.reserve-card .meter-inputs {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  flex-shrink: 0;
}

.reserve-card .meter-inputs input {
  width: 40px;
  text-align: center;
  font-size: 0.9rem;
}

/* =================================================================== */
/* DESIGN: ABAS DE MAGIAS E PODERES (v4 - Layout de Grade Otimizado)    */
/* =================================================================== */

/* --- 1. Estilo de Bloco (Card Papiro) --- */
.tab[data-tab="spells"] .skill-block,
.tab[data-tab="powers"] .skill-block {
  background: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
  padding: 0.5rem 0.75rem; 
  margin-bottom: 8px; 
}

/* --- 2. Cabeçalho do Bloco (Compacto) --- */
.tab[data-tab="spells"] .block-header,
.tab[data-tab="powers"] .block-header {
  color: var(--c-texto-escuro);
  border-bottom-color: var(--c-borda);
  padding-bottom: 3px;
  margin-bottom: 5px;
}
.tab[data-tab="spells"] .block-header h4,
.tab[data-tab="powers"] .block-header h4 {
  color: var(--c-texto-escuro);
  font-size: 14px; 
  font-weight: 700;
  font-family: var(--f-titulos);
}
.tab[data-tab="spells"] .block-header a,
.tab[data-tab="powers"] .block-header a {
  color: var(--c-texto-subtitulo);
  font-size: 11px;
}

/* --- 3. Cabeçalho de Habilidade (Magia/Poder) --- */
.casting-ability-box .header-main-info {
  display: flex;
  flex-direction: column;
}
.casting-ability-box .block-header h4 {
  margin: 0;
  line-height: 1.2;
}
.casting-ability-box .header-subtitle {
  font-size: 11px; 
  font-weight: 700;
  color: var(--c-texto-subtitulo, #977c63);
  line-height: 1;
  margin-top: 2px;
}
.casting-ability-box .block-header .header-controls {
   flex-shrink: 0;
}
.casting-ability-box .ability-description {
  font-size: 11px; /* Fonte da descrição menor */
  line-height: 1.4;
  color: var(--c-texto-escuro, #352425);
  padding: 0;
  margin-top: 8px;
}
.casting-ability-box .ability-description p {
  margin: 0 0 5px 0;
}

/* --- 4. Lista de Reservas de Energia (Compacto) --- */
.tab[data-tab="spells"] .energy-reserves-box,
.tab[data-tab="powers"] .energy-reserves-box {
  margin-bottom: 8px;
  padding: 0.5rem 0.75rem;
}
.energy-reserves-list {
  display: flex;
  flex-direction: row; 
  flex-wrap: wrap;
  gap: 6px; 
}
.reserve-card {
  flex: 1 1 160px; 
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.4rem;
  background-color: rgba(0,0,0,0.05);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
}
.reserve-card .item-name {
  flex-grow: 1;
  font-weight: 700;
  font-size: 11px;
}
.reserve-card .item-name small {
  font-weight: 400;
  color: var(--c-texto-subtitulo);
}
.reserve-card .meter-inputs {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  flex-shrink: 0;
}
.reserve-card .meter-inputs input {
  width: 30px; 
  text-align: center;
  font-size: 11px;
}

/* ================================================== */
/* ✅ NOVO LAYOUT DE GRADE PARA MAGIAS/PODERES        */
/* ================================================== */

.tab[data-tab="spells"] .item-list,
.tab[data-tab="powers"] .item-list {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

/* ✅ MUDANÇA: A linha agora é uma GRADE */
.tab[data-tab="spells"] .item-row.spell-row,
.tab[data-tab="powers"] .item-row.spell-row {
  display: grid;
  /* Colunas: [Nome] [Stats] [Controles] */
  grid-template-columns: auto 1fr auto;
  gap: 0.75rem; /* Espaço entre as colunas */
  
  border-bottom: 1px solid var(--c-borda);
  padding: 0.4rem 0.25rem; 
  align-items: flex-start; 
}
.tab[data-tab="spells"] .item-row.spell-row:last-child,
.tab[data-tab="powers"] .item-row.spell-row:last-child {
  border-bottom: none;
}

/* Coluna 1: Nome (não tem mais 140px) */
.tab[data-tab="spells"] .spell-main-info,
.tab[data-tab="powers"] .spell-main-info {
  flex-basis: auto; /* Remove a largura fixa */
  flex-shrink: 1;   /* Permite encolher se necessário */
}

/* Coluna 2: Stats (ocupa o espaço livre) */
.spell-stats-and-actions {
  display: flex;
  flex-direction: column;
  gap: 3px; 
  align-items: flex-start;
  flex-grow: 1;
  /* Garante que o alinhamento das tags seja à esquerda */
  justify-content: flex-start; 
}
.stats-row {
  display: flex;
  flex-wrap: wrap;
  gap: 3px 6px; 
}
.effect-stat {
  max-width: 150px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Coluna 3: Controles (continua igual) */
.tab[data-tab="spells"] .item-controls,
.tab[data-tab="powers"] .item-controls {
    align-self: center; /* Centraliza os controles verticalmente */
}


/* --- 6. Tags de Stat (Genérico) --- */
.tab[data-tab="spells"] .stat,
.tab[data-tab="powers"] .stat {
  background: rgba(0,0,0,0.04);
  border: 1px solid rgba(0,0,0,0.1);
  color: var(--c-texto-escuro);
  padding: 3px 6px; /* ✅ AUMENTADO (de 1px 4px) */
  border-radius: 3px;
  font-size: 12px; /* ✅ AUMENTADO (de 10px) */
  white-space: nowrap;
}
.tab[data-tab="spells"] .stat label,
.tab[data-tab="powers"] .stat label {
  color: var(--c-texto-subtitulo);
  margin-right: 3px; /* ✅ AUMENTADO (de 2px) */
  font-weight: 700;
  font-size: 10px; /* ✅ AUMENTADO (de 9px) */
}

/* --- 7. CORES ESPECÍFICAS (MAGIAS - Roxo) --- */
.tab[data-tab="spells"] .item-name.spell-name a {
  display: inline-block;
  background: rgba(106, 0, 173, 0.1);
  border: 1px solid rgba(106, 0, 173, 0.25);
  border-left: 3px solid #6a0dad; /* Roxo */
  padding: 3px 8px;
  border-radius: 4px;
  font-weight: 700;
  color: #191813; 
  text-decoration: none;
  font-size: 12px; /* Fonte do nome */
  transition: all 0.2s ease;
  white-space: nowrap; /* Impede que o nome quebre */
}
.tab[data-tab="spells"] .item-name.spell-name a:hover {
  background: rgba(106, 0, 173, 0.2);
  border-color: rgba(106, 0, 173, 0.5);
}
.tab[data-tab="spells"] .spell-stats-and-actions .stat {
  border-left-color: #6a0dad; /* Roxo */
}
/* Destaque para tags roláveis (Magias) */
.tab[data-tab="spells"] .spell-stats-and-actions .stat:has(a.rollable) {
  border-left-color: rgba(106, 0, 173, 0.5);
  cursor: pointer;
}
.tab[data-tab="spells"] .spell-stats-and-actions .stat:has(a.rollable):hover {
  background: rgba(197, 160, 91, 0.1);
}


/* --- 8. CORES ESPECÍFICAS (PODERES - Verde) --- */
.tab[data-tab="powers"] .item-name.spell-name a {
  display: inline-block;
  background: rgba(56, 156, 104, 0.08); /* Verde */
  border: 1px solid rgba(56, 156, 104, 0.2);
  border-left: 3px solid var(--c-hp-bar); /* Verde */
  padding: 3px 8px;
  border-radius: 4px;
  font-weight: 700;
  color: #191813; 
  text-decoration: none;
  font-size: 12px; /* Fonte do nome */
  transition: all 0.2s ease;
  white-space: nowrap; /* Impede que o nome quebre */
}
.tab[data-tab="powers"] .item-name.spell-name a:hover {
  background: rgba(56, 156, 104, 0.2);
  border-color: rgba(56, 156, 104, 0.5);
}
.tab[data-tab="powers"] .spell-stats-and-actions .stat {
  border-left-color: var(--c-hp-bar); /* Verde */
}
/* Destaque para tags roláveis (Poderes) */
.tab[data-tab="powers"] .spell-stats-and-actions .stat:has(a.rollable) {
  border-left-color: var(--c-accent-gold, #c5a05b);
  cursor: pointer;
}
.tab[data-tab="powers"] .spell-stats-and-actions .stat:has(a.rollable):hover {
  background: rgba(197, 160, 91, 0.1);
}

/* =================================================================== */
/* DESIGN: ABA DE EQUIPAMENTOS (REFINADO)                              */
/* =================================================================== */

/* MUDANÇA: Estilo mais limpo e compacto para os títulos das colunas */
.equipment-column .column-header {
  font-size: 0.9rem;
  text-align: center;
  font-weight: 700;
  color: var(--c-texto-subtitulo);
  border-bottom: none; /* Remove a borda/sublinhado */
  padding: 0;
  margin-bottom: 0.5rem;
}

.tab[data-tab="equipment"] .equipment-column {
  background: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
  padding: 0.75rem;
  margin-top: 10px;
}
.tab[data-tab="equipment"] .block-header h4,
.tab[data-tab="equipment"] .equipment-header h3 {
    color: var(--c-texto-escuro);
}

/* MUDANÇA: Estilo do checkbox revertido para o padrão do navegador */
.ignore-weight-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  font-size: 0.8rem;
  color: var(--c-texto-subtitulo);
}
.ignore-weight-label input[type="checkbox"] {
  /* Deixa o navegador controlar a aparência */
  all: revert;
}


/* Lista de Equipamentos */
.tab[data-tab="equipment"] .item-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.tab[data-tab="equipment"] .equipment-row {
  border-bottom: 1px solid var(--c-borda);
  padding: 0.5rem 0.25rem;
}
.tab[data-tab="equipment"] .equipment-row:last-child {
  border-bottom: none;
}
.equipment-row .item-name {
  display: inline-block;
  background: rgba(0,0,0,0.03);
  border: 1px solid var(--c-borda);
  padding: 3px 8px;
  border-radius: 3px;
  font-weight: 700;
}

/* MUDANÇA: O container das tags agora permite quebra de linha */
.equipment-row .item-stats {
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-end; /* Alinha as tags à direita */
  gap: 0.4rem;
}

/* Estilo para TODAS as tags de status, incluindo as novas */
.equipment-row .item-stats .stat {
  background: rgba(0,0,0,0.04);
  border: 1px solid rgba(0,0,0,0.1);
  color: var(--c-texto-escuro);
  border-left: 3px solid var(--c-borda-escura);
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.8rem;
  white-space: nowrap;
}

/* =================================================================== */
/* DESIGN: BLOCO DE SUMÁRIO DE CARGA                                   */
/* =================================================================== */

.encumbrance-block .encumbrance-total-weight {
  font-size: 0.8rem;
  color: var(--c-texto-subtitulo);
}

/* O container do medidor */
.encumbrance-meter {
  display: flex;
  width: 100%;
  margin: 0.5rem 0;
}

/* Cada segmento do medidor */
.encumbrance-level-box {
  flex: 1;
  text-align: center;
  padding: 0.4rem 0.2rem;
  background-color: rgba(0,0,0,0.05);
  border-top: 1px solid var(--c-borda);
  border-bottom: 1px solid var(--c-borda);
  border-right: 1px solid var(--c-borda);
  transition: all 0.2s ease;
}
.encumbrance-level-box:first-child {
  border-left: 1px solid var(--c-borda);
  border-radius: 5px 0 0 5px;
}
.encumbrance-level-box:last-child {
  border-radius: 0 5px 5px 0;
}

.encumbrance-level-box .level-name {
  font-size: 0.7rem;
  font-weight: 700;
}
.encumbrance-level-box .level-weight {
  font-size: 0.7rem;
  color: var(--c-texto-subtitulo);
  
}

/* Estilo do segmento ATIVO */
.encumbrance-level-box.active {
  background: var(--c-acento-vermelho);
  color: var(--c-texto-principal);
  font-weight: 600;
  border-color: var(--c-acento-vermelho);
}
.encumbrance-level-box.active .level-weight {
  color: var(--c-texto-principal);
  font-weight: 600;
  opacity: 0.8;
}

/* Rodapé com o checkbox */
.encumbrance-footer {
  margin-top: 0.75rem;
  text-align: right;
}

/* =================================================================== */
/* DESIGN: ABA DE CARACTERÍSTICAS (Layout "Papiro Limpo")           */
/* Inspirado na aba de Condições                                     */
/* =================================================================== */

/* Remove o layout de coluna dupla que não existe mais */
.characteristics-layout-container {
    display: block;
    grid-template-columns: none;
}

/* 1. O Bloco Principal (a "seção" no papiro) */
/* Usa o mesmo estilo de 'card' da aba Condições */
.tab[data-tab="characteristics"] .form-section {
    flex-shrink: 0;
    background: var(--c-fundo-card-claro); /* Fundo sutil */
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 8px;
    padding: 8px 12px;
    margin-bottom: 10px; /* Espaço entre os blocos (Racial, Vantagens...) */
}

/* 2. O Cabeçalho (mantém a funcionalidade do .block-header) */
.tab[data-tab="characteristics"] .form-section .block-header {
    color: var(--c-texto-escuro);
    border-bottom-color: rgba(0,0,0,0.1); /* Borda sutil */
    margin-bottom: 10px; /* Espaço para o container de cards */
}
.tab[data-tab="characteristics"] .form-section .block-header input {
    font-family: var(--f-titulos);
    color: var(--c-texto-escuro);
    border: none;
    background: transparent;
    font-size: 0.9em;
}

/* 3. O Container Flex (exatamente como na aba Condições) */
.tab[data-tab="characteristics"] .flex-wrap-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px; /* Espaço entre os cards */
    list-style: none;
    padding: 0;
    margin: 0;
}

/* 4. O Card de Característica (inspirado no .condition-card) */
.characteristic-card {
    display: flex;
    align-items: center;
    gap: 0.75rem; /* Espaço entre o ícone, infos e controles */
    
    /* Estilo do card (mais limpo, como o .condition-card) */
    background: var(--c-fundo-card-claro, #fdfaf8);
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 5px;
    padding: 6px 8px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05); /* Sombra sutil */

    /* Tamanho (como o .condition-card) */
    flex-basis: calc(50% - 4px); /* Tenta 2 colunas */
    flex-grow: 1;
    box-sizing: border-box; 
    min-width: 250px; /* Mínimo antes de quebrar a linha */
}

/* 5. Layout Interno do Card */
.characteristic-card .item-icon {
    flex: 0 0 28px;
    width: 28px;
    height: 28px;
    border: none;
    border-radius: 3px;
}

.characteristic-card .card-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-width: 0; /* Impede que o nome empurre os controles */
}

.characteristic-card .item-name {
    font-weight: 700;
    color: var(--c-texto-escuro);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; /* Adiciona "..." se o nome for longo */
}

.characteristic-card .card-details {
    display: flex;
    gap: 0.75rem;
    font-size: 0.8em;
    color: var(--c-texto-subtitulo);
    padding-top: 2px;
}

.characteristic-card .card-points {
    font-weight: 700;
}
.characteristic-card .card-cr {
    font-weight: 500;
}
.characteristic-card .item-controls {
    flex-shrink: 0;
}

/* 6. Cores Temáticas (Fundos sutis, como no CSS antigo) */

/* Bloco 1 & 4 (Racial, Físico) - Cor Bronze */
.tab[data-tab="characteristics"] .form-section[data-block-id="block1"] .characteristic-card,
.tab[data-tab="characteristics"] .form-section[data-block-id="block4"] .characteristic-card {
    background: rgba(159, 146, 117, 0.08); /* Fundo bronze sutil */
    border-color: rgba(159, 146, 117, 0.2);
}

/* Bloco 2 (Vantagens) - Cor Azul */
.tab[data-tab="characteristics"] .form-section[data-block-id="block2"] .characteristic-card {
    background: rgba(86, 129, 156, 0.08); /* Fundo azul sutil */
    border-color: rgba(86, 129, 156, 0.2);
}

/* Bloco 3 (Desvantagens) - Cor Vermelha */
.tab[data-tab="characteristics"] .form-section[data-block-id="block3"] .characteristic-card {
    background: rgba(114, 37, 46, 0.08); /* Fundo vermelho sutil */
    border-color: rgba(114, 37, 46, 0.2);
}

/* 7. Estilo para o placeholder (copiado da aba Condições) */
.tab[data-tab="characteristics"] .placeholder-text {
    text-align: center;
    opacity: 0.7;
    font-style: italic;
    width: 100%;
    padding: 1rem 0;
}

/* =================================================================== */
/* DESIGN: ABA DE ASPECTOS SOCIAIS (LAYOUT DE 2 LINHAS)                */
/* =================================================================== */

.tab[data-tab="social"] .social-block,
.tab[data-tab="social"] .social-block-fullwidth {
  background: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
  padding: 0.5rem;
  margin-bottom: 0.25rem;
}
.tab[data-tab="social"] .social-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem;
}
.tab[data-tab="social"] .social-block-fullwidth {
  grid-column: 1 / -1;
}
.tab[data-tab="social"] .block-header h4 {
    color: var(--c-texto-escuro);
}

/* MUDANÇA: O novo container que empilha o conteúdo */
.item-content-wrapper {
  flex-grow: 1;
}

/* O nome principal com destaque de tag */
.tab[data-tab="social"] .item-name {
  display: inline-block;
  background: rgba(151, 124, 99, 0.1);
  border: 1px solid rgba(151, 124, 99, 0.2);
  padding: 3px 8px;
  border-radius: 3px;
  font-weight: 700;
}

/* Os detalhes que aparecem na linha de baixo */
.tab[data-tab="social"] .item-details {
  font-size: 0.85em;
  color: var(--c-texto-subtitulo);
  display: block; /* Garante que ele ocupe sua própria linha */
  margin-top: 2px;
}
.tab[data-tab="social"] .item-row {
  border-bottom: 1px solid var(--c-borda);
  padding: 0.6rem 0.25rem;
}

/* Remove o padding padrão da lista para alinhar os itens à esquerda */
.tab[data-tab="social"] .item-list {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

/* =================================================================== */
/* DESIGN: ABA DE BIOGRAFIA                                            */
/* =================================================================== */

.tab[data-tab="biography"] {
  padding-top: 0.5rem;
}

/* Layout da biografia em coluna única */
.biography-layout {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
/* Estilo de "card flutuante" para as duas colunas */
.biography-story,
.biography-details .skill-block {
  background: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
  padding: 0.75rem;
  height: 100%;
}

.biography-story .block-title,
.biography-details .block-header {
  color: var(--c-texto-escuro);
  border-bottom: 1px solid var(--c-borda);
  padding-bottom: 0.5rem;
  margin-top: 0;
}

/* MUDANÇA: Regras mais robustas para o editor de texto */
.biography-story .editor {
  /* Removemos a altura fixa que estava causando o bug */
  min-height: 150px; /* Apenas uma altura mínima para começar */
  padding: 0.5rem;
  background: rgba(0,0,0,0.03);
  border-radius: 3px;
}

/* Lista de detalhes no card de Perfil */
.details-display-list {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem 1rem;
}
.detail-item {
  border-bottom: 1px solid var(--c-borda);
  padding-bottom: 3px;
}
.detail-label {
  font-size: 0.7rem;
  color: var(--c-texto-subtitulo);
  font-weight: 700;
  text-transform: uppercase;
}
.detail-value {
  font-size: 0.9rem;
}

/* Estilo para o novo botão de opções e o menu de contexto aprimorado */
.item-controls .item-options-btn {
  font-size: 1rem;
}

.context-divider {
  border-top: 1px solid var(--c-borda);
  margin: 4px 0;
}

.context-submenu {
  position: relative;
}

.context-submenu .submenu-items {
  display: none;
  position: absolute;
  top: 0;
  right: 100%; /* Posiciona o submenu à esquerda do item pai */
  background-color: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  border-radius: 3px;
  box-shadow: -2px 2px 5px rgba(0,0,0,0.2);
  width: 200px;
  padding: 5px 0;
}

.context-submenu:hover .submenu-items {
  display: block; /* Mostra o submenu ao passar o mouse */
}


/* =================================================================== */
/* DESIGN: CARD DE DANO BÁSICO UNIFICADO (GdP/GeB)                     */
/* =================================================================== */

.combat-tab .basic-damage-card {
  padding: 6px 8px;
}

/* Faz o cabeçalho ser super compacto */
.combat-tab .basic-damage-card .block-header {
  padding-bottom: 3px;
  margin-bottom: 5px;
}
.combat-tab .basic-damage-card .block-header h4 {
  font-size: 0.9rem;
  font-weight: 700;
  font-family: var(--f-titulos);
}
.combat-tab .basic-damage-card .block-header .header-controls a {
  font-size: 11px;
}

/* O container para as duas metades */
.combat-tab .damage-halves {
  display: flex;
  gap: 5px;
}

/* Cada metade clicável */
.combat-tab .damage-half {
  flex: 1; /* Ocupa metade do espaço */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 4px;
  border-radius: 3px;
  background: rgba(0,0,0,0.04);
  border: 1px solid rgba(0,0,0,0.1);
  text-decoration: none;
  transition: all 0.2s ease;
}
.combat-tab .damage-half:hover {
  background: rgba(0,0,0,0.08);
  border-color: rgba(0,0,0,0.2);
}

.combat-tab .damage-half label {
  font-size: 8px;
  font-weight: 700;
  text-transform: uppercase;
  color: var(--c-texto-subtitulo, #977c63);
}
.combat-tab .damage-half .value {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--c-texto-escuro, #352425);
  line-height: 1.1;
}

/* Esconde o cabeçalho antigo (que agora está vazio) */
.combat-tab .combat-header-stats {
  display: none;
}

/* =================================================================== */
/* DESIGN: JANELA DE DIÁLOGO DE MODIFICADORES                          */
/* =================================================================== */

.modifier-dialog {
    text-align: center;
}

/* Container principal da grade de botões */
.modifier-grid {
    display: flex;
    flex-direction: column; /* Organiza as linhas uma em cima da outra */
    gap: 8px; /* Espaço entre as linhas de botões */
    margin-bottom: 12px;
}

/* Estilo de cada linha de botões */
.mod-row {
    display: flex;
    justify-content: space-between; /* Distribui os botões igualmente */
    gap: 5px; /* Espaço entre os botões na mesma linha */
}

/* Estilo de cada botão de modificador */
.mod-button {
    flex: 1; /* Faz com que todos os botões ocupem o mesmo espaço na linha */
    padding: 5px;
    font-size: 14px;
    font-weight: bold;
    border: 1px solid #b3a8a8;
    background: #e9e3e0;
    cursor: pointer;
    transition: background-color 0.2s;
}

.mod-button:hover {
    background-color: #d1c8c4;
    border-color: #797171;
}

/* Estilo do botão de limpar */
.mod-clear-button {
    width: 100%; /* Ocupa toda a largura */
    padding: 8px;
    margin-bottom: 5px;
    border: 1px solid #b3a8a8;
    background: #72252e;
    color: #f8f4f1;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s;
}

.mod-clear-button:hover {
    background-color: #c9b9b4;
}

/* Garante que o input do número também tenha uma boa aparência */
.modifier-dialog input[type="number"] {
    width: 80px;
    padding: 5px;
    font-size: 1.2em;
    border: 1px solid #b3a8a8;
}

/* =================================================================== */
/* DESIGN DO CARD DE DANO NO CHAT (VERSÃO FINAL)                     */
/* =================================================================== */

.gurps-damage-card {
    background: #fdfaf8;
    border: 1px solid #c9b9b4;
    border-radius: 5px;
    font-family: 'Roboto', sans-serif;
    color: #352425;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    margin-top: 5px;
}
.gurps-damage-card .card-header {
    background: #e9e3e0;
    padding: 6px 10px;
    border-bottom: 1px solid #d1c8c4;
    text-align: center;
}
.gurps-damage-card .card-header h3 {
    font-family: 'Cinzel', serif;
    font-size: 1.2em;
    margin: 0;
    color: #313131;
    font-weight: 700;
}
.gurps-damage-card .card-formula-container {
    text-align: center;
    padding: 8px 10px 4px 10px;
}
.gurps-damage-card .formula-pill {
    font-size: 0.9em;
    color: #6d6666;
    background: #f8f4f1;
    border: 1px solid #e9e3e0;
    border-radius: 15px;
    padding: 4px 10px;
    display: inline-block;
}
.gurps-damage-card .card-content {
    padding: 4px 10px 10px 10px;
}
.gurps-damage-card .card-main-flex {
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    padding-top: 8px;
    border-top: 1px solid #e9e3e0;
}
.gurps-damage-card .roll-column, .gurps-damage-card .target-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    flex-basis: 45%;
}
.gurps-damage-card .column-separator {
    width: 1px;
    background-color: #d1c8c4;
    align-self: stretch;
}
.gurps-damage-card .column-label {
    font-size: 0.8em;
    font-weight: bold;
    color: #6d6666;
    text-transform: uppercase;
    margin-bottom: 4px;
}
.gurps-damage-card .individual-dice-damage {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 4px;
    background-color: #f0ebe8;
    border-radius: 4px;
    padding: 6px;
    width: 100%;
    box-sizing: border-box;
}
.gurps-damage-card .die-damage {
    width: 22px;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fdfaf8;
    border: 1px solid #d1c8c4;
    border-radius: 3px;
    font-weight: bold;
}
.gurps-damage-card .damage-total {
    display: flex;
    align-items: baseline;
    gap: 8px;
}
.gurps-damage-card .damage-value {
    font-size: 2.8em;
    font-weight: bold;
    color: #a53541;
}
.gurps-damage-card .damage-type {
    font-size: 1em;
    font-weight: bold;
    color: #313131;
    background-color: #e9e3e0;
    padding: 2px 6px;
    border-radius: 4px;
    text-transform: uppercase;
}

/* --- ✅ NOVO ESTILO PARA DANOS EXTRAS ✅ --- */
.gurps-damage-card .card-footer {
    padding: 8px 10px;
    background: #f0ebe8;
    border-top: 1px solid #d1c8c4;
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.extra-damage-block {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.extra-damage-label {
    font-size: 0.9em;
    font-weight: bold;
    color: #5c524a;
}
.extra-damage-roll {
    display: flex;
    align-items: baseline;
    gap: 5px;
}
.extra-damage-roll .damage-value {
    font-size: 1.2em;
    font-weight: bold;
    color: #a53541;
}
.extra-damage-roll .damage-type,
.extra-damage-roll .armor-divisor-tag {
    font-size: 0.8em;
    font-weight: bold;
    color: #313131;
    background-color: #e9e3e0;
    padding: 2px 5px;
    border-radius: 3px;
}
.extra-damage-roll .armor-divisor-tag {
    color: #6d6666;
    background: none;
}

/* --- ✅ NOVO ESTILO PARA O BOTÃO ✅ --- */
.gurps-damage-card .card-actions {
    padding: 0;
    border-top: 1px solid #d1c8c4;
}
.gurps-damage-card .apply-damage-button {
    width: 100%;
    padding: 8px;
    font-size: 0.9em;
    font-weight: bold;
    border: none;
    background: #e9e3e0;
    color: #333;
    cursor: pointer;
    transition: background-color 0.2s;
}
.gurps-damage-card .apply-damage-button:hover {
    background: #d1c8c4;
}

/* =================================================================== */
/* 18. ESTILO DO DIÁLOGO DE CRIAÇÃO/EDIÇÃO DE ATAQUE                 */
/* =================================================================== */

.dialog.gurps-attack-dialog .window-content {
    background: #28282b !important; /* Aplica nosso fundo escuro */
    color: #e1e1e1;
    padding: 0; /* O padding será controlado pelo conteúdo */
}
.dialog.gurps-attack-dialog .dialog-content {
    padding: 10px;
}

/* Garante que o formulário use o espaço e tenha rolagem se necessário */
.dialog.gurps-attack-dialog .gurps-dialog-form {
    height: 100%;
    overflow-y: auto;
}

/* Estilo para a seção "sanfonada" de opções avançadas */
.dialog.gurps-attack-dialog details.advanced-options {
    border-color: rgba(255,255,255,0.1);
    margin-top: 20px;
}
.dialog.gurps-attack-dialog details.advanced-options[open] {
    padding-bottom: 15px;
}
.dialog.gurps-attack-dialog details.advanced-options > summary {
    font-size: 12px;
    text-transform: uppercase;
    color: var(--c-accent-gold, #c5a05b);
    margin-bottom: 10px;
    cursor: pointer;
}

/* Pequenos subtítulos dentro das opções avançadas */
.dialog.gurps-attack-dialog .subheader {
    font-size: 1em;
    font-weight: bold;
    color: #ccc;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 3px;
    margin: 15px 0 10px 0;
}

/* =================================================================== */
/* DESIGN: JANELA DE DIÁLOGO DE EDIÇÃO DE STATS                        */
/* =================================================================== */


.gurps-dialog .dialog-content {
    background: #fdfaf8;
    padding: 15px;
}

.gurps-stat-editor-dialog .dialog-description {
    font-family: 'Roboto', sans-serif;
    background: #352425;
    color:#f8f4f1;
    text-align: center;
    margin-bottom: 0;
    padding: 5px 5px 5px 5px;
}

.gurps-stat-editor-dialog .form-group {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
    background-color: #f0ebe8;
    padding: 10px;
    border-radius: 4px;
    border: 1px solid #e0d9d6;
    margin-bottom: 5px;
}

.gurps-stat-editor-dialog .form-group label {
    font-weight: bold;
    font-family: 'Cinzel', serif;
    color: #313131;
    font-size: 1.1em;
}

.gurps-stat-editor-dialog .form-group input[type="number"] {
    width: 80px;
    height: 40px;
    padding: 5px;
    border: 1px solid #c9b9b4;
    border-radius: 3px;
    background: #fff;
    text-align: center;
    font-size: 1.5em;
    font-weight: bold;
}
.gurps-stat-editor-dialog .form-group input[type="number"]:focus {
    outline: none;
    border-color: #3a506b;
    box-shadow: 0 0 5px rgba(58, 80, 107, 0.5);
}

/* Estilo para os botões do diálogo */
.gurps-dialog .dialog-buttons {
    padding: 10px;
    background: #e9e3e0;
    border-top: 1px solid #d1c8c4;
}

.gurps-dialog .dialog-button {
    background: #389c68; /* Cor de sucesso para o botão 'Salvar' */
    color: #fff;
    border: none;
    font-family: 'Roboto', sans-serif;
    font-weight: bold;
    margin-top: 5px;
}
.gurps-dialog .dialog-button:hover {
    background: #2f8357;
}

/* =================================================================== */
/* DESIGN FINAL: CLÁSSICO SOBRE PAPIRO (v2 - Ajuste Fino)              */
/* =================================================================== */

.item-name a.item-quick-view {
    text-decoration: none !important;
    color: inherit;
    border-bottom: 1px dotted rgba(0, 0, 0, 0.2);
    transition: color 0.2s, border-bottom-color 0.2s;
}
.item-name a.item-quick-view:hover {
    color: #a53541;
    border-bottom-color: transparent;
}

.gurps-item-preview-dialog .dialog-content {
    background-color: #f5f1e8;
    background-image: linear-gradient(rgba(180, 160, 130, 0.04) 1px, transparent 1px),
                      linear-gradient(90deg, rgba(180, 160, 130, 0.04) 1px, transparent 1px);
    background-size: 2px 2px;
    padding: 10px;
    overflow: hidden;
}

.gurps-item-preview-card {
    font-family: 'Roboto', sans-serif;
    background: #fdfaf8;
    border: 1px solid #dcd3d0;
    border-radius: 3px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.gurps-item-preview-card .preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    border-bottom: 1px solid #e9e3e0;
}
.gurps-item-preview-card .preview-header h3 {
    font-family: 'Cinzel', serif;
    font-size: 1.2em;
    margin: 0;
    color: #313131;
    text-shadow: none;
    border-bottom: none !important;
}

.gurps-item-preview-card .preview-content {
    padding: 12px;
    padding-bottom: 15px; 
}

/* Propriedades como tags compactas e alinhadas à esquerda */
.gurps-item-preview-card .preview-properties {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: flex-start;
    
}
.gurps-item-preview-card .property-tag {
    display: flex;
    align-items: baseline;
    gap: 5px;
    background: #f0ebe8;
    border-radius: 4px;
    padding: 2px 7px;
    border: 1px solid #e0d9d6;
    font-size: 11px;
}
.gurps-item-preview-card .property-tag label {
    font-weight: bold;
    color: #6d6666;
}
.gurps-item-preview-card .property-tag span {
    font-weight: 500;
    color: #313131;
}

/* Linha divisória sutil */
.gurps-item-preview-card .preview-divider {
    border: none;
    border-top: 1px solid #e9e3e0;
    margin: 5px 0;
}

/* Descrição com fonte reduzida */
.gurps-item-preview-card .preview-description {
    font-size: 13px;
    line-height: 1.5;
    user-select: text;
    padding-top: 4px;
   
    
}
/* MUDANÇA: Garante que os parágrafos não tenham margem/recuo inicial */
.gurps-item-preview-card .preview-description p {
    padding: 0;
    margin: 0 0 0.25em 0; /* Adiciona apenas um pequeno espaço ABAIXO de cada parágrafo */
    text-indent: 0; /* Remove a indentação da primeira linha */
}
.gurps-item-preview-card .preview-description p:last-child {
    margin-bottom: 0;
}

.gurps-item-preview-card .header-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}
.gurps-item-preview-card .preview-item-type {
    font-size: 0.75em;
    text-transform: capitalize;
    font-weight: bold;
    color: #6d6666;
    background: #e9e3e0;
    padding: 2px 5px;
    border-radius: 3px;
}
.gurps-item-preview-card .send-to-chat {
    color: #6d6666;
    font-size: 0.9em;
    cursor: pointer;
    transition: color 0.2s;
}
.gurps-item-preview-card .send-to-chat:hover {
    color: #a53541;
}

/* BOTÃO APLICAR DANO*/

.gurps-damage-card .card-actions {
    padding: 5px;
    background: #e9e3e0;
    border-top: 1px solid #d1c8c4;
    text-align: right;
}
.gurps-damage-card .apply-damage-button {
    border: 1px solid #b5b5b5;
    background: #f0f0f0;
    color: #333;
    padding: 4px 8px;
    border-radius: 3px;
    cursor: pointer;
}
.gurps-damage-card .apply-damage-button:hover {
    background: #e0e0e0;
    border-color: #999;
}

/* ============================================= */
/* ESTILOS PARA A NOVA ABA "ESTADO & REGRAS" (V3)  */
/* ============================================= */

/* --- 1. Layout Principal da Aba --- */
/* Esta regra garante que a aba ocupe o espaço e empilhe as seções */
.conditions-tab.active {
    display: flex;
    flex-direction: column; /* Empilha as seções verticalmente */
    gap: 16px; /* Espaço entre as seções */
    padding: 8px;
    height: 100%;
    overflow-y: auto; /* Permite rolar a aba inteira se necessário */
}

/* --- 2. Estilo da Seção (contêiner comum) --- */
/* Um estilo de "card" para ambas as seções */
.conditions-tab .form-section {
    flex-shrink: 0;
    background: rgba(0,0,0,0.08);
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 8px;
    padding: 8px 12px;
}
.conditions-tab .form-section .section-title {
    font-family: var(--f-titulos);
    color: var(--c-texto-escuro);
    font-size: 1.1em;
    text-align: center;
    margin-bottom: 4px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    padding-bottom: 5px;
}
.conditions-tab .form-section .hint {
    text-align: center;
    font-size: 0.9em;
    opacity: 0.8;
    margin-top: -2px;
    margin-bottom: 10px;
    padding: 0 10px;
}
.conditions-tab .placeholder-text {
    text-align: center;
    opacity: 0.7;
    font-style: italic;
    width: 100%;
}


/* --- 3. Contêiner Flex-Wrap (Usado por AMBAS as seções) --- */
/* Ativa o layout flexível que quebra a linha */
.conditions-tab .flex-wrap-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px; /* Espaço entre os cards/pílulas */
    padding-top: 5px;
    list-style: none; /* Remove marcadores de lista se for um <ol> */
    margin: 0;
    padding: 5px 0 0 0;
}


/* --- 4. Seção "Estado Atual" (Pílulas Aprimoradas) --- */

/* A nova pílula aprimorada */
.effect-pill-enhanced {
    display: flex;
    align-items: center;
    background: var(--c-fundo-card-claro, #fdfaf8);
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 5px;
    padding: 5px 8px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);

    /* Cada pílula tentará ter ~48% da largura, permitindo 2 colunas */
    flex-basis: calc(50% - 4px); 
    flex-grow: 1;
    box-sizing: border-box; 
    min-width: 250px; /* Garante que a pílula não seja esmagada */
}

.effect-pill-enhanced .pill-icon {
    width: 28px;
    height: 28px;
    border: none;
    border-radius: 4px;
    margin-right: 8px;
    flex-shrink: 0;
}

.effect-pill-enhanced .pill-info {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    min-width: 0; /* Impede que o texto empurre os botões */
}

.effect-pill-enhanced .pill-name {
    font-weight: bold;
    color: var(--c-bg-darkest);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; 
}

.effect-pill-enhanced .pill-details {
    display: flex;
    gap: 10px; /* Espaço entre "Duração" e "Fonte" */
    font-size: 0.75em;
    color: var(--c-bg-medium);
    opacity: 0.8;
    white-space: nowrap;
    overflow: hidden; 
    text-overflow: ellipsis;
    padding-top: 4px;
}

.effect-pill-enhanced .pill-details .fas {
    margin-right: 3px;
    opacity: 0.7;
}

.effect-pill-enhanced .pill-controls {
    display: flex;
    margin-left: 10px;
    flex-shrink: 0;
    gap: 5px; /* Espaço entre os botões de ícone */
}

.effect-pill-enhanced .pill-controls .effect-control {
    color: #CCC;
    padding: 0 3px;
    font-size: 0.9em;
    opacity: 0.7;
    transition: all 0.2s ease;
}
.effect-pill-enhanced .pill-controls .effect-control:hover {
    opacity: 1;
    color: var(--c-accent-orange, #ff6400);
}


/* --- 5. Seção "Condições Passivas" (Cards de Regra) --- */

/* Remove a lógica de colunas específica do .condition-column */
/* A lógica de flex-wrap já está sendo aplicada por .flex-wrap-container */
.conditions-tab .passive-conditions-section .item-list {
    overflow-y: visible; /* Remove a barra de rolagem interna */
    /* As regras de column-count foram removidas */
}

/* Garante que o texto de placeholder ocupe a largura total */
.conditions-tab .passive-conditions-section .placeholder-text {
    flex-basis: 100%;
}

/* Card de Condição Individual (agora como um item flex) */
.condition-card {
    background: var(--c-fundo-card-claro, #fdfaf8);
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 5px;
    padding: 6px 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;

    /* Define o mesmo tamanho das pílulas para consistência */
    flex-basis: calc(50% - 4px); 
    flex-grow: 1;
    box-sizing: border-box; 
    min-width: 250px; 
    
    /* Remove o margin-bottom que não é mais necessário com 'gap' */
    margin-bottom: 0; 
}

.condition-card .item-icon {
    flex: 0 0 28px;
    width: 28px;
    height: 28px;
    border-radius: 3px;
    border: none;
}
.condition-card .item-name {
    flex-grow: 1;
    font-weight: 700;
    display: flex; 
    align-items: center;
    gap: 8px;
}
.condition-card .item-name h4 {
    margin: 0;
    font-size: 1em;
}

/* --- 6. Interruptor On/Off (Seu código original, 100% mantido) --- */
.switch {
  position: relative;
  display: inline-block;
  width: 34px;
  height: 14px;
  flex-shrink: 0;
}
.switch input { 
    opacity: 0; 
    width: 0; 
    height: 0; 
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: var(--c-accent-red, #a33c3c); /* Desligado (vermelho) */
  transition: .4s;
  border-radius: 14px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 10px; 
  width: 10px;
  left: 2px; 
  bottom: 2px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

/* Ligado (NÃO marcado) */
input:not(:checked) + .slider {
  background-color: var(--c-accent-green, #2b8a3e);
}

/* Desligado (MARCADO) */
input:checked + .slider:before {
  transform: translateX(20px);
}

/* Efeito visual de desligado */
.condition-card input:checked ~ .item-name,
.condition-card input:checked ~ .item-icon,
.condition-card input:checked ~ .item-controls {
    opacity: 0.5;
}

/* ================================================= */
/* ESTILOS PARA O MENU DE STATUS DO TOKEN (HUD)      */
/* ================================================= */

/* Define o container principal do menu de status */
#token-hud .status-effects {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* ✅ CRIA UMA GRADE DE 4 COLUNAS */
    gap: 4px;
    padding: 4px;
    width: 160px; /* ✅ DEFINE UMA LARGURA FIXA PARA O MENU */
    background-color:#000;
}

/* Estilo para cada ícone individual */
#token-hud .effect-control {
    width: 32px;
    height: 32px;
    border: 1px solid #000;
    border-radius: 4px;
    overflow: hidden;
    background-color: rgba(0,0,0,0.24);
    
}

/* Adiciona uma borda dourada quando o ícone está ativo */
#token-hud .effect-control.active {
    border: 2px solid var(--c-accent-gold, #c5a05b);
}

/* Garante que a imagem do ícone preencha o espaço */
#token-hud .effect-control img {
    width: 100%;
    height: 100%;
    border: none;
}

#token-hud .status-effects .effect-control {
filter:none;
}

/* --- ESTILOS PARA A NOVA ENGRENAGEM DE EDIÇÃO --- */
.edit-secondary-stats-btn {
    /* Garante que ela obedeça o alinhamento do cabeçalho (Flexbox) */
    position: static; 
    transform: none;
    opacity: 1;
    margin: 0;

    /* Estilo Visual */
    color: var(--c-texto-subtitulo);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}

/* Efeito ao passar o mouse */
.edit-secondary-stats-btn:hover {
    color: var(--c-acento-dourado);
    transform: rotate(90deg); /* Rotação suave */
}

/* --- ESTILOS PARA A JANELA DE DIÁLOGO DE ATRIBUTOS SECUNDÁRIOS --- */
.secondary-stats-dialog .form-header,
.secondary-stats-dialog .form-grid {
    display: grid;
    /* ✅ 6 COLUNAS AGORA */
    grid-template-columns: 2.5fr 1fr 1fr 1fr 1fr 1fr;
    gap: 8px;
    align-items: center;
    text-align: center;
}
.secondary-stats-dialog .form-header {
    font-family: var(--f-titulos);
    font-size: 0.8em;
    color: var(--c-texto-subtitulo);
    padding: 0 8px;
    border-bottom: 1px solid var(--c-borda);
    margin-bottom: 8px;
}
.secondary-stats-dialog .form-header span:first-child,
.secondary-stats-dialog .form-grid label {
    text-align: left;
    font-weight: bold;
}
.secondary-stats-dialog .form-grid {
    padding: 0 8px;
}
.secondary-stats-dialog input {
    text-align: center;
}
.secondary-stats-dialog .mod-display,
.secondary-stats-dialog .base-display {
    font-weight: bold;
    color: var(--c-texto-secundario);
}
.secondary-stats-dialog .final-display {
    font-weight: bold;
    font-size: 1.1em;
    background: rgba(0,0,0,0.1);
    padding: 4px;
    border-radius: 3px;
}

/* ============================================= */
/* Estilos para o Card de Resumo de Dano (MINIMALISTA) */
/* ============================================= */

.gurps-roll-card .minicard {
  background: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 5px;
  padding: 8px;
  margin-top: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
}

.gurps-roll-card .minicard-title {
  font-weight: bold;
  font-size: var(--font-size-12);
  color: #666;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding-bottom: 4px;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Regra para os parágrafos dentro dos minicards */
.gurps-roll-card .minicard p {
  font-size: var(--font-size-14);
  margin: 0 0 4px 0; /* Espaçamento entre as linhas */
  padding: 0;
}

.gurps-roll-card .minicard p:last-child {
  margin-bottom: 0;
}
.gurps-roll-card .summary-actors.vertical {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 8px;
}

.gurps-roll-card .actor-line {
  display: flex;
  align-items: center;
  font-size: var(--font-size-14);
}

.gurps-roll-card .arrow-line {
  margin: 2px 0;
}

.gurps-roll-card .summary-actors .actor-token-icon {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 1px solid rgba(0, 0, 0, 0.5);
  vertical-align: middle;
  margin-right: 8px; /* Espaço entre o token e o nome */
}

/* ============================================= */
/* Layout Flex para a Ficha de Item             */
/* Garante que o corpo da ficha ocupe 100%       */
/* ============================================= */

.gum.sheet.item .sheet-content {
  display: flex;
  flex-direction: column;
  height: calc(100% - 90px); /* Ajuste de altura para o novo cabeçalho */
}

.gum.sheet.item .sheet-body-content {
  flex-grow: 1;
  overflow-y: auto;
}

#sidebar-tabs {
  flex-direction: row !important;
}

/* ============================================================= */
/* ESTILO DAS TAGS DE CARACTERÍSTICA (U/F) NA FICHA DO ATOR      */
/* ============================================================= */

.gum.sheet.actor .attack-name-row {
    display: flex;
    align-items: baseline;
    gap: 6px; /* Espaço entre Nome, Tags e Perícia */
}

.gum.sheet.actor .attack-name-row strong {
    flex-shrink: 0; /* Impede que o nome encolha */
}
.gum.sheet.actor .attack-name-row small {
    flex-grow: 1; /* Empurra as tags para perto do nome */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* O estilo das tags "U" e "F" */
.gum.sheet.actor .attack-flag-tag {
    font-family: 'Roboto Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.8em;
    padding: 1px 4px;
    border-radius: 3px;
    color: #fff;
    flex-shrink: 0;
}

/* Tag Desbalanceada (U) - Laranja/Cuidado */
.gum.sheet.actor .attack-flag-tag.flag-u {
    background: #D35400; /* Laranja Escuro */
}
/* Tag Esgrima (F) - Azul/Técnica */
.gum.sheet.actor .attack-flag-tag.flag-f {
    background: #2980B9; /* Azul Escuro */
}

/* ============================================================= */
/* ESTILO DA TAG DE PESO DO GRUPO DE ATAQUE (FICHA DO ATOR)      */
/* VERSÃO v2 - "Tag Estilizada"                                  */
/* ============================================================= */

.gum.sheet.actor .group-weight-tag {
    /* Estilo de "Tag" */
    background: rgba(0,0,0,0.04);
    border: 1px solid rgba(0,0,0,0.1);
    padding: 1px 6px;
    border-radius: 3px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05); /* Sombra sutil */
    
    /* Estilo de "Fonte" */
    font-size: 0.75em; /* Um pouco menor para caber na tag */
    font-weight: 500;
    color: var(--c-texto-subtitulo, #977c63); /* Cor sutil */
    font-style: italic;
    
    /* Posicionamento */
    margin-left: 6px;
    white-space: nowrap;
    text-transform: lowercase; /* kg */
}

/* ============================================================= */
/* DESIGN DA ABA DE EQUIPAMENTOS (ESTILO "CARD" v2 - CORRIGIDO)  */
/* ============================================================= */

/* ✅ CORREÇÃO (BUG 1): Define o layout flex-wrap para a aba de equipamentos */
.tab[data-tab="equipment"] .flex-wrap-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px; /* Espaço entre os cards */
    list-style: none;
    padding: 0;
    margin: 0;
}

/* 1. O Card de Equipamento (baseado no characteristic-card) */
.equipment-card {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    
    /* ✅ CORREÇÃO (BUG 2): Fundo sutil para o card (levemente mais escuro) */
    background: rgba(0,0,0,0.03); 
    
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 5px;
    padding: 6px 8px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    
    /* Regra de 2 colunas */
    flex-basis: calc(50% - 4px); 
    flex-grow: 1;
    box-sizing: border-box; 
    min-width: 250px; /* Largura mínima do card */
}

/* 2. Ícone, Info e Controles (herdados do characteristic-card) */
.equipment-card .item-icon {
    flex: 0 0 28px;
    width: 28px;
    height: 28px;
    border: none;
    border-radius: 3px;
}
.equipment-card .card-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-width: 0; /* Impede que o nome empurre os controles */
}
.equipment-card .item-name {
    font-weight: 700;
    color: var(--c-texto-escuro);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.equipment-card .item-controls {
    flex-shrink: 0;
    display: flex; 
    gap: 0.5rem;   
}
.equipment-card .item-controls a {
    color: var(--c-texto-subtitulo, #977c63);
    font-size: 0.9em;
    opacity: 1;
    pointer-events: auto;
}
.equipment-card .item-controls a:hover {
    color: var(--c-acento-vermelho, #72252e);
}

/* 3. O container para as "tags" de stats */
.equipment-card .equipment-stats {
    display: flex;
    flex-wrap: wrap; 
    gap: 4px;        
    padding-top: 4px;
}

/* 4. A "Tag" individual de stat (Peso, Custo, RD, etc.) */
.equipment-card .equip-stat-tag {
    background: rgba(0,0,0,0.04);
    border: 1px solid rgba(0,0,0,0.1);
    color: var(--c-texto-escuro);
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 0.8rem;
    font-weight: 500;
    white-space: nowrap;
    
    display: inline-flex;
    align-items: center;
    gap: 4px;
}
.equipment-card .equip-stat-tag i {
    font-size: 0.9em;
    color: var(--c-texto-subtitulo, #977c63);
    margin-right: 2px;
}

/* =================================================================== */
/* DESIGN: PAINEL DE RD (ABA DE COMBATE)                               */
/* =================================================================== */

/* 1. Estilo do Bloco (baseado no .gum-block) */
.sheet-body .dr-location-block {
  background: var(--c-fundo-card-claro);
  border: 1px solid var(--c-borda);
  padding: 0.75rem;
  margin-top: 10px;
}

/* 2. Cabeçalho (baseado no .block-header) */
.dr-location-block .block-header {
  color: var(--c-texto-escuro);
  border-bottom-color: var(--c-borda);
}
.dr-location-block .block-header h4 {
  color: var(--c-texto-escuro);
  font-family: var(--f-titulos);
}

/* 3. A Lista de Locais */
.dr-location-block .dr-location-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  /* Cria 2 colunas para a lista de RDs */
  grid-template-columns: 1fr 1fr;
  gap: 8px 15px; /* Espaço vertical e horizontal */
  margin-top: 10px;
}

/* 4. A Linha de cada Local */
.dr-location-block .dr-location-row {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  background: rgba(0,0,0,0.03);
  border: 1px solid var(--c-borda);
  padding: 4px 8px;
  border-radius: 3px;
}

/* 5. O Nome do Local (Crânio, Torso) */
.dr-location-block .location-name {
  font-weight: 700;
  color: var(--c-texto-escuro);
  font-size: 13px;
}
.dr-location-block .location-name span {
  font-weight: 400;
  font-size: 11px;
  color: var(--c-texto-subtitulo);
  margin-left: 4px;
}

/* 6. O Valor da RD (o '5 | 2 cont') */
.dr-location-block .location-dr-value {
  font-family: 'Roboto Condensed', sans-serif;
  font-weight: 700;
  font-size: 14px;
  color: var(--c-acento-vermelho, #a53541);
  white-space: nowrap; /* Impede que "5 | 2 cont" quebre a linha */
}

/* =================================================================== */
/* DESIGN: COMPACTAÇÃO DA ABA DE COMBATE (v2 - Layout Otimizado)       */
/* =================================================================== */

/* Define uma fonte base ainda menor para toda a aba de combate */
.gum.sheet.actor .tab.combat-tab {
  font-size: 11px;
}

/* --- 1. Otimiza o "Dashboard" (Cards de Dano) --- */
.combat-tab .combat-header-stats {
  /* Otimizado para apenas 2 cards */
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 8px;
}
.combat-tab .stat-card {
  padding: 5px 4px; /* Mais compacto */
  gap: 1px; 
}
.combat-tab .stat-card label {
  font-size: 8px; /* Rótulo minúsculo */
  font-weight: 700;
  text-transform: uppercase;
  color: var(--c-texto-subtitulo, #977c63);
}
.combat-tab .stat-card .value {
  font-size: 1.1rem; /* Valor de dano menor */
  line-height: 1.1;
}
.combat-tab .stat-card .edit-basic-damage {
    top: 0;
    right: 2px;
}

/* ================================================== */
/* ✅ NOVO LAYOUT DE 2 COLUNAS (Estreita/Larga)       */
/* ================================================== */
.combat-tab .combat-main-content {
  display: grid;
  /* Coluna esquerda (RD) com 1fr, Coluna direita (Ataques) com 2.5fr */
  grid-template-columns: 1fr 2.5fr;
  gap: 8px;
  align-items: start;
}
.combat-tab .combat-left-column,
.combat-tab .combat-right-column {
  display: flex;
  flex-direction: column;
  gap: 8px; /* Espaço entre os blocos na mesma coluna */
}

/* --- 2. Otimiza os Blocos Principais (Ataques, RD, Registros) --- */
.combat-tab .gum-block {
  padding: 6px 8px;
  margin-top: 0;
}
.combat-tab .gum-block .block-header {
  padding-bottom: 3px;
  margin-bottom: 5px;
}
.combat-tab .gum-block .block-header h4 {
  font-size: 14px; /* Títulos de bloco menores */
  font-weight: 700;
  font-family: var(--f-titulos);
  margin-bottom: 0.5px;
}

/* --- 3. Otimiza a Lista de Ataques (Coluna Direita) --- */
.combat-tab .attack-group-list {
  gap: 6px; /* Espaço entre "Espada Longa" e "Adaga" */
}
.combat-tab .attack-group-card {
  padding: 5px 8px;
}
.combat-tab .attack-group-card .group-header {
  padding-bottom: 3px;
  margin-bottom: 4px;
}
.combat-tab .attack-group-card .group-name {
  font-size: 0.85rem; /* Nome do item (ex: "Espada Longa") */
}
.combat-tab .attack-item {
  padding: 4px 0; /* Mais compacto verticalmente */
}
.combat-tab .attack-item .attack-name-row {
  font-size: 12px; /* Nome do ataque (ex: "Balanço") */
}
.combat-tab .attack-details-row {
  gap: 4px; 
  margin-top: 2px;
}
.combat-tab .attack-details-row .stat {
  font-size: 11px; /* Fonte das tags (NH, Dano, etc.) */
  padding: 1px 4px;
  border-left-width: 2px;
}
.combat-tab .attack-details-row .stat label {
  font-size: 10px; 
  margin-right: 2px;
}

/* --- 4. Otimiza o Painel de RD (Coluna Esquerda) --- */
.combat-tab .dr-location-block .dr-location-list {
  /* Remove a regra de 2 colunas */
  grid-template-columns: 1fr; 
  gap: 3px; /* Espaço mínimo entre as linhas de RD */
  margin-top: 4px;
}
.combat-tab .dr-location-block .dr-location-row {
  padding: 2px 6px; /* Padding super compacto */
  background: rgba(0,0,0,0.02); /* Fundo "zebrado" sutil */
}
.combat-tab .dr-location-block .dr-location-row:nth-child(even) {
  background: rgba(0,0,0,0.05);
}
.combat-tab .dr-location-block .location-name {
  font-size: 11px;
}
.combat-tab .dr-location-block .location-name span {
  font-size: 9px; 
  color: var(--c-texto-subtitulo, #977c63);
}
.combat-tab .dr-location-block .location-dr-value {
  font-size: 11px;
  font-weight: 700;
}

/* --- 5. Otimiza os Registros de Combate (Coluna Direita) --- */
.combat-tab .combat-meters-box .meter-list {
  gap: 4px;
  flex-direction: column;
}
.combat-tab .meter-card {
  padding: 4px 6px;
  gap: 4px;
  flex-basis: auto;
}
.combat-tab .meter-card .item-name {
  font-size: 10px;
}
.combat-tab .meter-card .meter-inputs input {
  width: 30px;
  font-size: 10px;
}
.combat-tab .meter-card .item-controls a {
  font-size: 10px;
}

/* =================================================================== */
/* DESIGN: COMPACTAÇÃO DA ABA DE COMBATE (v3 - Correção de Overflow)   */
/* =================================================================== */

/* 1. Impede que a linha de RD quebre */
.combat-tab .dr-location-block .dr-location-row {
    white-space: nowrap; /* Impede que os elementos pulem para a linha de baixo */
}

/* 2. Impede que o NOME do local encolha */
.combat-tab .dr-location-block .location-name {
    flex-shrink: 0; /* Garante que o nome (ex: "Crânio (-7)") não seja esmagado */
    margin-right: 10px; /* Adiciona um espaço antes do valor da RD */
}

/* 3. Faz o VALOR da RD ser cortado com "..." se for muito longo */
.combat-tab .dr-location-block .location-dr-value {
    flex-grow: 1; /* Permite que o valor ocupe o espaço restante */
    text-align: right; /* Alinha a RD à direita */
    overflow: hidden; /* Esconde o que não couber */
    text-overflow: ellipsis; /* Adiciona o "..." no final */
}

/* =================================================================== */
/* DESIGN: LISTA DE ATAQUES (Aprimoramento Visual v3)                */
/* =================================================================== */

/* --- 1. Adiciona profundidade ao "Card de Grupo" --- */
.combat-tab .attack-group-card {
  /* Um fundo sutil para fazer o card se destacar */
  background: rgba(0,0,0,0.03);
  
  /* A sombra que você sugeriu para "elevar" o card */
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  
  /* Transição suave para o hover */
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.combat-tab .attack-group-card:hover {
  border-color: rgba(0,0,0,0.15);
  box-shadow: 0 2px 5px rgba(0,0,0,0.12);
}

/* --- 2. Refina os Títulos (Compactação e Hierarquia) --- */
.combat-tab .attack-group-card .group-name {
  font-size: 0.9rem; /* Um pouco menor que o 1rem anterior */
  font-family: var(--f-titulos);
  font-weight: 700;
  color: var(--c-texto-escuro, #352425);
}

.combat-tab .attack-item .attack-name-row {
  font-size: 0.85rem; /* Um pouco menor que o nome do grupo */
  font-weight: 700; /* Mais forte para se destacar das tags */
}
.combat-tab .attack-item .attack-name-row a {
  font-weight: 400; /* Faz o "(Modo)" ficar mais sutil */
  color: var(--c-texto-subtitulo, #977c63);
}

/* --- 3. Destaca as Tags Roláveis (Sua Ideia Principal) --- */

/* Estilo base de todas as tags (como você já tinha) */
.combat-tab .attack-details-row .stat {
  font-size: 10px;
  padding: 2px 5px;
  border-left: 3px solid var(--c-texto-subtitulo, #977c63); /* Borda cinza/subtítulo */
}

/* * A MÁGICA: 
 * Se uma tag (.stat) contiver um link com a classe .rollable...
*/
.combat-tab .attack-details-row .stat:has(a.rollable) {
  /* ...ela se torna interativa! */
  border-left-color: var(--c-accent-gold, #c5a05b); /* Borda Dourada */
  cursor: pointer;
  transition: background-color 0.2s ease, border-color 0.2s ease;
  font-size: 11px;
}

/* Efeito de hover para a tag rolável */
.combat-tab .attack-details-row .stat:has(a.rollable):hover {
  background: rgba(197, 160, 91, 0.1); /* Fundo dourado sutil */
  border-color: #a07e4a; /* Dourado mais escuro */
}

/* --- 4. (Sugestão) Listras "Zebradas" para Modos de Ataque --- */
/* Isso melhora a leitura se uma arma tiver múltiplos modos */
.combat-tab .attacks-in-group .attack-item:nth-child(even) {
    background: rgba(0,0,0,0.02);
}

/* ========================================================== */
/* ✅ ESTILO DOS BOTÕES DE DESCRIÇÃO (ABA BIOGRAFIA)          */
/* ========================================================== */

/* 1. Estilo base unificado para TODOS os 3 botões */
.gum.sheet.actor .description-section button.toggle-editor,
.gum.sheet.actor .description-editor button {
  margin-top: 0.3rem;
  font-size: 0.8rem;
  background: rgba(0,0,0,0.05); /* Fundo sutil (do papiro) */
  color: var(--c-texto-subtitulo, #977c63); /* Cor de subtítulo */
  border: 1px solid var(--c-borda, #dacdca);
  border-radius: 4px;
  padding: 0.2rem 0.4rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

/* 2. Efeito hover unificado */
.gum.sheet.actor .description-section button.toggle-editor:hover,
.gum.sheet.actor .description-editor button:hover {
  color: var(--c-texto-escuro, #352425);
  background: rgba(0,0,0,0.1);
  border-color: var(--c-texto-subtitulo, #977c63);
}

/* 3. Destaque de hover para Salvar e Cancelar */
.gum.sheet.actor .description-editor button.save-description:hover {
    background: var(--c-acento-verde, #389c68);
    color: #fff;
    border-color: var(--c-acento-verde, #389c68);
}
.gum.sheet.actor .description-editor button.cancel-description:hover {
    background: var(--c-acento-vermelho, #72252e);
    color: #fff;
    border-color: var(--c-acento-vermelho, #72252e);
}

/* 4. Alinha os botões "Salvar" e "Cancelar" */
.gum.sheet.actor .description-editor {
  margin-top: 0.5rem;
  flex-wrap: wrap; 
  gap: 0.3rem;
}

/* 5. Força o editor a ocupar 100% da largura (empurrando botões para baixo) */
.gum.sheet.actor .description-editor .tox {
    flex-basis: 100%; 
}

/* ========================================================== */
/* ✅ NOVO: MODO EXPANDIDO PARA O EDITOR (FICHA DO ATOR)      */
/* ========================================================== */
.gum.sheet.actor .tox-tinymce {
  height: 300px !important;
}
/* Esta regra se aplica ao editor na ficha do ATOR quando expandido */
.gum.sheet.actor .tox-tinymce.expanded {
  position: relative; /* Posição normal, mas com z-index */
  width: 100%;
  height: 600px !important; /* <-- Altura expandida total (600px) */
  z-index: 20; /* Garante que fique acima de outros elementos da ficha */
  
  /* Borda sutil do tema Papiro */
  border: 1px solid var(--c-borda, #dacdca) !important;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
  transition: all 0.3s ease;
}

/* Define a altura da ÁREA DE TEXTO dentro do editor expandido */
.gum.sheet.actor .tox-tinymce.expanded .tox-edit-area__iframe {
  height: 550px !important; /* <-- Altura do texto (600px - 50px de barra) */
}

/* Tag de Bônus de Defesa na Lista de Ataques */
.combat-tab .group-db-tag {
    display: inline-block;
    background-color: #1565c0; /* Azul para defesa */
    color: #fff;
    font-size: 0.75rem;
    padding: 1px 5px;
    border-radius: 3px;
    margin-left: 8px;
    vertical-align: middle;
    font-weight: normal;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* Estilo dos Sentidos na Ficha */
.gum.sheet.actor .senses-container .sense-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 0.9em;
}
.gum.sheet.actor .senses-container .sense-box a {
    color: var(--c-texto-subtitulo);
    font-weight: bold;
    margin-bottom: 2px;
}
/* Estilo dos Valores dos Sentidos (Ficha do Personagem) */
.gum.sheet.actor .senses-container .sense-value {
    display: inline-block;       /* Garante que o span tenha tamanho */
    min-width: 20px;             /* Garante largura mínima */
    font-size: 1.2em;            /* Tamanho legível */
    font-weight: 700;            /* Negrito */
    color: var(--c-texto-claro);              /* Cor escura (Papiro) */
    text-align: center;
    background-color: rgba(0, 0, 0, 0.05); /* Fundo sutil para contraste */
    padding: 2px 6px;
    border-radius: 4px;
    margin-top: 2px;
}

