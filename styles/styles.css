/* =================================================================== */
/* GURPS GUM - CORE STYLESHEET (FINAL & BLINDADO)                     */
/* Tema: "Ébano e Ouro" (Papiro Clássico)                             */
/* Arquivo: styles/styles.css     
/* Organização do arquivo abaixo:
    1. Importação das Fontes
    2. Variáveis e tema padrão
    3. Estilo Global do sistema
    4. Estrutura geral da ficha do ator
    5. Sidebar
    6. Região de Atributos e Menu de Aba
    7. Chat-cards
    8. ABA Equipamentos
    9. ABA Social
    10. ABA Biografia
    11. ABA Condições
    12. ABA Perícias
    13. ABA Magias e Poderes
    14. ABA Combate 
    15. ABA Característica
    16. ABA Modificadores
    16. Estilo Global das Tags
    17. Controles de Itens (editar/deletar)                            */
/* =================================================================== */

/* --- 1. IMPORTAÇÃO DAS FONTES --- */
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@300;400;500;700&family=Roboto+Condensed:wght@700&display=swap');

/* =================================================================== */
/* 2. VARIÁVEIS E TEMA (Sandbox - Isolado do Foundry Global)          */
/* =================================================================== */

.gum,
.gum-dialog,
.gurps-roll-card,
.damage-application-dialog, 
.trigger-browser,
.effect-browser,
.modifier-browser,
.condition-browser,
.eqp-modifier-browser,
.gm-modifier-browser {
  /* -- Fontes -- */
  --gum-font-primary: 'Roboto', sans-serif;
  --gum-font-secondary: 'Cinzel', serif;
  --gum-font-condensed: 'Roboto Condensed', sans-serif;

  /* -- Paleta Base (Papiro/Claro) -- */
  --gum-bg-papiro: #f1e8e7;
  --gum-bg-card-claro: #f8f4f1;
  --gum-bg-card-sutil: rgba(0, 0, 0, 0.05);
  
  /* -- Paleta Escura (Contrastes/Cabeçalhos) -- */
  --gum-bg-darkest: #191813;
  --gum-bg-cabecalho: #34161b;
  --gum-bg-sidebar: #1a1a1a;
  --gum-bg-dark: #2b2a29;
  --gum-bg-medium: #3a3836;
  
  /* -- Texto -- */
  --gum-text-escuro: #352425;
  --gum-text-claro: #f8f4f1;
  --gum-text-subtitulo: #977c63;
  --gum-text-medio: #a9a6a0;

  /* -- Acentos e Cores Semânticas -- */
  --gum-accent-gold: #c5a05b;
  --gum-accent-bronze: #9f9275;
  --gum-accent-red: #a53541;     
  --gum-accent-green: #389c68;   
  --gum-accent-blue: #56819c;    
  --gum-accent-purple: #6a0dad;  
  --gum-accent-orange: #d35400;
  
  /* -- Bordas e Sombras -- */
  --gum-border: #dacdca;
  --gum-border-light: #e0d9d6;
  --gum-border-gold: rgba(197, 165, 106, 0.4);
  --gum-shadow-sutil: 0 1px 3px rgba(0,0,0,0.1);
  --gum-shadow-forte: 0 4px 8px rgba(0,0,0,0.5);
}

/* =================================================================== */
/* 3. ESTILOS BASE (Globais dentro do sistema)                        */
/* =================================================================== */

.gum {
    font-family: var(--gum-font-primary);
    color: var(--gum-text-escuro);
    font-size: 13px;
}

/* Links */
.gum a {
    color: var(--gum-accent-gold);
    text-decoration: none;
    transition: color 0.2s;
}
.gum a:hover {
    text-decoration: underline;
    color: var(--gum-accent-red);
}

/* Inputs Unificados */
.gum input[type="text"],
.gum input[type="number"],
.gum select,
.gum textarea {
    font-family: var(--gum-font-primary);
    color: var(--gum-text-escuro);
    background-color: rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    padding: 2px 4px;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.gum input:focus,
.gum select:focus,
.gum textarea:focus {
    border-color: var(--gum-accent-gold);
    box-shadow: 0 0 5px rgba(197, 160, 91, 0.3);
    outline: none;
    background-color: #fff;
}

.gum input:disabled {
    color: #777;
    background-color: rgba(0, 0, 0, 0.1);
    border-color: transparent;
    cursor: not-allowed;
}

/* Scrollbar Customizada (Apenas dentro da janela GUM) */
.gum ::-webkit-scrollbar { width: 6px; height: 6px; }
.gum ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
.gum ::-webkit-scrollbar-thumb { background: var(--gum-accent-gold); border-radius: 3px; }
.gum ::-webkit-scrollbar-thumb:hover { background: var(--gum-accent-bronze); }

/* =================================================================== */
/* 4. ESTRUTURA GERAL DA FICHA DE ATOR                                */
/* =================================================================== */

.gum.sheet.actor .sheet-grid {
    display: grid;
    position: relative;
    grid-template-columns: 250px 1fr; /* Sidebar | Conteúdo */
    grid-template-rows: auto 1fr;
    grid-template-areas:
        "header header"
        "sidebar main";
    height: 100%;
    background: var(--gum-bg-papiro);
    overflow: hidden;
}

/* Banner Superior */
.gum.sheet.actor .sheet-grid::before {
    content: '';
    position: absolute; top: 0; left: 0; width: 100%; height: 125px;
    background: var(--gum-bg-cabecalho);
    z-index: 0;
}

.gum.sheet.actor .sheet-header { grid-area: header; position: relative; z-index: 1; }
.gum.sheet.actor .sheet-sidebar { grid-area: sidebar; position: relative; z-index: 2; }
.gum.sheet.actor .sheet-main-area { 
    grid-area: main; position: relative; z-index: 1;
    display: flex; flex-direction: column; padding: 0.5rem; gap: 0.5rem;
    overflow: hidden;
}

/* --- 4.1 Cabeçalho --- */
.gum.sheet.actor .sheet-header {
    padding: 0.5rem 1.5rem; color: var(--gum-text-claro);
    display: flex; justify-content: space-between; align-items: center;
}
.gum.sheet.actor .header-grid { width: 100%; display: flex; justify-content: space-between; align-items: center; }

.gum.sheet.actor .char-name-input {
    font-family: var(--gum-font-secondary); font-size: 1.8rem;
    color: var(--gum-accent-gold); background: transparent !important;
    border: none !important; margin-bottom: 5px; width: 100%;
}
.gum.sheet.actor .char-concept-input {
    font-size: 0.9rem; font-style: italic; color: var(--gum-text-medio);
    background: transparent !important; border: none !important; width: 100%;
}

.gum.sheet.actor .points-cluster { display: flex; gap: 1rem; }
.gum.sheet.actor .points-display { display: flex; flex-direction: column; text-align: center; }
.gum.sheet.actor .points-display label { 
    font-family: var(--gum-font-secondary); font-size: 0.6rem; text-transform: uppercase; color: var(--gum-text-medio); 
}
.gum.sheet.actor .points-display input {
    font-size: 0.9rem; font-weight: 700; width: 60px;
    background: transparent !important; border: none !important;
    color: var(--gum-text-claro); text-align: center;
}

/* =================================================================== */
/* 5. SIDEBAR (MEDALHÕES, BARRAS, SOBREVIVÊNCIA)                      */
/* =================================================================== */

.gum.sheet.actor .sheet-sidebar { padding: 0 5px; pointer-events: none; }

.gum.sheet.actor .sidebar-design-container {
    background: rgba(20, 20, 20, 0.95);
    border: 1px solid var(--gum-border-gold);
    border-radius: 4px; padding: 10px;
    min-height: 40rem; display: flex; flex-direction: column; gap: 10px;
    pointer-events: all; box-shadow: var(--gum-shadow-forte); color: #ececec;
}

/* Foto */
.gum.sheet.actor .profile-img {
    width: 100%; max-width: 180px; height: auto; max-height: 200px;
    object-fit: cover; object-position: top;
    border: 1px solid var(--gum-accent-gold); border-radius: 2px;
    box-shadow: var(--gum-shadow-forte); margin: 0 auto; display: block;
}

/* Medalhão de Esquiva & Carga */
.gum.sheet.actor .encumbrance-dodge-bar {
    display: flex; justify-content: space-between; align-items: center;
    background: rgba(0,0,0,0.4); border: 1px solid rgba(197, 160, 91, 0.2);
    border-radius: 3px; padding: 4px 0; margin-top: -20px;
    position: relative; z-index: 10;
}
.gum.sheet.actor .enc-col { text-align: center; width: 38%; display: flex; flex-direction: column; justify-content: center;}
.gum.sheet.actor .center-col { width: 24%; position: relative; display: grid; place-items: center; }

.gum.sheet.actor .enc-label { font-size: 9px; color: var(--gum-text-medio); text-transform: uppercase; font-weight: 700; }
.gum.sheet.actor .enc-label.link { cursor: pointer; border-bottom: 1px dotted rgba(197, 160, 91, 0.5); }
.gum.sheet.actor .enc-label.link:hover { color: var(--gum-accent-gold); }
.gum.sheet.actor .enc-val { font-size: 11px; font-weight: 700; color: #fff; }

/* O SVG do Medalhão */
.gum.sheet.actor .badge-wrapper {
    width: 60px; height: 60px; background: #161616; border-radius: 50%;
    box-shadow: 0 0 10px rgba(0,0,0,0.8); display: grid; place-items: center; position: relative;
}
.gum.sheet.actor .dodge-badge-svg { position: absolute; width: 100%; height: 100%; }
.gum.sheet.actor .dodge-badge-svg .badge-bg { fill: #1f1e1a; }
.gum.sheet.actor .dodge-badge-svg .badge-border { fill: none; stroke: var(--gum-accent-gold); stroke-width: 5; }

.gum.sheet.actor .dodge-value {
    position: relative; z-index: 2; font-size: 1.4rem; font-weight: 700;
    color: #fff; text-shadow: 0 0 8px rgba(197, 160, 91, 0.6);
}
.gum.sheet.actor .badge-label-curved {
    position: absolute; bottom: -6px;
    font-family: var(--gum-font-condensed); font-size: 8px;
    background: rgba(0,0,0,0.9); color: var(--gum-accent-gold);
    padding: 1px 5px; border-radius: 3px; border: 1px solid rgba(197, 160, 91, 0.3);
}

/* Cluster de Dados (Atributos Secundários) */
.gum.sheet.actor .stats-cluster {
    background: rgba(0,0,0,0.2); border: 1px solid rgba(197, 160, 91, 0.2);
    border-radius: 4px; padding: 8px;
}
.gum.sheet.actor .cluster-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);
}
.gum.sheet.actor .cluster-title { font-family: var(--gum-font-secondary); font-size: 10px; color: var(--gum-text-subtitulo); }

.gum.sheet.actor .dice-row { display: flex; gap: 5px; margin-bottom: 10px; }
.gum.sheet.actor .d6-stat { position: relative; flex: 1; height: 50px; }
.gum.sheet.actor .d6-face {
    width: 100%; height: 100%;
    background: linear-gradient(145deg, #2b2a29 0%, #191813 100%);
    border: 1px solid var(--gum-accent-gold); border-radius: 4px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.gum.sheet.actor .d6-val { font-size: 1.3rem; font-weight: 700; color: #fff; }
.gum.sheet.actor .d6-label { font-size: 8px; color: #aaa; text-transform: uppercase; }

/* Sentidos */
.gum.sheet.actor .senses-container {
    display: flex; justify-content: space-between;
    background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05); padding: 5px;
}
.gum.sheet.actor .sense-box { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
.gum.sheet.actor .sense-box a { color: var(--gum-text-subtitulo); font-size: 9px; font-weight: 700; display: flex; flex-direction: column; align-items: center; }
.gum.sheet.actor .sense-value {
    font-size: 11px; font-weight: 700; color: #fff; background: rgba(255,255,255,0.1);
    border: 1px solid #444; border-radius: 3px; padding: 0 5px; margin-top: 2px;
}

/* Barras de HP/PF */
.gum.sheet.actor .bars-block { display: flex; flex-direction: column; gap: 8px; }
.gum.sheet.actor .bar-label { display: flex; justify-content: space-between; font-size: 10px; font-weight: 700; color: var(--gum-text-medio); }
.gum.sheet.actor .resource-bar {
    position: relative; height: 24px; background: #1a1a1a; border: 1px solid #444;
    border-radius: 3px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
}
.gum.sheet.actor .bar-fill { position: absolute; left: 0; top: 0; height: 100%; transition: width 0.3s ease; }
.gum.sheet.actor .bar-inputs {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center; gap: 2px;
    font-size: 11px; font-weight: 700; color: #fff; text-shadow: 0 1px 2px black; z-index: 2;
}
.gum.sheet.actor .bar-inputs input { background: transparent; border: none; color: inherit; width: 30px; text-align: right; padding: 0; }

/* Tracker de Sobrevivência */
.gum.sheet.actor .sidebar-footer { margin-top: auto; }
.gum.sheet.actor .sidebar-collapsible { border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 5px; }
.gum.sheet.actor .sidebar-summary { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 4px 0; list-style: none; }
.gum.sheet.actor .sidebar-summary::-webkit-details-marker { display: none; }
.gum.sheet.actor .sidebar-summary[open] .expand-icon { transform: rotate(180deg); }

.gum.sheet.actor .block-title { font-family: var(--gum-font-secondary); font-size: 10px; color: var(--gum-accent-gold); margin: 0; }
.gum.sheet.actor .survival-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 5px 0; }
.gum.sheet.actor .survival-item { background: rgba(0,0,0,0.3); border: 1px solid #444; border-radius: 3px; padding: 4px; text-align: center; }
.gum.sheet.actor .survival-item.radiation { border-color: #5a4a20; background: rgba(50, 40, 10, 0.2); }
.gum.sheet.actor .survival-item label { font-size: 9px; font-weight: 700; color: var(--gum-text-subtitulo); display: block; margin-bottom: 2px; }
.gum.sheet.actor .survival-item.radiation label { color: #d4a017; }

.gum.sheet.actor .counter-wrapper { display: flex; align-items: center; justify-content: center; gap: 5px; }
.gum.sheet.actor .counter-wrapper input { width: 30px; background: #111; color: #fff; border: 1px solid #333; text-align: center; }
.gum.sheet.actor .adjust-survival { cursor: pointer; color: #777; font-size: 10px; }
.gum.sheet.actor .adjust-survival:hover { color: #fff; }

/* =================================================================== */
/* 6. ÁREA PRINCIPAL: ATRIBUTOS E ABAS                                */
/* =================================================================== */

/* Painel de Atributos (Brasões) */
.gum.sheet.actor .primary-attributes-container {
    display: flex; justify-content: center; gap: 1.5rem; padding: 0.5rem 0;
}
.gum.sheet.actor .attribute-box {
    background: var(--gum-bg-sidebar); border: 1px solid var(--gum-accent-gold);
    width: 80px; height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center;
    border-radius: 5px; box-shadow: inset 0 0 10px rgba(0,0,0,0.5); position: relative;
}
.gum.sheet.actor .attribute-box label {
    font-family: var(--gum-font-primary); font-size: 1.3rem; font-weight: 700;
    color: var(--gum-accent-gold); cursor: pointer; line-height: 1;
}
.gum.sheet.actor .attribute-box label:hover { text-shadow: 0 0 8px var(--gum-accent-gold); color: #fff; }
.gum.sheet.actor .attribute-box .attribute-value {
    font-size: 1.4rem; font-weight: 700; color: #dcdcdc;
    background: transparent !important; border: none !important;
    text-align: center; width: 100%;
}
.gum.sheet.actor .attribute-box .attribute-modifier {
    position: absolute; bottom: 0; left: 50%; transform: translate(-50%, 50%);
    font-size: 0.8rem; background: var(--gum-bg-sidebar) !important; border: 1px solid #444 !important;
    padding: 1px 6px; border-radius: 10px; color: #dcdcdc; width: 40px; text-align: center;
}

/* Abas de Navegação */
.gum.sheet.actor nav.sheet-tabs {
    display: flex; justify-content: flex-start; gap: 0.5rem;
    border-bottom: 1px solid var(--gum-border-gold); margin-bottom: 10px;
}
.gum.sheet.actor .sheet-tabs .item {
    width: 42px; height: 38px; display: grid; place-items: center;
    color: var(--gum-bg-cabecalho); border-radius: 3px 3px 0 0; 
    border-bottom: 3px solid transparent; cursor: pointer; transition: all 0.2s;
}
.gum.sheet.actor .sheet-tabs .item:hover { color: #fff; background: var(--gum-bg-card-sutil); }
.gum.sheet.actor .sheet-tabs .item.active {
    background: var(--gum-bg-card-claro); color: var(--gum-accent-gold);
    border-bottom-color: var(--gum-accent-gold);
}

/* Corpo da Aba */
.gum.sheet.actor .sheet-body {
    overflow-y: auto; overflow-x: hidden;
    padding-right: 5px; flex-grow: 1;
}

/* Blocos/Cards Padrão */
.gum.sheet.actor .gum-block, .gum.sheet.actor .skill-block {
    background: var(--gum-bg-card-claro); border: 1px solid var(--gum-border);
    padding: 0.75rem; border-radius: 3px; margin-bottom: 10px;
}
.gum.sheet.actor .block-header {
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid var(--gum-border-gold); margin-bottom: 8px; padding-bottom: 2px;
}
.gum.sheet.actor .block-header h4 {
    font-family: var(--gum-font-secondary); color: var(--gum-text-escuro); margin: 0; font-weight: 700;
}

/* =================================================================== */
/* 7. CHAT CARDS & OUTROS COMPONENTES                                 */
/* =================================================================== */

.gurps-roll-card {
    background: linear-gradient(135deg, #fdfbf6, #f4efe6);
    border: 1px solid #d7ccb8;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
    position: relative;
    font-family: "Roboto", "Segoe UI", sans-serif;
    color: #2f2b28;
    margin-top: 6px;
}

.gurps-roll-card.premium::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #a67c00, #ffd700, #a67c00);
}

.gurps-roll-card .card-header {
    background: #f8f4ed;
    padding: 10px 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    border-bottom: 1px solid #e6ddcd;
}

.gurps-roll-card .header-left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.gurps-roll-card .header-icon {
    width: 42px;
    height: 42px;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid #d7ccb8;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
    background: #fff;
    flex-shrink: 0;
}
.gurps-roll-card .header-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.gurps-roll-card .header-title h3 {
    margin: 0;
    font-family: "Cinzel", serif;
    font-size: 0.95em;
    font-weight: 800;
    color: #2f2b28;
    letter-spacing: 0.01em;
}

.gurps-roll-card .roll-meta-row {
    display: flex;
    flex-wrap: wrap;
    padding: 8px 12px 4px;
    color: #5d524a;
    font-size: 0.88em;
    justify-content: center;
}
.gurps-roll-card .meta-bar {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid #d7ccb8;
    background: #f1e7d9;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
}
.gurps-roll-card .meta-bar.has-mods {
    background: linear-gradient(90deg, #f1e7d9 0%, #f1e7d9 55%, #e8f2e9 100%);
    border-color: #d1c4af;
}
.gurps-roll-card .meta-bar .meta-part {
    font-weight: 800;
    color: #2f2b28;
}
.gurps-roll-card .meta-bar .meta-part strong {
    font-size: 1.05em;
}
.gurps-roll-card .meta-bar .meta-mods {
    font-weight: 700;
    color: #2f6b3f;
}
.gurps-roll-card .meta-bar .meta-mods small {
    font-weight: 700;
    color: #6b5e55;
    font-size: 0.78em;
}

.gurps-roll-card .card-main {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    padding: 8px 12px 12px;
    align-items: center;
}

.gurps-roll-card .total-column,
.gurps-roll-card .dice-column {
    background: #3a3836;
    border: 1px solid #e6ddcd;
    border-radius: 10px;
    padding: 10px 9px;
    text-align: center;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
}
.gurps-roll-card .dice-column {
    background: #f4efe8;
    border-color: #d9cebd;
}
.gurps-roll-card .target-column {
    background: #ffffff;
    border-color: #e4d8c5;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55);
}

.gurps-roll-card .column-label {
    font-size: 0.85em;
    color: #9f9275;
    letter-spacing: 0.02em;
    font-weight: 800;
    margin-bottom: 4px;
    text-transform: uppercase;
}

.gurps-roll-card .big-number {
    font-size: 1.85em;
    font-weight: 900;
    color: #f8f4f1;
    line-height: 1.1;
    margin-bottom: 6px;
}

.gurps-roll-card .margin-chip {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: 800;
    color: #fff;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
}
.gurps-roll-card .margin-chip.success { background: #3c9a5f; }
.gurps-roll-card .margin-chip.failure { background: #b64040; }
.gurps-roll-card .margin-chip.crit-success { background: linear-gradient(90deg, #2d8a4c, #54c487); }
.gurps-roll-card .margin-chip.crit-failure { background: linear-gradient(90deg, #b64040, #e07c7c); }

.gurps-roll-card .dice-row {
    display: flex;
    justify-content: center;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 2px;
}
.gurps-roll-card .die-face {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 18px;
    min-height: 18px;
    padding: 2px 5px;
    border: 1px solid #e6ddcd;
    border-radius: 3px;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(235, 235, 235, 0.9));
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.18);
    font-weight: 700;
    font-size: 0.82rem;
    color: #2f2b28;
}

.gurps-roll-card .target-box {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    font-weight: 800;
    color: #2f2b28;
    font-size: 1.05em;
    padding: 8px 10px;
    border-radius: 12px;
    background: rgba(182, 143, 93, 0.08);
}
.gurps-roll-card .target-box .target-values {
    display: grid;
    gap: 2px;
    justify-items: center;
}
.gurps-roll-card .target-box .target-value {
    font-size: 2.2em;
    font-weight: 900;
    line-height: 1.05;
}
.gurps-roll-card .target-box .capped-original {
    text-decoration: line-through;
    color: #9a3a41;
    opacity: 0.7;
    font-size: 0.9em;
}
.gurps-roll-card .target-box .cap-note {
    display: inline-block;
    padding: 2px 6px;
    background: #f8e5e6;
    border: 1px solid #d59aa0;
    border-radius: 6px;
    color: #9a3a41;
    font-size: 0.78em;
    font-weight: 800;
    margin-top: 2px;
}

.gurps-roll-card .target-box.capped .target-value {
    color: #9a3a41;
}

.gurps-roll-card .result-pill {
    margin: 0 12px 12px;
    padding: 6px 10px;
    border-radius: 8px;
    font-weight: 800;
    color: #fff;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.01em;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    font-size: 0.9em;
}
.gurps-roll-card .result-pill.success,
.gurps-roll-card .result-pill.crit-success {
    background: #235c36
}
.gurps-roll-card .result-pill.failure,
.gurps-roll-card .result-pill.crit-failure {
    background: #7d3030
}
/* =================================================================== */
/* 8. ABA DE EQUIPAMENTOS (Refinada)                                  */
/* =================================================================== */

/* --- Sumário de Carga (Painel Fixo) --- */
.gum-panel {
    background: var(--gum-bg-card-sutil);
    border: 1px solid var(--gum-border-gold);
    border-radius: 4px;
    padding: 8px 12px;
    margin-bottom: 15px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
}

.gum-panel .panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    border-bottom: 1px solid var(--gum-border-light);
    padding-bottom: 4px;
}

.gum-panel .panel-title {
    font-family: var(--gum-font-primary);
    color: var(--gum-primary);
    font-size: 1.1em;
    margin: 0;
}

.encumbrance-total .value {
    font-weight: bold;
    color: var(--gum-accent-red);
    font-size: 1.1em;
}

/* Medidor Visual de Carga */
.encumbrance-meter {
    display: flex;
    gap: 2px;
    height: 28px;
    background: #ccc;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 8px;
    border: 1px solid #999;
}

.encumbrance-step {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #f0f0f0;
    font-size: 0.7em;
    color: #888;
    cursor: help;
    transition: all 0.2s;
}

.encumbrance-step.active {
    background: var(--gum-accent-red); /* Cor de destaque quando ativo */
    color: #fff;
    font-weight: bold;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
}

.encumbrance-step .step-limit {
    font-size: 0.85em;
    opacity: 0.8;
}

/* --- Colunas Colapsáveis (Details/Summary) --- */
.gum-details.equipment-column {
    margin-bottom: 10px;
    border: 1px solid var(--gum-border);
    border-radius: 4px;
    background: var(--gum-bg-paper);
    overflow: hidden;
}

.gum-details.equipment-column > summary {
    list-style: none; /* Remove seta padrão do browser */
    background: rgba(0, 0, 0, 0.05);
    padding: 8px 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.2s;
}

.gum-details.equipment-column > summary:hover {
    background: rgba(0, 0, 0, 0.08);
}

/* A Seta Customizada */
.gum-details.equipment-column > summary .toggle-icon {
    width: 20px;
    transition: transform 0.2s;
    color: var(--gum-primary);
}

.gum-details[open] > summary .toggle-icon {
    transform: rotate(90deg);
}

.gum-details.equipment-column .header-title {
    flex-grow: 1;
    margin: 0;
    font-family: var(--gum-font-secondary);
    font-size: 1.1em;
    color: var(--gum-text-escuro);
}

.gum-details.equipment-column .list-content {
    padding: 10px;
    background: rgba(255, 255, 255, 0.3);
}

/* --- Cards de Equipamento --- */
.flex-wrap-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 0; margin: 0;
    list-style: none;
}

.equipment-card {
    flex: 1 1 280px; /* Cresce, encolhe, base de 280px */
    display: flex;
    align-items: center;
    gap: 8px;
    background: #fff;
    border: 1px solid var(--gum-border-light);
    border-radius: 4px;
    padding: 6px;
    box-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    transition: transform 0.1s, box-shadow 0.1s;
}

.equipment-card:hover {
    transform: translateY(-1px);
    box-shadow: 2px 2px 5px rgba(0,0,0,0.15);
    border-color: var(--gum-accent-gold);
}

.equipment-card .item-icon {
    width: 36px; height: 36px;
    border-radius: 4px;
    object-fit: cover;
    border: 1px solid #ccc;
}

.equipment-card .card-info {
    flex-grow: 1;
    overflow: hidden;
}

.equipment-card .item-name a {
    font-weight: 700;
    color: var(--gum-text-escuro);
    text-decoration: none;
}
.equipment-card .item-name a:hover {
    text-decoration: underline;
    color: var(--gum-primary);
}

/* Tags de Stats (Peso, Custo) */
.equipment-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 2px;
}

.equip-stat-tag {
    font-size: 0.75em;
    background: #eee;
    padding: 1px 6px;
    border-radius: 10px;
    color: #555;
    border: 1px solid #ddd;
}

.equip-stat-tag.shield-tag {
    background: #e3f2fd;
    color: #1565c0;
    border-color: #bbdefb;
}

/* --- Ajuste na Estrutura do Card --- */
.equipment-card {
    flex: 1 1 280px;
    display: grid; /* Mudamos para Grid para melhor controle */
    grid-template-columns: 40px 1fr; /* Coluna 1: Ícone, Coluna 2: Todo o resto */
    gap: 8px;
    background: #fff;
    border: 1px solid var(--gum-border-light);
    border-radius: 4px;
    padding: 8px;
    align-items: start; /* Alinha o ícone no topo */
}

.equipment-card .card-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

/* --- Botões de Controle Lado a Lado --- */
.equipment-card .item-controls {
    display: flex;
    flex-direction: row; /* Horizontal agora! */
    justify-content: flex-end; /* Alinha os botões à direita na linha deles */
    gap: 8px;
    margin-top: 4px;
    padding-top: 4px;
    border-top: 1px dotted #ddd; /* Uma linha sutil para separar das tags */
}

.equipment-card .item-control {
    font-size: 0.9em; /* Aumentamos um pouco para facilitar o clique */
    color: #888;
    transition: all 0.2s;
}

/* Efeito de hover individual mais nítido */
.equipment-card .item-control:hover {
    transform: scale(1.2);
}
/* =================================================================== */
/* 9. ABA SOCIAL (Actor Sheet)                                        */
/* =================================================================== */

.gum.sheet.actor .social-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.gum.sheet.actor .social-block,
.gum.sheet.actor .social-block-fullwidth {
    background: var(--gum-bg-card-claro);
    border: 1px solid var(--gum-border);
    border-radius: 4px;
    padding: 10px;
    display: flex;
    flex-direction: column;
}

.gum.sheet.actor .social-block-fullwidth {
    grid-column: 1 / -1;
    margin-top: 15px;
}

/* Item da Lista Social */
.gum.sheet.actor .tab[data-tab="social"] .item-row {
    padding: 6px 8px;
    border-bottom: 1px dashed var(--gum-border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.gum.sheet.actor .tab[data-tab="social"] .item-content-wrapper {
    display: flex;
    flex-direction: column;
}

.gum.sheet.actor .tab[data-tab="social"] .item-name {
    font-weight: 700;
    color: var(--gum-text-escuro);
}

.gum.sheet.actor .tab[data-tab="social"] .item-details {
    font-size: 0.85em;
    color: var(--gum-text-medio);
    font-style: italic;
}
/* =================================================================== */
/* 10. ABA BIOGRAFIA (LAYOUT VERTICAL: CABEÇALHO + HISTÓRIA)           */
/* =================================================================== */

.gum.sheet.actor .biography-layout {
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: 100%;
    overflow-y: auto; /* Scroll na aba inteira se necessário */
    padding-right: 5px;
}

/* --- BLOCO SUPERIOR: DETALHES FÍSICOS (GRID HORIZONTAL) --- */
.gum.sheet.actor .biography-details {
    background: rgba(0,0,0,0.03);
    border: 1px solid var(--gum-border-light);
    border-radius: 4px;
    padding: 10px;
    flex-shrink: 0; /* Não encolhe, mantém altura necessária */
}

/* Título da Seção de Detalhes (Opcional, se houver no HTML) */
.gum.sheet.actor .biography-details h4 {
    margin-top: 0;
    margin-bottom: 10px;
    border-bottom: 1px solid var(--gum-border-light);
    color: var(--gum-text-subtitulo);
}

/* Lista transformada em Grid de 4 colunas */
.gum.sheet.actor .details-display-list {
    display: grid;
    /* Cria colunas automáticas com largura mínima de 120px */
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
    gap: 10px; 
    padding: 0;
    margin: 0;
    list-style: none;
}

/* O Item de Detalhe (Caixinha) */
.gum.sheet.actor .detail-item {
    display: flex;
    flex-direction: column; /* Rótulo em cima, valor embaixo */
    background: #fff;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 3px;
    padding: 4px 8px;
}

.gum.sheet.actor .detail-label {
    font-size: 0.75em;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--gum-text-medio);
    margin-bottom: 2px;
}

.gum.sheet.actor .detail-value {
    font-weight: 600;
    color: var(--gum-text-escuro);
    font-size: 0.95em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* --- BLOCO INFERIOR: HISTÓRIA (LARGURA TOTAL) --- */
.gum.sheet.actor .biography-story {
    flex-grow: 1; /* Ocupa todo o espaço restante */
    display: flex;
    flex-direction: column;
    
    /* Visual de Papel */
    background: var(--gum-bg-card-claro);
    border: 1px solid var(--gum-border);
    border-radius: 4px;
    padding: 20px 25px; /* Margens generosas como um livro */
    box-shadow: inset 0 0 20px rgba(0,0,0,0.02);
    min-height: 300px; /* Garante um tamanho bom para escrever */
}

/* O Texto da História (Ajustado: Mais Compacto) */
.gum.sheet.actor .description-view {
    line-height: 1.4; /* Reduzido de 1.8 para 1.4 (Mais denso) */
    font-size: 0.95em; /* Reduzido de 1.05em para 0.95em */
    color: var(--gum-text-escuro);
    text-align: justify;
    
    /* Quebra de linha correta */
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

/* Parágrafos */
.gum.sheet.actor .description-view p {
    margin-bottom: 0.8em; /* Menos espaço entre parágrafos */
    text-indent: 15px; /* Recuo levemente menor */
    margin-top: 0;
}

/* Imagens na história */
.gum.sheet.actor .description-view img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    display: block;
    margin: 8px auto; /* Margem reduzida */
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
}

/* Títulos dentro do texto (H1, H2, etc se houver) */
.gum.sheet.actor .description-view h1,
.gum.sheet.actor .description-view h2,
.gum.sheet.actor .description-view h3,
.gum.sheet.actor .description-view h4 {
    margin-top: 0.5em;
    margin-bottom: 0.3em;
    line-height: 1.2;
    color: var(--gum-accent-gold);
}

/* Botões de Editor (Mantidos) */
.gum.sheet.actor .toggle-editor,
.gum.sheet.actor .save-description,
.gum.sheet.actor .cancel-description {
    align-self: flex-start;
    margin-top: 10px;
    background: var(--gum-bg-medium);
    color: #fff;
    border: none;
    padding: 4px 12px; /* Botão levemente menor */
    border-radius: 3px;
    cursor: pointer;
    font-size: 0.85em;
}
.gum.sheet.actor .toggle-editor:hover {
    background: var(--gum-accent-gold);
}

/* =================================================================== */
/* 11. ABA CONDIÇÕES (ESTILO FINAL CONSOLIDADO)                        */
/* =================================================================== */

.gum.sheet.actor .conditions-tab {
    display: none;
}
.gum.sheet.actor .conditions-tab.active {
    display: flex;
    flex-direction: column;
    gap: 5px;
    height: 100%;
    overflow-y: auto;
    padding-right: 5px;
}

/* --- BLOCOS COLAPSÁVEIS (<details>) --- */
.gum.sheet.actor .conditions-tab details.form-section {
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 6px;
    padding: 0;
    margin-bottom: 5px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
    overflow: hidden;
    transition: margin-bottom 0.2s;
}

.gum.sheet.actor .conditions-tab details.form-section[open] {
    margin-bottom: 5px;
    padding-bottom: 10px;
}

/* Cabeçalho do Bloco */
.gum.sheet.actor .conditions-tab .block-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.3);
    border-bottom: 1px solid var(--gum-border-light);
    cursor: pointer;
    list-style: none;
    outline: none;
    transition: background 0.2s;
}
.gum.sheet.actor .conditions-tab .block-header:hover {
    background: rgba(255, 255, 255, 0.5);
}
.gum.sheet.actor .conditions-tab .block-header::-webkit-details-marker { display: none; }

/* Título e Indicadores */
.gum.sheet.actor .conditions-tab .header-left {
    display: flex; align-items: center; gap: 10px;
}
.gum.sheet.actor .conditions-tab .indicator {
    color: var(--gum-text-medio);
    font-size: 0.8em;
    transition: transform 0.2s ease;
}
.gum.sheet.actor .conditions-tab details[open] .indicator {
    transform: rotate(90deg);
    color: var(--gum-accent-gold);
}
.gum.sheet.actor .conditions-tab .header-title {
    font-family: var(--gum-font-secondary);
    font-weight: 700;
    font-size: 1.1em;
    color: var(--gum-text-escuro);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.gum.sheet.actor .conditions-tab .header-counter {
    background: rgba(0,0,0,0.1);
    color: #666;
    font-size: 0.75em;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: 10px;
}
.gum.sheet.actor .conditions-tab .header-hint {
    margin: 0;
    font-size: 0.8em;
    color: var(--gum-text-medio);
    font-style: italic;
}

/* --- GRID DE CONTEÚDO --- */
.gum.sheet.actor .effects-grid-container {
    display: grid;
    /* Grid Responsivo: 2 colunas na maioria das vezes, 1 se muito estreito */
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 10px;
    padding: 12px;
}

/* --- CARD DE EFEITO (Pílula Melhorada) --- */
.gum.sheet.actor .effect-pill-enhanced {
    display: flex;
    align-items: center;
    gap: 10px;
    background: linear-gradient(to right, #fff, #fdfbf7);
    border: 1px solid var(--gum-border-light);
    border-left: 3px solid #ccc;
    border-radius: 4px;
    padding: 6px 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    position: relative;
    transition: all 0.2s ease;
    min-height: 46px;
}

/* Variações de Cor por Tipo */
.gum.sheet.actor .effect-pill-enhanced.temp-effect { border-left-color: var(--gum-accent-orange); }
.gum.sheet.actor .effect-pill-enhanced.perm-effect { border-left-color: var(--gum-accent-blue); }
.gum.sheet.actor .effect-pill-enhanced.passive-rule { border-left-color: var(--gum-accent-green); }

.gum.sheet.actor .effect-pill-enhanced:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    border-color: var(--gum-accent-gold);
}

/* Ícone do Item */
.gum.sheet.actor .effect-pill-enhanced .pill-icon {
    width: 32px; height: 32px;
    border-radius: 4px;
    border: 1px solid rgba(0,0,0,0.1);
    object-fit: cover;
    flex-shrink: 0;
    background: #fff;
}

/* Informações do Item */
.gum.sheet.actor .effect-pill-enhanced .pill-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    overflow: hidden;
    min-width: 0;
}

.gum.sheet.actor .effect-pill-enhanced .pill-name {
    font-family: var(--gum-font-primary);
    font-weight: 700;
    font-size: 0.95em;
    color: var(--gum-text-escuro);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
}

/* Tags internas */
.gum.sheet.actor .effect-pill-enhanced .pill-details {
    display: flex; gap: 6px; align-items: center; margin-top: 2px;
}
.gum.sheet.actor .pill-tag {
    font-size: 0.75em; padding: 1px 5px; border-radius: 3px; font-weight: 600;
    white-space: nowrap; display: flex; align-items: center; gap: 3px;
}
.gum.sheet.actor .pill-tag.duration { background: rgba(197, 160, 91, 0.15); color: #8a6d3b; }
.gum.sheet.actor .pill-tag.source { background: rgba(0,0,0,0.05); color: #666; max-width: 100px; overflow: hidden; text-overflow: ellipsis; }
.gum.sheet.actor .pill-tag.status.on { color: var(--gum-accent-green); background: rgba(56, 156, 104, 0.1); }
.gum.sheet.actor .pill-tag.status.off { color: var(--gum-text-medio); background: rgba(0,0,0,0.05); text-decoration: line-through; }

/* Controles (Direita) */
.gum.sheet.actor .effect-pill-enhanced .pill-controls {
    display: flex; flex-direction: column; gap: 4px; opacity: 0; transition: opacity 0.2s;
    margin-left: 4px; padding-left: 4px; border-left: 1px solid rgba(0,0,0,0.05);
}
.gum.sheet.actor .effect-pill-enhanced:hover .pill-controls { opacity: 1; }
.gum.sheet.actor .effect-pill-enhanced .effect-control {
    color: var(--gum-text-medio); font-size: 0.85em; cursor: pointer; text-align: center; width: 20px;
}
.gum.sheet.actor .effect-pill-enhanced .effect-control:hover { color: var(--gum-accent-gold); }
.gum.sheet.actor .effect-pill-enhanced .effect-control.delete:hover { color: var(--gum-accent-red); }

/* --- SWITCH (BOTÃO TOGGLE) --- */
.gum.sheet.actor .pill-switch-wrapper {
    display: flex; align-items: center; justify-content: center; margin-right: 8px; flex-shrink: 0;
}
.gum.sheet.actor .switch {
    position: relative; display: inline-block; width: 28px; height: 16px; margin: 0;
}
.gum.sheet.actor .switch input { opacity: 0; width: 0; height: 0; }
.gum.sheet.actor .slider {
    position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
    background-color: #ccc; transition: .4s; border-radius: 34px;
}
.gum.sheet.actor .slider:before {
    position: absolute; content: ""; height: 12px; width: 12px; left: 2px; bottom: 2px;
    background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
.gum.sheet.actor input:checked + .slider { background-color: var(--gum-accent-orange); } /* Override Ativo */
.gum.sheet.actor input:checked + .slider:before { transform: translateX(12px); }

/* Placeholder */
.gum.sheet.actor .conditions-tab .placeholder-text {
    grid-column: 1 / -1; text-align: center; color: var(--gum-text-medio);
    font-style: italic; padding: 10px; font-size: 0.9em; opacity: 0.7;
}

/* =================================================================== */
/* 12. ABA PERÍCIAS (DESIGN: BARRA ELEGANTE + LISTA ROBUSTA)           */
/* =================================================================== */

/* --- 1. BARRA DE FERRAMENTAS (TOPO) --- */
.gum.sheet.actor .skills-header-tools {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 5px;
    margin-bottom: 15px; /* Espaço para respirar antes da lista */
    border-bottom: 2px solid var(--gum-border-gold); /* Linha de base forte */
    background: linear-gradient(to bottom, rgba(0,0,0,0.02), transparent); /* Gradiente sutil */
    position: sticky;
    top: 0;
    z-index: 10;
}

/* Container da Busca */
.gum.sheet.actor .skills-search-wrapper {
    position: relative;
    flex: 1;
    max-width: 280px; /* Largura ideal */
}

/* O Ícone de Lupa */
.gum.sheet.actor .skills-search-wrapper i {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gum-text-medio);
    font-size: 0.9em;
    pointer-events: none; /* Deixa clicar através do ícone */
}

/* O Input de Busca */
.gum.sheet.actor .skills-search-wrapper input {
    width: 100%;
    padding: 6px 10px 6px 30px; /* Espaço na esquerda para o ícone */
    border-radius: 20px; /* Pílula arredondada moderna */
    border: 1px solid var(--gum-border-light);
    background-color: rgba(255, 255, 255, 0.3);
    color: var(--gum-text-escuro);
    font-family: var(--gum-font-primary);
    font-size: 0.9em;
    transition: all 0.3s ease;
}

/* Efeito de Foco na Busca */
.gum.sheet.actor .skills-search-wrapper input:focus {
    background-color: #fff;
    border-color: var(--gum-accent-gold);
    box-shadow: 0 0 8px rgba(197, 160, 91, 0.25);
    outline: none;
}

/* Container dos Botões (Direita) */
.gum.sheet.actor .skills-header-buttons {
    display: flex;
    align-items: center;
    gap: 15px; /* Espaço generoso entre os botões */
}

/* Estilo dos Links (Botões) */
.gum.sheet.actor .skills-header-buttons a {
    font-family: var(--gum-font-condensed);
    font-weight: 700;
    font-size: 0.85em;
    text-transform: uppercase;
    color: var(--gum-text-subtitulo); /* Cor de texto discreta */
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    transition: color 0.2s, transform 0.1s;
}

/* Ícones dos Botões */
.gum.sheet.actor .skills-header-buttons a i {
    font-size: 1.1em;
    color: var(--gum-text-medio); /* Ícone um pouco mais claro */
}

/* Hover nos Botões */
.gum.sheet.actor .skills-header-buttons a:hover {
    color: var(--gum-accent-red); /* Destaque ao passar o mouse */
}
.gum.sheet.actor .skills-header-buttons a:hover i {
    color: var(--gum-accent-red);
}

/* Botão Ativo (Toggle) */
.gum.sheet.actor .skills-header-buttons a.active {
    color: var(--gum-accent-gold);
}


/* --- 2. LAYOUT DA LISTA (Árvore e Grupo) --- */

/* Scroll Area & Colunas */
.gum.sheet.actor .skills-scroll-area.group {
    column-count: 2;
    column-gap: 10px; /* Gap entre as duas colunas principais */
    display: block;
}
.gum.sheet.actor .skills-scroll-area.tree {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

/* --- O GRUPO (FOLDER) --- */
.gum.sheet.actor .skill-tree-group {
    background: var(--gum-bg-card-claro);
    border: 1px solid var(--gum-border);
    border-radius: 4px;
    margin-bottom: 8px;
    break-inside: avoid;
    display: inline-block;
    width: 100%;
}

/* Cabeçalho do Grupo */
.gum.sheet.actor .skill-tree-summary {
    background: rgba(0,0,0,0.03);
    padding: 6px 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    list-style: none;
    border-bottom: 1px solid transparent;
    transition: background 0.2s;
}
.gum.sheet.actor .skill-tree-summary:hover {
    background: rgba(0,0,0,0.06);
}
.gum.sheet.actor .skill-tree-group[open] .skill-tree-summary {
    border-bottom: 1px solid var(--gum-border-light);
}
.gum.sheet.actor .skill-tree-summary::-webkit-details-marker { display: none; }

.gum.sheet.actor .st-group-title {
    flex-grow: 1;
    font-family: var(--gum-font-secondary);
    color: var(--gum-text-escuro);
    font-size: 0.95em;
    font-weight: 700;
}

.gum.sheet.actor .st-group-count {
    background: rgba(0,0,0,0.1);
    color: var(--gum-text-medio);
    font-size: 0.75em;
    font-weight: 600;
    padding: 1px 6px;
    border-radius: 10px;
    margin-right: 8px;
}

.gum.sheet.actor .st-icon {
    font-size: 0.8em;
    transition: transform 0.2s;
    color: var(--gum-text-medio);
}
.gum.sheet.actor .skill-tree-group[open] .st-icon { transform: rotate(180deg); }


/* --- ITEM DE PERÍCIA INDIVIDUAL (AJUSTE DE ESPAÇO) --- */
.gum.sheet.actor .skill-tree-item {
    display: flex;
    align-items: center; /* Centraliza verticalmente se o texto tiver 2 linhas */
    padding: 4px 6px; /* Padding lateral reduzido para ganhar espaço */
    border-bottom: 1px solid rgba(0,0,0,0.05);
    position: relative;
    gap: 6px; /* Gap reduzido entre ícone, texto e dado */
    min-height: 40px;
    background: transparent;
    transition: background 0.1s;
}
.gum.sheet.actor .skill-tree-item:last-child { border-bottom: none; }
.gum.sheet.actor .skill-tree-item:hover {
    background: rgba(255,255,255,0.4);
}

/* Ícone da Perícia */
.gum.sheet.actor .st-item-icon {
    width: 32px; height: 32px;
    border-radius: 4px;
    border: 1px solid var(--gum-border);
    background-size: cover;
    flex-shrink: 0; /* Nunca encolhe */
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    z-index: 2;
    transition: transform 0.1s;
}
.gum.sheet.actor .st-item-icon:hover {
    transform: scale(1.05);
    border-color: var(--gum-accent-gold);
}

/* Informações (Nome e Tags) - AJUSTE CRÍTICO */
.gum.sheet.actor .st-item-name {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    overflow: hidden;
    min-width: 0; 
}

/* Nome com Quebra de Linha Automática */
.gum.sheet.actor .st-item-name h4 {
    margin: 0;
    font-size: 12px; /* Fonte reduzida para 12px */
    font-weight: 700;
    color: var(--gum-text-escuro);
    line-height: 1.25;
    cursor: help;
    
    /* Permite quebra de linha em nomes longos */
    white-space: normal; 
    word-break: break-word; 
}
.gum.sheet.actor .st-item-name h4:hover {
    color: var(--gum-accent-red);
}

/* Breadcrumbs (Caminho) */
.gum.sheet.actor .st-inheritance-path {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 3px;
    font-size: 9px;
    margin-top: 2px;
    color: var(--gum-text-medio);
}

/* --- NH BOX (O Dado Robusto) - AJUSTE DE LARGURA --- */
.gum.sheet.actor .st-nh-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    
    width: 34px; /* Largura fixa ligeiramente reduzida */
    height: 32px;
    background: rgba(0,0,0,0.05);
    border: 1px solid var(--gum-border);
    border-radius: 4px;
    flex-shrink: 0; /* Garante que não seja esmagado pelo texto */
}

.gum.sheet.actor .st-nh-box span {
    font-size: 0.65em;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--gum-text-medio);
    line-height: 1;
    margin-bottom: -1px;
}

.gum.sheet.actor .st-nh-box a {
    font-size: 1.2em;
    font-weight: 800;
    color: var(--gum-text-escuro);
    line-height: 1;
    text-decoration: none;
}
.gum.sheet.actor .st-nh-box:hover {
    background: #fff;
    border-color: var(--gum-accent-gold);
    box-shadow: 0 0 5px rgba(197, 160, 91, 0.3);
}
.gum.sheet.actor .st-nh-box:hover a {
    color: var(--gum-accent-gold);
}

/* Pontos (Estrela) */
.gum.sheet.actor .st-pts-box {
    font-size: 10px;
    color: var(--gum-text-medio);
    display: flex;
    align-items: center;
    gap: 2px;
    flex-shrink: 0; /* Não encolhe */
    min-width: 30px;
    justify-content: flex-end;
}
.gum.sheet.actor .st-pts-box i {
    font-size: 9px;
    color: var(--gum-accent-gold);
}

/* Controles (Editar/Deletar) - SEMPRE ALINHADOS */
.gum.sheet.actor .st-controls {
    display: flex;
    gap: 5px;
    opacity: 0;
    transition: opacity 0.2s;
    margin-left: 2px;
    flex-shrink: 0; /* Não encolhe */
}
.gum.sheet.actor .skill-tree-item:hover .st-controls { opacity: 1; }

.gum.sheet.actor .st-controls a {
    color: var(--gum-text-medio);
    font-size: 11px;
}
.gum.sheet.actor .st-controls a:hover { color: var(--gum-text-escuro); }

/* --- LINHAS GUIA (Modo Árvore) --- */
/* Mantidas iguais para não quebrar o modo Tree */
.gum.sheet.actor .skill-tree-item.indent-1 { padding-left: 25px; }
.gum.sheet.actor .skill-tree-item.indent-2 { padding-left: 45px; }
.gum.sheet.actor .skill-tree-item.indent-3 { padding-left: 65px; }

.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-1::before,
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-2::before,
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-3::before {
    content: ''; position: absolute; left: 10px; top: -50%; height: 100%; width: 1px;
    border-left: 1px solid rgba(0,0,0,0.15); z-index: 1;
}
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-1::after,
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-2::after,
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-3::after {
    content: ''; position: absolute; top: 50%; height: 1px; width: 10px;
    border-top: 1px solid rgba(0,0,0,0.15); z-index: 1;
}
/* Ajustes de posição */
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-1::after { left: 10px; }
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-2::before { left: 30px; }
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-2::after { left: 30px; }
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-3::before { left: 50px; }
.gum.sheet.actor .skills-scroll-area.tree .skill-tree-item.indent-3::after { left: 50px; }

/* =================================================================== */
/* 13. ABA MAGIAS E PODERES (Refinado: Sutileza)                       */
/* =================================================================== */

/* O Container Principal */
.gum.sheet.actor .casting-ability-box {
    background: var(--gum-bg-card-claro);
    border: 1px solid var(--gum-border);
    border-top: 3px solid var(--gum-accent-gold); /* Topo dourado para destaque */
    border-radius: 4px;
    margin-bottom: 15px; /* Separação da lista de magias */
    box-shadow: var(--gum-shadow-sutil);
    overflow: hidden;
}

/* O Cabeçalho (Título e Subtítulo) */
.gum.sheet.actor .casting-ability-box .block-header {
    background: linear-gradient(to bottom, rgba(0,0,0,0.05), rgba(0,0,0,0.01));
    padding: 10px 12px;
    border-bottom: 1px solid var(--gum-border-light);
    display: flex;
    justify-content: space-between;
    align-items: flex-start; /* Alinha no topo caso o texto quebre */
}

/* Container do Texto Principal */
.gum.sheet.actor .casting-ability-box .header-main-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

/* O Título (Ex: Magery 3) */
.gum.sheet.actor .casting-ability-box h4 {
    font-family: var(--gum-font-secondary); /* Cinzel */
    font-size: 1.4em;
    font-weight: 700;
    color: var(--gum-text-escuro);
    margin: 0;
    line-height: 1.2;
    text-shadow: 0 1px 0 rgba(255,255,255,0.8);
}

/* O Subtítulo (Ex: Fonte: Divina | Talento +2) */
.gum.sheet.actor .casting-ability-box .header-subtitle {
    font-family: var(--gum-font-primary);
    font-size: 0.85em;
    color: var(--gum-text-subtitulo); /* Cor bronze/marrom */
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Botão de Editar (Engrenagem) */
.gum.sheet.actor .casting-ability-box .header-controls a {
    color: var(--gum-text-medio);
    font-size: 1em;
    transition: color 0.2s, transform 0.2s;
    cursor: pointer;
    padding: 4px; /* Aumenta área de clique */
}
.gum.sheet.actor .casting-ability-box .header-controls a:hover {
    color: var(--gum-accent-gold);
    transform: rotate(30deg); /* Efeito sutil de rotação */
}

/* Área de Descrição */
.gum.sheet.actor .casting-ability-box .ability-description {
    padding: 12px;
    font-size: 0.95em;
    line-height: 1.6;
    color: var(--gum-text-escuro);
    background-color: #fff; /* Fundo branco para leitura fácil */
    min-height: 40px; /* Garante altura mínima se vazio */
}

/* Ajuste para parágrafos dentro da descrição (TinyMCE gera <p>) */
.gum.sheet.actor .casting-ability-box .ability-description p {
    margin: 0 0 8px 0;
}
.gum.sheet.actor .casting-ability-box .ability-description p:last-child {
    margin-bottom: 0;
}

.gum.sheet.actor .spell-list-v2 {
    display: flex;
    flex-direction: column;
    gap: 4px; /* Espaço menor entre itens para compactar */
}

/* O Card do Item (Fechado) */
.gum.sheet.actor .spell-card-details {
    background: var(--gum-bg-card-claro);
    border: 1px solid var(--gum-border-light);
    border-left: 3px solid var(--gum-accent-purple); /* Cor da Magia */
    border-radius: 3px;
    transition: all 0.2s;
}

/* Variação para Poderes */
.gum.sheet.actor .spell-card-details.power-card {
    border-left-color: var(--gum-accent-green); /* Cor de Poder */
}

/* Cabeçalho do Item (Summary) */
.gum.sheet.actor .spell-summary {
    padding: 5px 8px; /* Padding vertical reduzido */
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: transparent;
    transition: background 0.1s;
}
.gum.sheet.actor .spell-summary:hover {
    background: rgba(0,0,0,0.03);
}

/* Nome do Item */
.gum.sheet.actor .spell-name {
    font-family: var(--gum-font-primary);
    font-weight: 600;
    font-size: 13px; /* Tamanho legível */
    color: var(--gum-text-escuro);
    margin-left: 5px;
}

/* Container de Stats Rápidos (Direita) */
.gum.sheet.actor .spell-quick-stats {
    display: flex;
    align-items: center;
    gap: 12px;
}

/* NH Box (Destaque sutil) */
.gum.sheet.actor .quick-stat.nh {
    display: flex;
    align-items: center;
    border: 1px solid var(--gum-border-light);
    border-radius: 3px;
    overflow: hidden;
    font-size: 11px;
}
.gum.sheet.actor .quick-stat.nh label {
    background: rgba(0,0,0,0.05);
    padding: 1px 5px;
    color: var(--gum-text-medio);
    font-weight: 600;
}
.gum.sheet.actor .quick-stat.nh .value {
    padding: 1px 6px;
    font-weight: 700;
    color: var(--gum-text-escuro);
    background: #fff;
}
.gum.sheet.actor .quick-stat.nh .value:hover {
    background: var(--gum-accent-gold);
    color: #fff;
}

/* Conteúdo Expandido (Clean) */
.gum.sheet.actor .spell-expanded-content {
    padding: 10px;
    background: #fff;
    border-top: 1px solid var(--gum-border-light);
    font-size: 12px;
}

/* Tags Internas (Mais elegantes) */
.gum.sheet.actor .tag-box {
    display: inline-flex;
    align-items: center;
    border: 1px solid var(--gum-border-light);
    border-radius: 3px;
    font-size: 11px;
    background: #fbfbfb;
    margin-right: 4px;
    margin-bottom: 4px;
}
.gum.sheet.actor .tag-box label {
    background: rgba(0,0,0,0.03);
    color: var(--gum-text-medio);
    padding: 2px 6px;
    font-weight: 600;
    border-right: 1px solid var(--gum-border-light);
    text-transform: uppercase;
    font-size: 0.9em;
}
.gum.sheet.actor .tag-box .value {
    padding: 2px 8px;
    color: var(--gum-text-escuro);
    font-weight: 500;
}

/* =================================================================== */
/* 14. ABA COMBATE                             */
/* =================================================================== */

/* Layout Principal: 2 Colunas Assimétricas */
.gum.sheet.actor .combat-main-content {
    display: grid;
    /* Coluna RD fixa (140px) | Espaço | Coluna Ataques (Resto) */
    grid-template-columns: 150px 1fr; 
    gap: 15px;
    align-items: start;
    height: 100%; /* Garante que preencha a altura */
}

.gum.sheet.actor .combat-left-column,
.gum.sheet.actor .combat-right-column {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* --- Tabela de RD (Estilo "Livro de Regras") --- */
.gum.sheet.actor .dr-location-block {
    background: var(--gum-bg-card-claro);
    border: 1px solid var(--gum-border);
    padding: 0; /* Remove padding para o header encostar */
    border-radius: 4px;
    overflow: hidden; /* Para os cantos arredondados */
    box-shadow: var(--gum-shadow-sutil);
}

.gum.sheet.actor .dr-location-block .block-header {
    background: rgba(0,0,0,0.05);
    padding: 6px 10px;
    border-bottom: 1px solid var(--gum-border-light);
    margin: 0; /* Remove margem para colar na lista */
}

.gum.sheet.actor .dr-location-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.gum.sheet.actor .dr-location-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 10px;
    border-bottom: 1px solid rgba(0,0,0,0.03);
    font-size: 11px; /* Fonte mais sutil */
    transition: background 0.1s;
}

/* Efeito Zebrado Sutil */
.gum.sheet.actor .dr-location-row:nth-child(even) {
    background: rgba(0,0,0,0.02);
}
.gum.sheet.actor .dr-location-row:last-child {
    border-bottom: none;
}
.gum.sheet.actor .dr-location-row:hover {
    background: rgba(197, 160, 91, 0.1); /* Dourado muito leve */
    cursor: pointer;
}

.gum.sheet.actor .location-name {
    color: var(--gum-text-escuro);
    font-weight: 500;
}
/* O número pequeno do dado (ex: 3-4) */
.gum.sheet.actor .location-name span {
    color: var(--gum-text-medio);
    font-size: 0.85em;
    margin-left: 4px;
}

.gum.sheet.actor .location-dr-value {
    font-family: var(--gum-font-condensed);
    font-weight: 700;
    color: var(--gum-accent-blue); /* Azul para defesa */
    font-size: 1.1em;
}

/* --- Card de Dano Básico (GdP/GeB) --- */
.gum.sheet.actor .basic-damage-card {
    padding: 0;
    border: 1px solid var(--gum-border);
    border-radius: 4px;
    background: var(--gum-bg-card-claro);
    overflow: hidden;
}
.gum.sheet.actor .basic-damage-card .block-header {
    padding: 4px 8px;
    background: rgba(0,0,0,0.03);
    border-bottom: 1px solid var(--gum-border-light);
    margin: 0;
}
.gum.sheet.actor .damage-halves {
    display: flex;
}
.gum.sheet.actor .damage-half {
    flex: 1;
    text-align: center;
    padding: 8px 0;
    cursor: pointer;
    transition: background 0.2s;
}
.gum.sheet.actor .damage-half:first-child {
    border-right: 1px solid var(--gum-border-light);
}
.gum.sheet.actor .damage-half:hover {
    background: var(--gum-accent-red); /* Vermelho no hover */
}
.gum.sheet.actor .damage-half:hover label,
.gum.sheet.actor .damage-half:hover .value {
    color: #fff;
}
.gum.sheet.actor .damage-half label {
    font-size: 9px;
    text-transform: uppercase;
    color: var(--gum-text-medio);
    display: block;
    margin-bottom: 2px;
}
.gum.sheet.actor .damage-half .value {
    font-size: 1.2em;
    font-weight: 700;
    color: var(--gum-text-escuro);
}

/* 14.1 Lista de Grupos de Ataque */
.gum.sheet.actor .attack-group-list-v2 {
    display: flex;
    flex-direction: column;
    gap: 10px; /* Mais espaço entre os grupos para respirar */
}

/* O Container do Grupo (Detalhes) */
.gum.sheet.actor .attack-group-details {
    background: var(--gum-bg-card-claro);
    border: 1px solid var(--gum-border);
    border-radius: 4px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* Sombra suave */
    transition: box-shadow 0.2s ease, border-color 0.2s ease;
}

.gum.sheet.actor .attack-group-details:hover {
    border-color: var(--gum-border-gold);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* O Cabeçalho Clicável (Summary) */
.gum.sheet.actor .group-summary {
    background: linear-gradient(to right, rgba(0,0,0,0.02), rgba(0,0,0,0.05)); 
    padding: 8px 12px; /* Mais padding para toque/clique fácil */
    cursor: pointer;
    list-style: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid transparent; /* Invisível quando fechado */
    transition: background 0.2s, border-color 0.2s;
}

.gum.sheet.actor .group-summary:hover {
    background: rgba(0,0,0,0.08);
}

.gum.sheet.actor .attack-group-details[open] .group-summary {
    background: var(--gum-bg-medium); /* Mais escuro quando aberto para destaque */
    color: var(--gum-text-claro); /* Inverte a cor do texto para contraste */
    border-bottom: 1px solid var(--gum-border-light);
}

.gum.sheet.actor .group-summary::-webkit-details-marker { display: none; }

/* Elementos do Cabeçalho */
.gum.sheet.actor .summary-left {
    display: flex; align-items: center; gap: 10px;
}
.gum.sheet.actor .summary-right {
    display: flex; align-items: center; gap: 8px;
}

.gum.sheet.actor .indicator {
    font-size: 0.8em; 
    color: var(--gum-text-medio); 
    transition: transform 0.2s;
}
.gum.sheet.actor .attack-group-details[open] .indicator {
    transform: rotate(90deg);
    color: var(--gum-accent-gold); /* Destaque na seta quando aberto */
}

.gum.sheet.actor .group-name {
    font-family: var(--gum-font-secondary); /* Cinzel para elegância */
    font-weight: 700;
    color: var(--gum-text-escuro);
    font-size: 1.05em; /* Ligeiramente maior */
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.gum.sheet.actor .attack-group-details[open] .group-name {
    color: var(--gum-accent-gold); /* Dourado no título quando aberto */
}

/* Tags do Cabeçalho */
.gum.sheet.actor .group-tag {
    font-size: 0.75em;
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: 600;
    text-transform: uppercase;
}
.gum.sheet.actor .group-tag.weight {
    color: var(--gum-text-medio);
    background: rgba(0,0,0,0.1);
}
/* Adaptação das tags quando o cabeçalho fica escuro (aberto) */
.gum.sheet.actor .attack-group-details[open] .group-tag.weight {
    color: #ccc;
    background: rgba(255,255,255,0.1);
}

.gum.sheet.actor .group-tag.db { background: var(--gum-accent-blue); color: #fff; }
.gum.sheet.actor .group-tag.pw { background: var(--gum-accent-green); color: #fff; }
.gum.sheet.actor .group-tag.sp_cl { background: var(--gum-accent-purple); color: #fff; }

/* Ícone de Editar no Cabeçalho */
.gum.sheet.actor .group-summary .item-edit {
    color: var(--gum-text-medio);
    transition: color 0.2s;
}
.gum.sheet.actor .group-summary .item-edit:hover {
    color: var(--gum-accent-gold);
}
.gum.sheet.actor .attack-group-details[open] .group-summary .item-edit {
    color: rgba(255,255,255,0.6);
}
.gum.sheet.actor .attack-group-details[open] .group-summary .item-edit:hover {
    color: #fff;
}


/* --- CONTEÚDO EXPANDIDO (Linhas de Ataque) --- */
.gum.sheet.actor .group-content {
    background: #fff; 
    padding: 0; /* Remove padding extra do container */
}

/* Linha Individual de Ataque */
.gum.sheet.actor .attack-row {
    display: grid; /* Mudança para Grid para melhor alinhamento */
    grid-template-columns: 24px 1fr; /* Ícone | Info */
    gap: 12px;
    padding: 10px 12px;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    align-items: start; /* Alinha no topo para casos de texto longo */
    transition: background 0.1s;
}
.gum.sheet.actor .attack-row:last-child { border-bottom: none; }
.gum.sheet.actor .attack-row:hover {
    background: rgba(0,0,0,0.02); /* Highlight sutil ao passar o mouse */
}

/* Ícone do Tipo (Espada/Alvo) */
.gum.sheet.actor .attack-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%; /* Centraliza verticalmente na linha */
    color: var(--gum-accent-gold);
    font-size: 1.1em;
    opacity: 0.8;
}

/* Container de Informações */
.gum.sheet.actor .attack-info {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

/* Cabeçalho do Ataque (Nome + Submodo) */
.gum.sheet.actor .attack-header {
    display: flex; 
    align-items: center; 
    gap: 8px;
    flex-wrap: wrap; /* Permite quebrar linha se o nome for longo */
}
.gum.sheet.actor .attack-mode {
    font-family: var(--gum-font-primary);
    font-weight: 700; 
    font-size: 0.95em; 
    color: var(--gum-text-escuro);
}
.gum.sheet.actor .attack-submode {
    font-size: 0.85em; 
    color: var(--gum-text-medio); 
    font-style: italic;
}

/* Flags (U = Desbalanceada, F = Esgrima) */
.gum.sheet.actor .attack-flag {
    font-size: 0.65em; 
    font-weight: 800; 
    color: #fff;
    padding: 1px 5px; 
    border-radius: 2px; 
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-block;
    vertical-align: middle;
}
.gum.sheet.actor .attack-flag.u { background: var(--gum-accent-orange); }
.gum.sheet.actor .attack-flag.f { background: var(--gum-accent-blue); }

/* --- Tags de Dados (NH, Dano, etc.) --- */
.gum.sheet.actor .attack-tags {
    display: flex; 
    flex-wrap: wrap; 
    gap: 6px;
    align-items: center;
}

/* Estilo Base da Tag */
.gum.sheet.actor .tag-box {
    display: inline-flex;
    align-items: stretch;
    border: 1px solid var(--gum-border-light);
    border-radius: 3px;
    font-size: 0.8em;
    background: #f9f9f9;
    overflow: hidden;
    height: 22px; /* Altura fixa para alinhamento perfeito */
}

/* Rótulo da Tag */
.gum.sheet.actor .tag-box label {
    background: rgba(0,0,0,0.04);
    color: var(--gum-text-medio);
    padding: 0 6px;
    font-weight: 700;
    border-right: 1px solid var(--gum-border-light);
    display: flex;
    align-items: center;
    font-size: 0.85em;
    text-transform: uppercase;
}

/* Valor da Tag */
.gum.sheet.actor .tag-box .value {
    padding: 0 8px;
    color: var(--gum-text-escuro);
    font-weight: 600;
    display: flex;
    align-items: center;
    background: transparent;
    transition: all 0.2s;
}

/* Variação: Dano */
.gum.sheet.actor .tag-box.damage {
    border-color: rgba(165, 53, 65, 0.2);
}
.gum.sheet.actor .tag-box.damage label {
    background: rgba(165, 53, 65, 0.05);
    color: var(--gum-accent-red);
    border-right-color: rgba(165, 53, 65, 0.2);
}
.gum.sheet.actor .tag-box.damage .value {
    color: var(--gum-accent-red);
}

/* Variação: NH (Destaque Principal) */
.gum.sheet.actor .tag-box:first-child { /* Assume que NH é sempre o primeiro */
    border-color: var(--gum-border-gold);
}
.gum.sheet.actor .tag-box:first-child label {
    background: rgba(197, 160, 91, 0.1);
    color: var(--gum-accent-bronze);
    border-right-color: var(--gum-border-gold);
}

/* Interatividade (Links Roláveis) */
.gum.sheet.actor .tag-box a.rollable:hover,
.gum.sheet.actor .tag-box a.rollable-damage:hover {
    background: var(--gum-accent-gold);
    color: #fff !important; /* Força texto branco no hover */
    text-decoration: none;
    cursor: pointer;
}
/* =================================================================== */
/* 17. ABA CARACTERÍSTICAS (COLAPSÁVEL & ELEGANTE)                     */
/* =================================================================== */

/* O Bloco de Seção (Agora usando <details>) */
.gum.sheet.actor .tab[data-tab="characteristics"] details.form-section {
    margin-bottom: 20px;
    
    /* Visual de Container Sutil */
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 6px;
    padding: 0; /* Padding controlado internamente */
    box-shadow: inset 0 0 15px rgba(0,0,0,0.03);
    overflow: hidden; /* Importante para a animação */
    transition: all 0.2s ease;
}

/* Quando fechado, removemos o padding inferior para ficar compacto */
.gum.sheet.actor .tab[data-tab="characteristics"] details.form-section:not([open]) {
    padding-bottom: 0;
    border-bottom-color: transparent;
}

/* O Cabeçalho Clicável (<summary>) */
.gum.sheet.actor .tab[data-tab="characteristics"] .block-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    
    background: rgba(255,255,255,0.2); /* Destaque sutil no header */
    border-bottom: 1px solid var(--gum-border-light);
    padding: 8px 12px;
    margin: 0; /* Remove margem para colar no topo */
    cursor: pointer;
    list-style: none; /* Remove seta padrão do navegador */
    outline: none;
    transition: background 0.2s;
}

/* Remove marcador padrão em alguns browsers */
.gum.sheet.actor .tab[data-tab="characteristics"] .block-header::-webkit-details-marker {
    display: none;
}

.gum.sheet.actor .tab[data-tab="characteristics"] .block-header:hover {
    background: rgba(255,255,255,0.4);
}

/* Container Esquerdo (Seta + Input) */
.gum.sheet.actor .tab[data-tab="characteristics"] .header-left {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-grow: 1;
}

/* A Seta Indicadora */
.gum.sheet.actor .tab[data-tab="characteristics"] .indicator {
    font-size: 0.8em;
    color: var(--gum-text-medio);
    transition: transform 0.2s ease;
}

/* Rotação da Seta quando aberto */
.gum.sheet.actor .tab[data-tab="characteristics"] details[open] .indicator {
    transform: rotate(90deg);
    color: var(--gum-accent-gold);
}

/* O Input do Título */
.gum.sheet.actor .tab[data-tab="characteristics"] .block-header input {
    font-family: var(--gum-font-condensed);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: 1.1em;
    font-weight: 700;
    color: var(--gum-text-subtitulo);
    background: transparent;
    border: none;
    padding: 0;
    margin: 0;
    width: 100%;
    text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
    cursor: text; /* Indica que é editável */
}
.gum.sheet.actor .tab[data-tab="characteristics"] .block-header input:focus {
    color: var(--gum-text-escuro);
    outline: none;
}

/* Ícone de Ordenar */
.gum.sheet.actor .sort-control {
    color: rgba(0,0,0,0.3);
    cursor: pointer;
    opacity: 0.8;
    transition: all 0.2s;
    padding: 4px; /* Aumenta área de clique */
}
.gum.sheet.actor .sort-control:hover {
    color: var(--gum-accent-gold);
    opacity: 1;
}

/* Lista de Itens (Container) */
.gum.sheet.actor .tab[data-tab="characteristics"] .flex-wrap-container {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 12px; /* Adiciona o padding aqui, dentro do conteúdo */
    margin: 0;
    list-style: none;
}

/* --- CARD INDIVIDUAL (MANTIDO DO ANTERIOR) --- */
.gum.sheet.actor .characteristic-card {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(to bottom, #fff, #fdfbf7);
    border: 1px solid var(--gum-border-light);
    border-radius: 3px;
    padding: 4px 6px;
    flex-basis: calc(50% - 3px); 
    flex-grow: 1;
    min-width: 200px;
    height: 36px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    position: relative;
    overflow: hidden;
    transition: all 0.15s ease;
}

.gum.sheet.actor .characteristic-card:hover {
    border-color: var(--gum-accent-gold);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transform: translateY(-1px);
}

.gum.sheet.actor .characteristic-card::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
    background: rgba(0,0,0,0.1); transition: background 0.2s;
}
.gum.sheet.actor .characteristic-card:hover::before { background: var(--gum-accent-gold); }

.gum.sheet.actor .characteristic-card .item-icon {
    width: 28px; height: 28px;
    border-radius: 3px; border: 1px solid rgba(0,0,0,0.1);
    object-fit: cover; flex-shrink: 0; background-color: #fff; margin-left: 4px;
}

.gum.sheet.actor .characteristic-card .card-info {
    flex-grow: 1; display: flex; flex-direction: row; justify-content: space-between;
    align-items: center; overflow: hidden; min-width: 0; gap: 5px;
}

.gum.sheet.actor .characteristic-card .item-name { flex-grow: 1; overflow: hidden; min-width: 0; }
.gum.sheet.actor .characteristic-card .item-name a {
    font-family: var(--gum-font-primary); font-weight: 600; font-size: 0.9em;
    color: var(--gum-text-escuro); text-decoration: none; line-height: 1.1;
    display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.gum.sheet.actor .characteristic-card .item-name a:hover { color: var(--gum-accent-red); }

.gum.sheet.actor .characteristic-card .card-details { display: flex; align-items: center; gap: 4px; flex-shrink: 0; }
.gum.sheet.actor .characteristic-card .card-points {
    font-size: 0.75em; font-weight: 700; color: #8a6d3b; background: rgba(197, 160, 91, 0.1);
    padding: 1px 5px; border-radius: 3px; border: 1px solid rgba(197, 160, 91, 0.2); white-space: nowrap;
}
.gum.sheet.actor .characteristic-card .card-cr {
    font-size: 0.75em; font-weight: 700; color: var(--gum-accent-blue); background: rgba(86, 129, 156, 0.1);
    padding: 1px 5px; border-radius: 3px; border: 1px solid rgba(86, 129, 156, 0.2); white-space: nowrap;
}

.gum.sheet.actor .characteristic-card .item-controls {
    display: flex; gap: 4px; opacity: 0; transition: opacity 0.1s; padding-left: 4px; border-left: 1px solid rgba(0,0,0,0.1);
}
.gum.sheet.actor .characteristic-card:hover .item-controls { opacity: 1; }
.gum.sheet.actor .characteristic-card .item-controls a { color: var(--gum-text-medio); font-size: 0.85em; padding: 2px; }
.gum.sheet.actor .characteristic-card .item-controls a:hover { color: var(--gum-accent-gold); }
.gum.sheet.actor .characteristic-card .item-controls a.item-delete:hover { color: var(--gum-accent-red); }

.gum.sheet.actor .tab[data-tab="characteristics"] .placeholder-text {
    width: 100%; text-align: center; font-style: italic; color: var(--gum-text-medio);
    padding: 10px; font-size: 0.85em; opacity: 0.7;
}

/* =================================================================== */
/* 18. ABA MODIFICADORES (GM CONTROL - CORRIGIDO & COLAPSÁVEL)         */
/* =================================================================== */

/* --- 1. CORREÇÃO DO VAZAMENTO DE ABA --- */
.gum.sheet.actor .modifiers-tab {
    display: none; /* Escondido por padrão */
}

/* Só ativa o Flex quando a aba está ATIVA */
.gum.sheet.actor .modifiers-tab.active {
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden; 
}

/* --- BARRA DE FERRAMENTAS --- */
.gum.sheet.actor .modifiers-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    background: linear-gradient(to bottom, rgba(255,255,255,0.6), rgba(255,255,255,0.3));
    border-bottom: 1px solid var(--gum-border-gold);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    flex-shrink: 0;
    margin-bottom: 10px;
    gap: 10px;
}

/* Checkbox "Ler Compêndio" */
.gum.sheet.actor .modifiers-toolbar .toggle-label {
    display: flex; align-items: center; gap: 6px;
    font-size: 0.85em; font-weight: 600; color: var(--gum-text-subtitulo); cursor: pointer;
}
.gum.sheet.actor .modifiers-toolbar .toggle-label input { margin: 0; accent-color: var(--gum-accent-gold); }

/* Busca */
.gum.sheet.actor .modifiers-toolbar .search-wrapper { flex-grow: 1; position: relative; max-width: 250px; }
.gum.sheet.actor .modifiers-toolbar .search-wrapper i { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--gum-text-medio); font-size: 0.8em; }
.gum.sheet.actor .modifiers-toolbar .modifier-search {
    width: 100%; padding: 4px 10px 4px 28px; border-radius: 15px;
    border: 1px solid var(--gum-border-light); background: rgba(255,255,255,0.6);
    font-size: 0.85em; transition: all 0.2s;
}
.gum.sheet.actor .modifiers-toolbar .modifier-search:focus { background: #fff; border-color: var(--gum-accent-gold); box-shadow: 0 0 5px rgba(197, 160, 91, 0.3); }

/* Botões */
.gum.sheet.actor .modifiers-toolbar .right { display: flex; gap: 5px; }
.gum.sheet.actor .modifiers-toolbar button {
    background: transparent; border: 1px solid var(--gum-border-light);
    color: var(--gum-text-medio); width: 28px; height: 28px; border-radius: 4px;
    cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;
}
.gum.sheet.actor .modifiers-toolbar button:hover { background: var(--gum-bg-medium); color: #fff; border-color: var(--gum-bg-medium); }
.gum.sheet.actor .modifiers-toolbar button.clear-modifiers-btn:hover { background: var(--gum-accent-red); border-color: var(--gum-accent-red); }


/* --- LAYOUT MASONRY (COLUNAS) --- */
.gum.sheet.actor .modifiers-masonry-layout {
    column-count: 2; 
    column-gap: 15px;
    padding: 5px 5px 20px 5px;
    overflow-y: auto;
    height: 100%;
    scrollbar-width: thin;
}

/* Container de Contexto (O Bloco Principal) */
.gum.sheet.actor .context-wrapper {
    break-inside: avoid;
    margin-bottom: 15px;
    display: inline-block;
    width: 100%;
}

/* O Detalhes Colapsável */
.gum.sheet.actor .context-details {
    background: rgba(0,0,0,0.03);
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 6px;
    overflow: hidden;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
    transition: all 0.2s;
}

/* Cabeçalho do Contexto */
.gum.sheet.actor .context-summary {
    background: rgba(255,255,255,0.5);
    padding: 8px 10px;
    border-bottom: 1px solid transparent;
    cursor: pointer;
    list-style: none;
    display: flex; justify-content: space-between; align-items: center;
    transition: background 0.2s;
}
.gum.sheet.actor .context-summary:hover {
    background: rgba(255,255,255,0.8);
}
.gum.sheet.actor .context-details[open] .context-summary {
    border-bottom-color: var(--gum-border-light);
    background: rgba(255,255,255,0.3);
}
.gum.sheet.actor .context-summary::-webkit-details-marker { display: none; }

/* Título e Ícone (Com Seta CSS) */
.gum.sheet.actor .ctx-title {
    font-family: var(--gum-font-secondary);
    font-weight: 700;
    color: var(--gum-text-escuro);
    font-size: 1em;
    display: flex; align-items: center; gap: 8px;
}

/* Adiciona a seta via CSS (FontAwesome) antes do ícone */
.gum.sheet.actor .ctx-title::before {
    content: '\f054'; /* Chevron Right */
    font-family: "Font Awesome 6 Free"; /* Ajuste conforme versão do Foundry (5 ou 6) */
    font-weight: 900;
    font-size: 0.8em;
    color: var(--gum-text-medio);
    transition: transform 0.2s;
    margin-right: 2px;
}

/* Gira a seta quando aberto */
.gum.sheet.actor .context-details[open] .ctx-title::before {
    transform: rotate(90deg);
    color: var(--gum-accent-gold);
}

.gum.sheet.actor .ctx-title i {
    color: var(--gum-accent-gold);
    font-size: 1.1em;
    opacity: 0.8;
}

/* Botão de Adicionar (+) */
.gum.sheet.actor .ctx-add-btn {
    color: var(--gum-text-medio); font-size: 0.8em; transition: color 0.2s;
}
.gum.sheet.actor .ctx-add-btn:hover { color: var(--gum-accent-green); }

/* Corpo do Contexto */
.gum.sheet.actor .context-body {
    padding: 8px;
    display: flex; flex-direction: column; gap: 12px;
}

/* --- SUBGRUPOS INTERNOS (Manobras, etc.) --- */
.gum.sheet.actor .subgroup-details {
    padding-left: 4px;
}

/* Cabeçalho do Subgrupo */
.gum.sheet.actor .subgroup-summary {
    font-size: 0.85em;
    font-weight: 700;
    color: var(--gum-text-subtitulo);
    text-transform: uppercase;
    cursor: pointer;
    margin-bottom: 6px;
    list-style: none;
    display: flex; align-items: center; gap: 5px;
}
.gum.sheet.actor .subgroup-summary:hover { color: var(--gum-text-escuro); }
.gum.sheet.actor .subgroup-summary::-webkit-details-marker { display: none; }

/* Seta do Subgrupo */
.gum.sheet.actor .subgroup-summary::before {
    content: '\f0da'; /* Caret Right */
    font-family: "Font Awesome 6 Free";
    color: var(--gum-text-medio);
    transition: transform 0.2s;
}
.gum.sheet.actor .subgroup-details[open] .subgroup-summary::before {
    transform: rotate(90deg);
}

/* Grid de Itens Pequenos */
.gum.sheet.actor .mod-mini-grid {
    display: flex; flex-wrap: wrap; gap: 5px;
}

/* --- MINI CARD DE MODIFICADOR --- */
.gum.sheet.actor .mod-mini-card {
    display: flex; align-items: center; justify-content: space-between;
    background: #fff;
    border: 1px solid var(--gum-border-light);
    border-radius: 3px;
    padding: 3px 6px;
    flex-grow: 1; flex-basis: calc(50% - 3px); min-width: 120px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    transition: all 0.15s ease;
    cursor: grab;
}
.gum.sheet.actor .mod-mini-card:hover {
    border-color: var(--gum-accent-gold);
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.gum.sheet.actor .mod-info { display: flex; align-items: center; gap: 6px; overflow: hidden; }
.gum.sheet.actor .mod-info img { width: 20px; height: 20px; border-radius: 3px; background: #f0f0f0; flex-shrink: 0; }
.gum.sheet.actor .mod-name { font-size: 0.85em; font-weight: 600; color: var(--gum-text-escuro); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Valor */
.gum.sheet.actor .mod-val {
    font-family: var(--gum-font-condensed); font-weight: 700; font-size: 0.9em;
    color: var(--gum-accent-green); background: rgba(56, 156, 104, 0.1);
    padding: 0 5px; border-radius: 3px; margin-left: 5px; white-space: nowrap;
}
.gum.sheet.actor .mod-val.neg { color: var(--gum-accent-red); background: rgba(165, 53, 65, 0.1); }

/* Controles */
.gum.sheet.actor .mod-controls {
    display: none; gap: 4px; margin-left: 5px; padding-left: 5px; border-left: 1px solid rgba(0,0,0,0.1);
}
.gum.sheet.actor .mod-mini-card:hover .mod-controls { display: flex; }
.gum.sheet.actor .mod-controls a { color: var(--gum-text-medio); font-size: 0.8em; cursor: pointer; }
.gum.sheet.actor .mod-controls a:hover { color: var(--gum-accent-gold); }
.gum.sheet.actor .mod-controls a.item-delete:hover { color: var(--gum-accent-red); }

/* Estado Vazio */
.gum.sheet.actor .empty-state {
    grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gum-text-medio);
    font-style: italic; border: 2px dashed var(--gum-border-light); border-radius: 6px; margin: 10px;
}


/* =================================================================== */
/* 16. ESTILO GLOBAL DE TAGS (TAG-BOX)                                 */
/* Usado em Ataques, Magias e Poderes                                  */
/* =================================================================== */

.gum.sheet.actor .tag-box {
    display: inline-flex;
    align-items: stretch;
    border: 1px solid var(--gum-border-light);
    border-radius: 3px;
    font-size: 0.8em;
    background: #fcfcfc; /* Fundo quase branco para contraste */
    overflow: hidden;
    margin-right: 4px;
    margin-bottom: 2px;
}

.gum.sheet.actor .tag-box label {
    background: #eee;
    color: #666;
    padding: 2px 6px;
    font-weight: 700;
    border-right: 1px solid var(--gum-border-light);
    display: flex;
    align-items: center;
    font-size: 0.9em;
    text-transform: uppercase;
}

.gum.sheet.actor .tag-box .value {
    padding: 2px 6px;
    color: var(--gum-text-escuro);
    font-weight: 600;
    display: flex;
    align-items: center;
}

/* Cores Específicas para Tags */
.gum.sheet.actor .tag-box.damage {
    border-color: rgba(165, 53, 65, 0.3);
}
.gum.sheet.actor .tag-box.damage label {
    background: rgba(165, 53, 65, 0.1);
    color: var(--gum-accent-red);
}

.gum.sheet.actor .tag-box.attack label {
    color: var(--gum-accent-orange);
}

.gum.sheet.actor .tag-box.resistance {
    border-color: rgba(192, 57, 43, 0.3);
}
.gum.sheet.actor .tag-box.resistance label {
    background: rgba(192, 57, 43, 0.1);
    color: var(--gum-accent-red);
}

/* Links dentro das tags (Rolagens) */
.gum.sheet.actor .tag-box a.rollable:hover,
.gum.sheet.actor .tag-box a.rollable-damage:hover {
    background: var(--gum-accent-gold);
    color: #fff;
    text-decoration: none;
}

/* =================================================================== */
/* 17. CONTROLES DE ITEM (EDITAR / DELETAR)                            */
/* =================================================================== */

.gum.sheet.actor .item-controls {
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0.6;
    transition: opacity 0.2s;
}

/* Ficam totalmente visíveis ao passar o mouse na linha */
.gum.sheet.actor .item-row:hover .item-controls,
.gum.sheet.actor .group-summary:hover .item-controls,
.gum.sheet.actor .spell-summary:hover .item-controls {
    opacity: 1;
}

.gum.sheet.actor .item-control {
    color: var(--gum-text-medio);
    cursor: pointer;
    font-size: 0.9em;
}

.gum.sheet.actor .item-control:hover {
    color: var(--gum-accent-gold);
}

.gum.sheet.actor .item-control.item-delete:hover {
    color: var(--gum-accent-red);
}

/* =================================================================== */
/* 9. VISUALIZAÇÃO RÁPIDA (QUICK VIEW / ITEM CARD) - GUM SYSTEM       */
/* =================================================================== */

/* --- Ajuste da Janela do Dialog (O Container do Foundry) --- */
.dialog.gurps-item-preview-dialog .dialog-content {
    padding: 0; /* Remove padding padrão do Foundry para usarmos o nosso */
    background: transparent;
    overflow: hidden; /* Garante que bordas arredondadas funcionem */
}

/* --- O Card Principal --- */
.gurps-item-preview-card {
    background: var(--gum-bg-paper, #fdfaf5); /* Cor creme/papel */
    color: var(--gum-text-escuro, #2c2c2c);
    font-family: var(--gum-font-primary, "Roboto", sans-serif);
    border: 1px solid var(--gum-border-light, #d0c0a0);
    border-radius: 0 0 4px 4px; /* Dialog já tem topo arredondado */
    display: flex;
    flex-direction: column;
    min-width: 380px;
    box-shadow: inset 0 0 30px rgba(139, 69, 19, 0.05); /* Textura sutil interna */
}

/* Ajuste específico para quando o Card aparece no CHAT */
.chat-message .gurps-item-preview-card {
    min-width: auto;
    border: none;
    background: transparent;
    box-shadow: none;
    font-size: 0.9em;
}

/* --- Cabeçalho (Imagem + Título + Tipo) --- */
.gurps-item-preview-card .preview-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0));
    border-bottom: 2px solid var(--gum-border-gold, #c5a563);
}

.gurps-item-preview-card .header-icon {
    width: 48px;
    height: 48px;
    object-fit: cover;
    border-radius: 4px;
    border: 1px solid var(--gum-border-dark, #5a4a3a);
    box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    flex-shrink: 0;
}

.gurps-item-preview-card .header-text {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    line-height: 1.2;
}

.gurps-item-preview-card .header-text h3 {
    margin: 0;
    font-family: var(--gum-font-secondary, "Cinzel", serif);
    font-weight: 700;
    font-size: 1.3em;
    color: var(--gum-primary, #4a3b2a);
    border: none; /* Remove bordas padrões de H3 do Foundry */
}

.gurps-item-preview-card .preview-item-type {
    font-size: 0.75em;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--gum-text-medio, #666);
    font-weight: bold;
}

/* Botões do Header (Enviar pro Chat) */
.gurps-item-preview-card .header-controls a {
    color: var(--gum-text-medio, #888);
    cursor: pointer;
    transition: color 0.2s;
    font-size: 1.1em;
    padding: 4px;
}

.gurps-item-preview-card .header-controls a:hover {
    color: var(--gum-accent-blue, #1e88e5);
    text-shadow: 0 0 5px rgba(30, 136, 229, 0.4);
}

/* --- Área de Conteúdo --- */
.gurps-item-preview-card .preview-content {
    padding: 12px;
    background: var(--gum-bg-paper, #fdfaf5);
}

/* --- Grid de Propriedades (Tags) --- */
.gurps-item-preview-card .preview-properties {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 10px;
}

/* A Tag Individual (Caixinha) */
.gurps-item-preview-card .property-tag {
    display: flex;
    flex-direction: column; /* Label em cima, valor embaixo */
    align-items: center;
    background: rgba(0, 0, 0, 0.04);
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 4px;
    padding: 4px 8px;
    min-width: 50px;
    flex-grow: 1; /* Faz as tags esticarem para preencher linhas */
    flex-basis: 0; /* Distribuição igual */
}

/* Label da Tag (ex: "Dano", "Peso") */
.gurps-item-preview-card .property-tag label {
    font-size: 0.65em;
    text-transform: uppercase;
    font-weight: bold;
    color: var(--gum-text-medio, #777);
    margin-bottom: 2px;
    line-height: 1;
}

/* Valor da Tag (ex: "2d+1 cut", "1 kg") */
.gurps-item-preview-card .property-tag span {
    font-weight: 600;
    font-size: 0.95em;
    color: var(--gum-text-escuro, #222);
    text-align: center;
    white-space: nowrap;
}

/* --- Divisória Decorativa --- */
.gurps-item-preview-card .preview-divider {
    border: 0;
    height: 1px;
    background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(197, 165, 99, 0.75), rgba(0, 0, 0, 0));
    margin: 8px 0 12px 0;
}

/* --- Descrição do Item --- */
.gurps-item-preview-card .preview-description {
    font-size: 0.95em;
    line-height: 1.5;
    color: #333;
    text-align: justify;
}

.gurps-item-preview-card .preview-description p {
    margin-bottom: 0.5em;
}

/* Estilos para Enriched HTML (Links de UUID, rolagens) */
.gurps-item-preview-card .preview-description a.content-link,
.gurps-item-preview-card .preview-description a.inline-roll {
    background: rgba(0, 0, 0, 0.05);
    border: 1px solid var(--gum-border-light);
    padding: 0 4px;
    border-radius: 2px;
    color: var(--gum-primary);
    text-decoration: none;
}

.gurps-item-preview-card .preview-description a.content-link:hover {
    background: var(--gum-primary);
    color: #fff;
}

/* =================================================================== */
/* Chat: Cards de Dano (GURPS)                                         */
/* =================================================================== */
.chat-message .gurps-damage-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(245, 239, 229, 0.92));
    border: 1px solid #d7ccb8;
    border-radius: 8px;
    padding: 10px 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
    position: relative;
    font-size: 0.9rem;
    color: #2f2b28;
    font-family: "Roboto", "Segoe UI", sans-serif;
}

.chat-message .gurps-damage-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 4px;
    border-bottom: 1px solid #e6ddcd;
    padding-bottom: 3px;
}

.chat-message .gurps-damage-card .card-header h3 {
    margin: 0;
    font-size: 0.95rem;
    font-weight: 800;
    color: #2f2b28;
}

.chat-message .gurps-damage-card .card-formula-container {
    margin-bottom: 6px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
}

.chat-message .gurps-damage-card .formula-pill {
    display: inline-block;
    padding: 3px 7px;
    border: 1px solid #e6ddcd;
    border-radius: 999px;
    background: rgba(0, 0, 0, 0.04);
    font-family: "Roboto Condensed", "Segoe UI", sans-serif;
    color: #2f2b28;
    font-weight: 700;
    letter-spacing: 0.01em;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
}

.chat-message .gurps-damage-card .card-main-flex {
    display: flex;
    gap: 8px;
    align-items: stretch;
    background: rgba(0, 0, 0, 0.02);
    border: 1px solid #e6ddcd;
    border-radius: 6px;
    padding: 7px 8px;
}

.chat-message .gurps-damage-card .roll-column,
.chat-message .gurps-damage-card .target-column {
    flex: 1;
    text-align: center;
}

.chat-message .gurps-damage-card .column-label {
    display: block;
    font-size: 0.72rem;
    text-transform: uppercase;
    color: #6b5e55;
    margin-bottom: 2px;
    letter-spacing: 0.02em;
    font-weight: 800;
}

.chat-message .gurps-damage-card .individual-dice-damage,
.chat-message .gurps-damage-card .extra-dice {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
    justify-content: center;
}

.chat-message .gurps-damage-card .die-damage {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 18px;
    min-height: 18px;
    padding: 2px 5px;
    border: 1px solid #e6ddcd;
    border-radius: 3px;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(235, 235, 235, 0.9));
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.18);
    font-weight: 700;
    font-size: 0.82rem;
    color: #2f2b28;
}

.chat-message .gurps-damage-card .column-separator {
    width: 1px;
    background: #e6ddcd;
    opacity: 0.8;
    margin: 0 2px;
}

.chat-message .gurps-damage-card .damage-total {
    display: flex;
    align-items: baseline;
    gap: 4px;
    justify-content: center;
}

.chat-message .gurps-damage-card .damage-value {
    font-size: 1.6rem;
    font-weight: 900;
    color: #b64040;
    line-height: 1.1;
}

.chat-message .gurps-damage-card .damage-type {
    font-size: 0.82rem;
    color: #6f6761;
}

.chat-message .gurps-damage-card .card-footer {
    margin-top: 8px;
    padding-top: 6px;
    border-top: 1px solid #e6ddcd;
    display: grid;
    gap: 6px;
}

.chat-message .gurps-damage-card .extra-damage-block {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(197, 160, 91, 0.08);
    border: 1px solid rgba(197, 160, 91, 0.35);
    border-radius: 6px;
    padding: 6px 8px;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5);
}

.chat-message .gurps-damage-card .extra-damage-label {
    font-weight: 700;
    font-size: 0.82rem;
    color: #2f2b28;
    text-transform: uppercase;
}

.chat-message .gurps-damage-card .extra-damage-roll {
    display: flex;
    align-items: center;
    gap: 8px;
}

.chat-message .gurps-damage-card .extra-total {
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.chat-message .gurps-damage-card .card-actions {
    margin-top: 8px;
    padding-top: 6px;
    border-top: 1px solid var(--gum-border-light);
    display: grid;
    gap: 6px;
}

.chat-message .gurps-damage-card .apply-damage-button {
    background: #191813;
    color: #fff;
    border: none;
    padding: 10px 0;
    border-radius: 6px;
    font-weight: 800;
    cursor: pointer;
    transition: filter 0.15s ease;
    box-shadow: 0 2px 6px rgba(165, 53, 65, 0.3);
    width: 100%;
    text-align: center;
}

.chat-message .gurps-damage-card .apply-damage-button:hover {
    filter: brightness(0.92);
}

/* =================================================================== */
/* RD Manual Dialog                                                    */
/* =================================================================== */
.gum-rd-form {
    font-family: "Roboto", "Segoe UI", sans-serif;
    color: #2f2b28;
}
.gum-rd-form .gum-rd-profile-row {
    background: #f8f4ed;
    border: 1px solid #e6ddcd;
    border-radius: 8px;
    padding: 8px 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
}
.gum-rd-form .gum-body-profile-select {
    flex: 0 0 180px;
    padding: 4px 6px;
    border: 1px solid #d7ccb8;
    border-radius: 6px;
    background: #fff;
}
.gum-rd-form .gurps-rd-table {
    border: 1px solid #e0d5c7;
    border-radius: 8px;
    overflow: hidden;
    background: #fdfbf6;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}
.gum-rd-form .gurps-rd-table .table-header {
    display: grid;
    grid-template-columns: 1.2fr 1fr 1fr 1fr 1fr;
    background: #f4efe8;
    color: #6b5e55;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    padding: 8px 10px;
    border-bottom: 1px solid #e6ddcd;
}
.gum-rd-form .gurps-rd-table .table-body {
    max-height: 420px;
    overflow-y: auto;
}
.gum-rd-form .gurps-rd-table .table-row {
    display: grid;
    grid-template-columns: 1.2fr 1fr 1fr 1fr 1fr;
    align-items: center;
    padding: 8px 10px;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    gap: 6px;
}
.gum-rd-form .gurps-rd-table .table-row:nth-child(even) {
    background: rgba(0,0,0,0.01);
}
.gum-rd-form .gurps-rd-table .table-row .loc-label {
    font-weight: 800;
    color: #2f2b28;
}
.gum-rd-form .gurps-rd-table .table-row input[type="text"] {
    width: 100%;
    padding: 4px 6px;
    border: 1px solid #d7ccb8;
    border-radius: 6px;
    background: #fff;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
}
.gum-rd-form .gurps-rd-table .table-row .loc-rd-total strong {
    color: #b64040;
}